const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/FormGroup.BZ63K4aQ.js","assets/chunks/FormTitle.aiVroYjA.js","assets/chunks/framework.nwrEuAw0.js","assets/chunks/theme.CwN1VO7-.js","assets/chunks/run-function.ZYhDcPlt.js","assets/chunks/validate.CC0GjpC9.js","assets/chunks/index.4DmvHG38.js","assets/chunks/index.BeJCSdxc.js","assets/chunks/install.BalIz2Dd.js","assets/chunks/index.D5lW5ejP.js","assets/chunks/index.CHg6CLv2.js","assets/chunks/useIntl.D9BxrIIv.js","assets/chunks/index.BQcXUXwd.js","assets/chunks/FormSet.CittKtA0.js","assets/chunks/useFieldValue.iT8N8QSs.js","assets/chunks/FormList.DUM6WYpV.js","assets/chunks/FormListContext.C1lAsfCm.js","assets/chunks/FormItem.B_Xmx61T.js","assets/chunks/index.CM_oSmR9.js"])))=>i.map(i=>d[i]);
import{P as qe}from"./index.4DmvHG38.js";import{d as N,r as Ge,w as G,c as ce,p as de,f as A,s as se,o as ve,e as y,F as W,v as We,k as b,a0 as x,an as te,ao as le,i as fe,u as $e,h as ze,J as Ue,E as Ke,aR as He,aZ as Qe}from"./framework.nwrEuAw0.js";import{N as M,O as L,s as q,p as $,Q as J,S as Ee,B as we,v as Xe,i as Ye,U as Ze,u as Je,W as X,X as et,Y as Be,o as tt,Z as lt}from"./theme.CwN1VO7-.js";import{d as Re,e as nt,a as ie,f as at}from"./validate.CC0GjpC9.js";import{a as I,o as T,P as ue}from"./index.BeJCSdxc.js";import{u as ne}from"./index.D5lW5ejP.js";import{u as ae}from"./useIntl.D9BxrIIv.js";import{P as rt}from"./index.BQcXUXwd.js";import{w as ot,a as re}from"./install.BalIz2Dd.js";function ut(e){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&delete e[n]}const Ve=Symbol("FormSlotsContext"),je=()=>ce(Ve,{});var st=N({name:"FormSlotsContextProvider",inheritAttrs:!1,props:{value:{type:Object,default:()=>({})}},setup(e,{slots:n}){const l=Ge({});return G(()=>e.value,()=>{ut(l),Object.assign(l,e.value)},{immediate:!0}),de(Ve,l),()=>{var d;return(d=n.default)==null?void 0:d.call(n)}}});const it=()=>({layout:{type:String,default:"horizontal"},labelCol:{type:Object},wrapperCol:{type:Object},colon:{type:Boolean,default:!0},requiredMark:{type:[Boolean,String],default:!0},labelAlign:{type:String,default:"right"},labelWrap:Boolean,disabled:{type:Boolean,default:!1},prefixCls:String,validateMessages:Object,validateTrigger:{type:[String,Array],default:"change"},validateOnRuleChange:{type:Boolean,default:!0},scrollToFirstError:{type:[Boolean,Object],default:!1},name:String}),Ht=()=>({value:{type:[String,Array,Number,Object,Boolean]},readonly:{type:Boolean,default:void 0},readonlyProps:{type:Object,default:void 0},valueEnum:{type:[Function,Object],default:void 0},options:{type:[Array,Function],default:void 0},request:{type:Function,default:void 0},params:{type:[Function,Object],default:void 0},dependencies:{type:Array,default:void 0},onChange:{type:Function}}),Q=()=>({...it(),loading:{type:Boolean,default:void 0},showLoading:{type:Boolean,default:!0},submitOnLoading:{type:Boolean,default:!0},gridSubmitter:{type:Boolean,default:!1},omitNil:{type:Boolean,default:!0},readonly:Boolean,grid:Boolean,isKeyPressSubmit:Boolean,formKey:String,theme:{type:String,default:"custom"},customUi:{type:Boolean,default:!0},initialValues:{type:Object},readonlyProps:{type:Object},colProps:{type:Object},rowProps:{type:Object},dateFormatter:{type:[String,Function,Boolean],default:"string"},params:{type:Object},items:{type:Array},request:{type:Function},requestAbort:{type:Boolean},submitter:{type:[Object,Boolean],default:void 0},onReset:{type:Function},onFinish:{type:Function},onFinishFailed:{type:Function},onLoadingChange:{type:Function},onValuesChange:{type:Function},onInit:{type:Function,default:void 0}}),me=()=>({...Q(),submitTimeout:{type:Number,default:void 0},title:{type:String,default:void 0},width:{type:[String,Number],default:800},open:{type:Boolean,default:void 0},closeOnFinish:{type:Boolean,default:!0},confirmOnValuesChange:{type:Boolean,default:!0},onOpenChange:{type:Function,default:void 0}}),Ie=()=>({...Q(),preserve:{type:Boolean,default:!0},defaultCollapsed:{type:Boolean,default:!0},collapsed:{type:Boolean,default:void 0},defaultColsNumber:Number,defaultFormItemsNumber:Number,labelWidth:{type:[String,Number],default:"80"},searchText:String,resetText:String,searchGutter:{type:Number,default:24},span:{type:[Number,Object]},showHiddenNum:Boolean,ignoreRules:Boolean,resetOnSubmit:Boolean,onCollapse:{type:Function,default:void 0},onResize:{type:Function,default:void 0}}),Te=()=>({...Q(),current:{type:Number,default:void 0},steps:{type:Array,default:()=>[]},items:{type:Array,default:()=>[]},stepsProps:{type:Object},containerStyle:{type:Object},onCurrentChange:{type:Function,default:void 0}}),ct=()=>({...Q(),...me(),...Ie(),...Te(),items:{type:Array,default:()=>[]}});function dt(e,n){return e?Re(e)&&e.startsWith("::")?n[e.substring(2)]:e:null}const De=Symbol("FormContext"),vt=e=>{de(De,e)},ge=()=>ce(De,{}),Ne=(e,{slots:n})=>{var l;return(l=n.default)==null?void 0:l.call(n)};Ne.displayName="RenderSlot";Ne.inheritAttrs=!1;const ye=(e,{slots:n})=>{var l,d,u;return typeof e.vnode=="function"?((l=e.vnode)==null?void 0:l.call(e,e.props||{}))||((d=n.default)==null?void 0:d.call(n)):e.vnode||((u=n.default)==null?void 0:u.call(n))};ye.props=["vnode","props"];ye.inheritAttrs=!1;function ft(e){const n=A(null);return async(d,u)=>{var f,a;(f=n.value)==null||f.abort();const i=new AbortController;return n.value=i,await Promise.race([(a=e.request)==null?void 0:a.call(e,d,u),new Promise((v,C)=>{var w,_;(_=(w=n.value)==null?void 0:w.signal)==null||_.addEventListener("abort",()=>{C(new Error("aborted"))})})])}}function mt(e){const n=typeof e=="function"?e():e,l=A(n);function d(u){l.value=u}return[l,d]}var Y=(e=>(e.FORM_SET="formSet",e.FORM_LIST="formList",e.GROUP="group",e.DIVIDER="divider",e.TEXT="text",e.DIGIT="digit",e.DIGIT_RANGE="digitRange",e.SELECT="select",e.TREE_SELECT="treeSelect",e.CASCADER="cascader",e.TEXTAREA="textarea",e.PASSWORD="password",e.CHECKBOX="checkbox",e.CHECKBOX_GROUP="checkboxGroup",e.RADIO_GROUP="radioGroup",e.SWITCH="switch",e.SLIDER="slider",e.RATE="rate",e.DATE="date",e.DATE_RANGE="dateRange",e.TIME="time",e.TIME_RANGE="timeRange",e.UPLOAD_BUTTON="uploadButton",e.UPLOAD_DRAGGER="uploadDragger",e.UPLOAD_PICTURE="uploadPicture",e.UPLOAD_PICTURE_LIST="uploadPictureList",e.EDITOR="editor",e))(Y||{});function ke(e){return{getFieldValue:g=>{var h;return(h=e.value)==null?void 0:h.getFieldValue(g)},getFieldsValue:g=>{var h;return(h=e.value)==null?void 0:h.getFieldsValue(g)},resetInitialValues:g=>{var h;return(h=e.value)==null?void 0:h.resetInitialValues(g)},getFieldFormatValue:g=>{var h;return(h=e.value)==null?void 0:h.getFieldFormatValue(g)},getFieldFormatValueObject:g=>{var h;return(h=e.value)==null?void 0:h.getFieldFormatValueObject(g)},validateFieldsReturnFormatValue:g=>{var h;return(h=e.value)==null?void 0:h.validateFieldsReturnFormatValue(g)},setFieldValue:(g,h)=>{var p;return(p=e.value)==null?void 0:p.setFieldValue(g,h)},setFieldsValue:(g,h=!0)=>{var p;return(p=e.value)==null?void 0:p.setFieldsValue(g,h)},resetField:g=>{var h;return(h=e.value)==null?void 0:h.resetField(g)},clearValidate:g=>{var h;return(h=e.value)==null?void 0:h.clearValidate(g)},validateFields:g=>{var h;return(h=e.value)==null?void 0:h.validateFields(g)},reset:()=>{var g;return(g=e.value)==null?void 0:g.reset()},submit:()=>{var g;return(g=e.value)==null?void 0:g.submit()}}}const gt=e=>{const n=A(!0),l=A(!1),d=se({...e.initialValues}),u=ft({request:e.request});return ve(async()=>{var f;if(e.request&&!e.requestAbort){n.value=!0,l.value=!0;const a=await u(e.params);d.value=(f=M({},d.value,a))!=null?f:{},Promise.resolve().then(()=>{n.value=!1,l.value=!1})}}),{initialValues:d,hasInitial:n,requestLoading:l}},yt=()=>{const e=se([]),n=se([]),l=y(()=>e.value.map(o=>o.split(":")[1])),d=(o,v,C)=>{Array.isArray(C)||(C=[C]);const w=o.filter(_=>!_.startsWith(v+":"));return w.push(...C.map(_=>`${v}:${_}`)),Array.from(new Set(w))},u=(o,v)=>{e.value=d(e.value,o,v)},f=(o,v)=>{n.value=d(n.value,o,v)},a=y(()=>e.value.filter(o=>!l.value.includes(o.split(":")[0])).map(o=>o.split(":")[1])),i=y(()=>n.value.filter(o=>!l.value.includes(o.split(":")[0])).map(o=>o.split(":")[1]));return{allHiddenKeys:a,hiddenKeys:e,allDisabledKeys:i,disabledKeys:n,updateHiddenKeys:u,updateDisabledKeys:f}},z=e=>{if(e)return Re(e)?e.indexOf(".")>-1?e.split("."):[e]:e};function Me(e){return Array.isArray(e)&&e.length===1&&(e=e[0]),e?.__v_isVNode&&typeof e.type!="symbol"}function bt(e){return e&&(e.type===Comment||e.type===W&&e.children.length===0||e.type===Text&&e.children.trim()==="")}function oe(e=[]){const n=[];return e.forEach(l=>{Array.isArray(l)?n.push(...l):l?.type===W?n.push(...oe(l.children)):n.push(l)}),n.filter(l=>!bt(l)&&Me(l))}function be(e,n={},l=!0,d=!1){let u=e;if(Array.isArray(e)&&(u=oe(e)[0]),!u)return null;const f=We(u,n,d);return f.props=l?{...f.props,...n}:f.props,f}function ht(e){return typeof e!="object"?!1:e===null?!0:!(Me(e)||e.constructor===RegExp||e instanceof Map||e instanceof Set||e instanceof HTMLElement||e instanceof Blob||e instanceof File||Array.isArray(e))}const U=(e,n)=>{if(Object.keys(e).length<1||typeof window>"u"||typeof e!="object"||nt(e)||e instanceof Blob)return e;let l=Array.isArray(e)?[]:{};const d=(u,f)=>{let i=Array.isArray(u)?[]:{};return u==null||u===void 0?i:(Object.keys(u).forEach(o=>{const v=(g,h)=>(Array.isArray(g)&&g.forEach((p,V)=>{if(!p)return;const R=h?.[V];typeof p=="function"&&(h[V]=p(h,o,u)),typeof p=="object"&&!Array.isArray(p)&&Object.keys(p).forEach(t=>{const m=R?.[t];if(typeof p[t]=="function"&&m){const r=p[t](R[t],o,u);R[t]=typeof r=="object"?r[t]:r}else typeof p[t]=="object"&&Array.isArray(p[t])&&m&&v(p[t],m)}),typeof p=="object"&&Array.isArray(p)&&R&&v(p,R)}),o),C=f?[f,o].flat(1):[o].flat(1),w=u[o],_=$(e,C),E=()=>{let g,h,p=!1;if(typeof _=="function"){h=_?.(w,o,u);const V=typeof h;V!=="object"&&V!=="undefined"?(g=o,p=!0):g=h}else g=v(_,w);if(Array.isArray(g)){i=q(i,g,w);return}typeof g=="object"&&!Array.isArray(l)?l=M(l,g):typeof g=="object"&&Array.isArray(l)?i={...i,...g}:(g!==null||g!==void 0)&&(i=q(i,[g],p?h:w))};if(_&&typeof _=="function"&&E(),!(typeof window>"u")){if(ht(w)){const g=d(w,C);if(Object.keys(g).length<1)return;i=q(i,[o],g);return}E()}}),n?i:u)};return l=Array.isArray(e)&&Array.isArray(l)?[...d(e)]:M({},d(e),l),l};function Ft({props:e,formRef:n,formData:l,initialValues:d,hasInitial:u,onFinish:f,onReset:a,onFinishFailed:i}){const o=r=>{const s=z(r);if(!s)throw new Error("name is require");return $(l.value,s)},v=r=>{if(r===!0||r===void 0)return L(l.value);const s={};return r.forEach(S=>{const j=z(S),P=$(l.value,j);P!==void 0&&q(s,j,P)}),s},C=r=>{const s=z(r);if(!s)throw new Error("name is require");const S=$(l.value,s),j=q({},s,S);return $(U(j,e.omitNil),s)},w=r=>{const s=z(r);if(!s)throw new Error("name is require");const S=$(l.value,s),j=q({},s,S);return U(j,e.omitNil)},_=async r=>{var s;if(!Array.isArray(r)&&r)throw new Error("nameList must be array");const S=await((s=n.value)==null?void 0:s.validateFields(r)),j=U(S,e.omitNil);return j??{}},E=(r,s)=>{const S=z(r);if(!S)throw new Error("name is require");q(l.value,S,s)},g=(r,s=!0)=>{if(!r)throw new Error("values is require");s?l.value=M({},l.value,r):l.value=L(r)},h=r=>{if(!r)throw new Error("values is require");if(!ie(r))throw new Error("values must be object");u.value=!0,d.value=L(r)},p=()=>{var r;u.value=!0,(r=n.value)==null||r.clearValidate(),l.value=L(d.value),Promise.resolve().then(()=>{u.value=!1,a?.(U(l.value,e.omitNil))})},V=r=>{var s;if(!z(r))throw new Error("name is require");(s=n.value)==null||s.clearValidate(r),q(l.value,r,L($(d.value,r)))},R=r=>{var s;(s=n.value)==null||s.clearValidate(r)},t=r=>new Promise((s,S)=>{var j;(j=n.value)==null||j.validateFields(r).then(P=>{s({...l.value,...P})}).catch(P=>{S(P)})});return{getFieldValue:o,getFieldsValue:v,resetInitialValues:h,getFieldFormatValue:C,getFieldFormatValueObject:w,validateFieldsReturnFormatValue:_,setFieldValue:E,setFieldsValue:g,resetField:V,clearValidate:R,validateFields:t,reset:p,submit:()=>{t().then(r=>{if(f)try{f(r)}catch(s){console.error(s)}}).catch(r=>{i&&i(r)})}}}var _t=N({name:"FormRowWrapper",inheritAttrs:!1,props:{rowProps:{type:Object,default:void 0},grid:{type:Boolean,default:void 0}},setup(e,{slots:n,attrs:l}){const{rowProps:d,grid:u}=ge(),f=y(()=>{var i;return(i=e.grid)!=null?i:u?.value}),a=y(()=>{var i;return(i=e.rowProps)!=null?i:d?.value});return()=>{var i;return f?.value?b(J,x(a.value,{class:l.class}),{default:()=>{var o;return[(o=n.default)==null?void 0:o.call(n)]}}):(i=n.default)==null?void 0:i.call(n)}}});function he(e,n){const l={};return Array.isArray(n)&&n.length>0&&Object.keys(e||{}).forEach(d=>{n.includes(d)&&(l[d]=e[d])}),l}const Ct=te(()=>le(()=>import("./FormGroup.BZ63K4aQ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),pt=te(()=>le(()=>import("./FormSet.CittKtA0.js"),__vite__mapDeps([13,14,3,2,1,4,7,5,8,9,6,10,11,12]))),Pt=te(()=>le(()=>import("./FormList.DUM6WYpV.js"),__vite__mapDeps([15,16,2,1,3,14,4,7,5,8,9,6,10,11,12]))),wt=te(()=>le(()=>import("./FormItem.B_Xmx61T.js"),__vite__mapDeps([17,14,3,2,16,18,11,9,8,7,5,4,12,10,1,6]))),St=["min","max","isValidateList","emptyListMessage","creatorRecord","creatorButtonProps","alwaysShowItemLabel","actionGuard","copyIconProps","deleteIconProps","onAfterAdd","onAfterRemove"],Ot=["action","creator","item"];var At=N({name:"FormItems",inheritAttrs:!1,props:{list:{type:Array,default:()=>[]},type:{type:String,default:""},grid:{type:Boolean,default:void 0},spaceProps:{type:Object,default:()=>({size:[32,0],wrap:!0})}},setup(e){const{grid:n,allHiddenKeys:l}=ge(),d=je(),u=y(()=>{var a;return(a=e.grid)!=null?a:n?.value}),f=y(()=>e.list.filter(a=>!l.value.includes(a.key)).map(a=>{var i;if(a.fieldType===Y.GROUP)return b(Ct,{key:a.key,items:a.children,title:a.title,tooltip:a.tooltip,colProps:a.colProps,rowProps:a.rowProps,spaceProps:a.spaceProps,grid:a.grid,item:a,formItemProps:a.formItemProps},null);if(a.fieldType===Y.FORM_SET)return b(pt,{key:a.key,name:a.name,items:a.children,title:a.title,tooltip:a.tooltip,colProps:a.colProps,rowProps:a.rowProps,spaceProps:a.spaceProps,formItemProps:a.formItemProps,initialValue:a.initialValue,convertValue:a.convertValue,transform:a.transform},null);if(a.fieldType===Y.FORM_LIST){const o=I(he((i=a.fieldProps)!=null?i:{},St)),v={};return Ot.forEach(C=>{var w;const _=dt((w=a.fieldProps)==null?void 0:w[`${C}Render`],d);_&&(v[C]=E=>b(ye,{vnode:_,props:E},null))}),b(Pt,x({key:a.key,name:a.name,originName:a.originName,items:a.children,title:a.title,tooltip:a.tooltip,rules:a.rules,colProps:a.colProps,rowProps:a.rowProps,formItemProps:a.formItemProps,initialValue:a.initialValue,convertValue:a.convertValue,transform:a.transform},o),{...v})}return b(wt,{key:a.key,item:a},null)}));return()=>e.type==="space"&&!u?.value?b(Ee,x(e.spaceProps,{align:"start"}),{default:()=>[f.value]}):f.value}});function Se(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!fe(e)}var xt=N({name:"FormSubmitter",inheritAttrs:!1,props:{loading:{type:Boolean,default:void 0},reverse:{type:Boolean,default:void 0},onSubmit:{type:Function,default:void 0},onReset:{type:Function,default:void 0},searchConfig:{type:Object,default:void 0},submitButtonProps:{type:[Object,Boolean],default:void 0},resetButtonProps:{type:[Object,Boolean],default:void 0},render:{type:[Function,Boolean],default:void 0}},setup(e,{attrs:n}){const{action:l}=ge(),d=je(),u=()=>{var o;l.submit(),(o=e.onSubmit)==null||o.call(e)},f=()=>{var o,v;(o=l.reset)==null||o.call(l),(v=e.onReset)==null||v.call(e)},a=y(()=>{const{searchConfig:o={},resetButtonProps:v={}}=e;if(v===!1)return null;const{resetText:C="重置"}=o;return b(we,x(T(v,["preventDefault","onClick"]),{key:"reset",onClick:w=>{var _;v.preventDefault||f(),(_=v.onClick)==null||_.call(v,w)}}),Se(C)?C:{default:()=>[C]})}),i=y(()=>{const{searchConfig:o={},submitButtonProps:v={}}=e;if(v===!1)return null;const{submitText:C="提交"}=o;return b(we,x({type:"primary"},T(v||{},["preventDefault","onClick"]),{key:"submit",onClick:w=>{var _;v.preventDefault||u(),(_=v.onClick)==null||_.call(v,w)}}),Se(C)?C:{default:()=>[C]})});return()=>{if(e.render===!1)return null;const{render:o=d.submitter}=e,v=e.reverse?b(W,null,[a.value,i.value]):b(W,null,[i.value,a.value]),C=o?o({props:{...e,submit:u,reset:f},action:l,defaultDoms:v}):v;return b("div",{style:{display:"flex",gap:"8px",alignItems:"center",...n.style},class:n.class},[C])}}});function ee(e,n){const{defaultValue:l,value:d=A()}=n||{};let u=typeof e=="function"?e():e;d.value!==void 0&&(u=$e(d)),l!==void 0&&(u=typeof l=="function"?l():l);const f=A(u),a=A(u);ze(()=>{let o=d.value!==void 0?d.value:f.value;n?.postState&&(o=n.postState(o)),a.value=o});function i(o){const v=a.value;f.value=o,Ue(a.value)!==o&&n?.onChange&&n?.onChange(o,v)}return G(d,()=>{f.value=d.value}),[a,i]}function Et(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!fe(e)}let Oe=0;var Z=N({name:"BaseForm",inheritAttrs:!1,props:{...Q()},setup(e,{slots:n,expose:l,attrs:d}){const u=A(!1),f=A(),a=ne("form"),i=A({}),o=A([]),v=y(()=>{var P;return(P=e.formKey)!=null?P:Oe.toString()}),[C,w]=ee(!1,{value:y(()=>e.loading),onChange:P=>{var c;(c=e.onLoadingChange)==null||c.call(e,P)}}),_=y(()=>{var P;return{[a]:!0,[`${(P=d.class)!=null?P:""}`]:!0}}),E=y(()=>{var P;return{...I(T(e,["colProps","submitter","loading","showLoading","omitNil","grid","theme","customUi","gridSubmitter","requestAbort","isKeyPressSubmit","formKey","initialValues","rowProps","dateFormatter","params","readonly","readonlyProps","items","request","submitOnLoading","onLoadingChange","onFinish","onValuesChange"])),layout:(P=e.layout)!=null?P:"vertical"}}),g=P=>P.filter(c=>!c.hidden).sort((c,F)=>{var O,B;return F.order||c.order?((O=F.order)!=null?O:0)-((B=c.order)!=null?B:0):0}).map((c,F)=>{var O,B;const D=z(c.name),k=(O=c.key)!=null?O:D?(D??[]).join("_"):F;return I({...c,originName:(B=c.originName)!=null?B:c.name,name:D,key:k})}).filter(c=>!!c);G(()=>e.items,()=>{var P;o.value=g((P=e.items)!=null?P:[])},{immediate:!0});const{initialValues:h,hasInitial:p,requestLoading:V}=gt(e);G(h,(P,c)=>{Ye(P,c)||(i.value=L(P),(!e.request||e.requestAbort)&&Promise.resolve().then(()=>{p.value=!1}))},{immediate:!0});const R=Xe(()=>{var P;(P=e.onValuesChange)==null||P.call(e,U(L(i.value),e.omitNil))},200),t=async()=>{if(e.onFinish){if(e.submitOnLoading){if(C.value)return;w(!0)}try{const P=U(L(i.value),e.omitNil);await e.onFinish(P)}catch(P){console.log("🚀 ~ onFinish ~ error:",P)}finally{e.submitOnLoading&&w(!1)}}};G(i,()=>{p.value||R()},{deep:!0});const m=yt(),r=Ft({props:e,formRef:f,formData:i,initialValues:h,hasInitial:p,onFinish:t,onReset:e.onReset,onFinishFailed:e.onFinishFailed}),s=y(()=>typeof e.submitter=="boolean"||!e.submitter?{}:T(e.submitter,["colProps"])),S=y(()=>e.submitter===!1||e.readonly?{}:e.gridSubmitter&&ie(e.submitter)&&ie(e.submitter.colProps)?{...e.submitter.colProps}:{span:24}),j=y(()=>{if(e.submitter===!1||e.readonly)return;const P=s.value.submitButtonProps===!1?!1:{loading:C.value,...s.value.submitButtonProps},c=s.value.resetButtonProps===!1?!1:{disabled:C.value,...s.value.resetButtonProps},F=b(xt,x({key:"submitter"},s.value,{submitButtonProps:P,resetButtonProps:c}),null);return s.value.teleport?b(Ke,{to:s.value.teleport},Et(F)?F:{default:()=>[F]}):F});return ve(()=>{var P,c,F;u.value=!0,Oe+=1;const O=(F=(c=(P=f.value)==null?void 0:P.getFieldsValue)==null?void 0:c.call(P,!0))!=null?F:{};Promise.resolve().then(()=>{var B;(B=e.onInit)==null||B.call(e,U(O,e.omitNil),r)})}),vt({...m,action:r,formKey:v,mountedRef:u,prefixCls:a,initialValues:h,formData:i,hasInitial:p,theme:y(()=>e.theme),customUi:y(()=>e.customUi),grid:y(()=>e.grid),disabled:y(()=>e.disabled),readonly:y(()=>e.readonly),readonlyProps:y(()=>e.readonlyProps),rowProps:y(()=>{var P;return(P=e.rowProps)!=null?P:{gutter:16}}),colProps:y(()=>{var P;return(P=e.colProps)!=null?P:{xs:24}}),formatItems:g}),l({...r}),()=>b(st,{value:{...n}},{default:()=>[b(Ze,x({ref:f},E.value,{class:_.value,model:i.value,style:d.style}),{default:()=>[b(Je,{spinning:e.showLoading&&(V.value||C.value)},{default:()=>[b(_t,null,{default:()=>[b(At,{list:o.value},null),e.gridSubmitter&&e.submitter!==!1&&b(X,S.value,{default:()=>[b(et,{label:" ",colon:!1,class:`${a}-submitter-form-item`},{default:()=>[j.value]})]})]}),!e.gridSubmitter&&j.value]})]})]})}}),Fe=N({name:"ProDrawerForm",inheritAttrs:!1,props:{...me(),drawerProps:{type:Object,default:void 0}},emits:["update:open"],setup(e,{slots:n,emit:l}){const d=A(!1),u=A(!1),f=A(!1),a=ae(),i=A(),o=A(null),v=y({get:()=>{var t;return(t=e.open)!=null?t:d.value},set:t=>{typeof e.open>"u"?d.value=t:l("update:open",t)}});G(v,()=>{var t;(t=e.onOpenChange)==null||t.call(e,v.value)});const C=y(()=>({...I(T(e,["onOpenChange","closeOnFinish","drawerProps","title","width","onInit","confirmOnValuesChange","submitTimeout","onFinish","submitter"])),layout:"vertical"})),w=y(()=>({...I(T(n,["trigger","closeIcon","extra","footer","title"]))})),_=y(()=>{var t;return I({...T((t=e.drawerProps)!=null?t:{},["title","width","open","footer","okText","cancelText"]),width:e.width,title:e.title})}),E=y(()=>({...I(he(n,["closeIcon","extra","title"]))})),g=y(()=>{var t,m,r,s;return e.submitter===!1?!1:M({teleport:o.value,reverse:!0,searchConfig:{submitText:(m=(t=e.drawerProps)==null?void 0:t.okText)!=null?m:a.getMessage("confirm.okText","确认"),resetText:(s=(r=e.drawerProps)==null?void 0:r.cancelText)!=null?s:a.getMessage("confirm.cancelText","取消")},resetButtonProps:{preventDefault:!0,disabled:e.submitTimeout?u.value:void 0,onClick:S=>{p(S)}}},e.submitter)}),h=y(()=>{if(!n.trigger)return null;const t=oe(n.trigger())[0];return be(t,{key:"trigger",...t?.props,onClick:async m=>{var r,s;v.value=!v.value,(s=(r=t?.props)==null?void 0:r.onClick)==null||s.call(r,m)}})}),p=t=>{var m,r;e.confirmOnValuesChange&&f.value?Be.confirm({title:a.getMessage("confirm.title","提示"),content:a.getMessage("confirm.formModalCloseContent","您的表单还没有保存，您确定关闭吗？"),onOk(){var s,S;v.value=!1,(S=(s=_.value)==null?void 0:s.onClose)==null||S.call(s,t)},onCancel(){}}):(v.value=!1,(r=(m=_.value)==null?void 0:m.onClose)==null||r.call(m,t))},V=()=>{var t,m,r;i.value&&!((t=_.value)!=null&&t.destroyOnClose)&&((r=(m=i.value)==null?void 0:m.reset)==null||r.call(m))},R=async t=>{var m;const r=(m=e.onFinish)==null?void 0:m.call(e,t);if(e.submitTimeout&&r instanceof Promise){u.value=!0;const S=setTimeout(()=>{u.value=!1},e.submitTimeout);r.finally(()=>{clearTimeout(S),u.value=!1})}const s=await r;return s&&(e.closeOnFinish?v.value=!1:f.value=!1),s};return()=>b(W,null,[b(qe,x(_.value,{open:v.value,onAfterOpenChange:t=>{var m,r;t||V(),f.value=!1,(r=(m=_.value)==null?void 0:m.onAfterOpenChange)==null||r.call(m,t)},onClose:t=>{e.submitTimeout&&u.value||p(t)}}),{default:()=>[b(Z,x(C.value,{submitter:g.value,onFinish:async t=>await R(t),onValuesChange:t=>{var m;e.confirmOnValuesChange&&(f.value=!0),(m=e.onValuesChange)==null||m.call(e,t)},onReset:()=>{var t;e.confirmOnValuesChange&&(f.value=!1),(t=e.onReset)==null||t.call(e)},onInit:(t,m)=>{var r;i.value=m,(r=e.onInit)==null||r.call(e,t,m)}}),w.value)],...E.value,footer:e.submitter!==!1?()=>b("div",{style:"display: flex; justify-content: flex-end;",ref:o},null):void 0}),h.value])}}),_e=N({name:"ProModalForm",inheritAttrs:!1,props:{...me(),modalProps:{type:Object,default:void 0}},emits:["update:open"],setup(e,{slots:n,emit:l}){const d=A(!1),u=A(!1),f=A(!1),a=ae(),i=A(),o=A(null),v=y({get:()=>{var t;return(t=e.open)!=null?t:d.value},set:t=>{typeof e.open>"u"?d.value=t:l("update:open",t)}});G(v,()=>{var t;(t=e.onOpenChange)==null||t.call(e,v.value)});const C=y(()=>{var t;return{...I(T(e,["onInit","onOpenChange","closeOnFinish","modalProps","title","width","confirmOnValuesChange","submitTimeout","onFinish","submitter"])),layout:(t=e.layout)!=null?t:"vertical"}}),w=y(()=>({...I(T(n,["trigger","closeIcon","extra","footer","title"]))})),_=y(()=>{var t;return I({...T((t=e.modalProps)!=null?t:{},["title","width","footer"]),width:e.width,title:e.title,footer:e.submitter===!1?null:void 0})}),E=y(()=>({...I(he(n,["closeIcon","title"]))})),g=y(()=>{var t,m,r,s;return e.submitter===!1?!1:M({teleport:o.value,reverse:!0,searchConfig:{submitText:(m=(t=_.value)==null?void 0:t.okText)!=null?m:a.getMessage("confirm.okText","确认"),resetText:(s=(r=_.value)==null?void 0:r.cancelText)!=null?s:a.getMessage("confirm.cancelText","取消")},resetButtonProps:{preventDefault:!0,disabled:e.submitTimeout?u.value:void 0,onClick:S=>{p(S)}}},e.submitter)}),h=y(()=>{if(!n.trigger)return null;const t=oe(n.trigger())[0];return be(t,{key:"trigger",...t?.props,onClick:async m=>{var r,s;v.value=!v.value,(s=(r=t?.props)==null?void 0:r.onClick)==null||s.call(r,m)}})}),p=t=>{var m,r;e.confirmOnValuesChange&&f.value?Be.confirm({title:a.getMessage("confirm.title","提示"),content:a.getMessage("confirm.formModalCloseContent","您的表单还没有保存，您确定关闭吗？"),onOk(){var s,S;v.value=!1,(S=(s=_.value)==null?void 0:s.onCancel)==null||S.call(s,t)},onCancel(){}}):(v.value=!1,(r=(m=_.value)==null?void 0:m.onCancel)==null||r.call(m,t))},V=()=>{var t,m,r;i.value&&!((t=_.value)!=null&&t.destroyOnClose)&&((r=(m=i.value)==null?void 0:m.reset)==null||r.call(m))},R=async t=>{var m;const r=(m=e.onFinish)==null?void 0:m.call(e,t);if(e.submitTimeout&&r instanceof Promise){u.value=!0;const S=setTimeout(()=>{u.value=!1},e.submitTimeout);r.finally(()=>{clearTimeout(S),u.value=!1})}const s=await r;return s&&(e.closeOnFinish?v.value=!1:f.value=!1),s};return()=>b(W,null,[b(rt,x(_.value,{open:v.value,afterClose:()=>{var t,m;V(),f.value=!1,(m=(t=_.value)==null?void 0:t.afterClose)==null||m.call(t)},onCancel:t=>{e.submitTimeout&&u.value||p(t)}}),{default:()=>[b(Z,x(C.value,{submitter:g.value,onFinish:async t=>await R(t),onValuesChange:t=>{var m;e.confirmOnValuesChange&&(f.value=!0),(m=e.onValuesChange)==null||m.call(e,t)},onReset:()=>{var t;e.confirmOnValuesChange&&(f.value=!1),(t=e.onReset)==null||t.call(e)},onInit:(t,m)=>{var r;i.value=m,(r=e.onInit)==null||r.call(e,t,m)}}),w.value)],...E.value,footer:e.submitter!==!1?()=>b("div",{style:"display: flex; justify-content: flex-end;",ref:o},null):void 0}),h.value])}}),Ae;const Bt={xs:513,sm:513,md:785,lg:992,xl:1057,xxl:1/0},xe={vertical:[[513,1,"vertical"],[785,2,"vertical"],[1057,3,"vertical"],[1/0,4,"vertical"]],default:[[513,1,"vertical"],[701,2,"vertical"],[1062,3,"horizontal"],[1352,3,"horizontal"],[1/0,4,"horizontal"]]},Rt=(e="horizontal",n,l)=>{if(l&&typeof l=="number")return{span:l,layout:e};const u=((l?["xs","sm","md","lg","xl","xxl"].map(f=>[Bt[f],24/l[f],"horizontal"]):xe[e||"default"])||xe.default).find(f=>n<f[0]+16);return u?{span:24/u[1],layout:u?.[2]}:{span:8,layout:"horizontal"}},Vt=(e,n)=>e?.flatMap(l=>l.fieldType===Y.GROUP&&!l.title?l.props.children:n?{...l,rules:[],formItemProps:{...l.formItemProps,rules:[]}}:l),jt=at()?(Ae=document?.body)==null?void 0:Ae.clientWidth:1024;var Ce=N({name:"ProQueryFilter",inheritAttrs:!1,props:{...Ie()},emits:["collapse","resize"],setup(e,{slots:n,emit:l,expose:d,attrs:u}){const f=A(0),a=A(0),i=A(0),o=ae(),v=ne("query-filter"),C=He("wrapper"),w=A(),_=A([]),[E,g]=ee(jt),h=ke(w);Qe(C,c=>{const F=c[0],{width:O,height:B}=F?.contentRect||{};E.value!==O&&O>17&&g(O),l("resize",O,B)});const p=y(()=>Rt(e.layout,E.value+16,e.span)),V=y(()=>{if(e.defaultFormItemsNumber!==void 0)return e.defaultFormItemsNumber;if(e.defaultColsNumber!==void 0){const c=24/p.value.span-1;return e.defaultColsNumber>c?c:e.defaultColsNumber}return Math.max(1,24/p.value.span-1)}),R=y(()=>e.showHiddenNum&&_.value.filter(c=>c.hidden).length),t=y(()=>!(f.value<24||a.value<=V.value)),m=y(()=>{const c=i.value%24+p.value.span;return c>24?24-p.value.span:24-c}),r=y(()=>{if(e.labelWidth&&p.value.layout!=="vertical"&&e.labelWidth!=="auto")return{labelCol:{flex:`0 0 ${e.labelWidth}px`},wrapperCol:{style:{maxWidth:`calc(100% - ${e.labelWidth}px)`}},style:{flexWrap:"nowrap"}}}),[s,S]=ee(()=>e.defaultCollapsed,{value:y(()=>e.collapsed),onChange:c=>{l("collapse",c)}}),j=y(()=>({...I(T(e,["defaultCollapsed","collapsed","grid","showLoading","defaultColsNumber","searchGutter","submitOnLoading","preserve","submitter","ignoreRules","searchText","resetText","labelWidth","layout","items","gridSubmitter","rowProps","defaultFormItemsNumber","showHiddenNum","ignoreRules","onCollapse","onReset"]))})),P=y(()=>e.submitter===!1?!1:M({style:{justifyContent:"flex-end"},reverse:!0,searchConfig:{submitText:e.searchText||o.getMessage("form.search","搜索"),resetText:e.resetText||o.getMessage("form.reset","重置")},colProps:{span:p.value.span,offset:m.value}},e.submitter));return G([p,s,()=>e.items],()=>{var c;let F=!1;i.value=0,a.value=0,f.value=0,(c=e.items)!=null&&c.length?_.value=Vt(e.items,e.ignoreRules).map((O,B)=>{var D;const k=(D=O.colSize)!=null?D:1,K=Math.min(p.value.span*(k||1),24);f.value+=K,a.value+=k,B===0&&(F=K===24&&!O.hidden);const Pe=O.hidden||e.submitter!==!1&&s.value&&(F||a.value>V.value)&&!!B;return Pe?e.preserve?{...O,colProps:{span:K},hidden:!0}:{...O,colProps:{span:0},hidden:!0}:(24-i.value%24<K&&(f.value+=24-i.value%24,i.value+=24-i.value%24),i.value+=K,{...O,hidden:Pe,formItemProps:r.value,colProps:{span:K}})}):_.value=[]},{immediate:!0}),d({formRef:w,...h}),()=>b("div",x({class:`${v}-wrap`,ref:"wrapper"},u),[b(Z,x({ref:w,class:v},j.value,{grid:!0,gridSubmitter:!0,rowProps:{gutter:e.searchGutter,justify:"start",class:`${v}-row`},showLoading:!1,submitter:P.value,items:_.value,layout:p.value.layout,onReset:c=>{var F,O;e.resetOnSubmit&&((F=w.value)==null||F.submit()),(O=e.onReset)==null||O.call(e,c)}}),{...n,submitter:({defaultDoms:c})=>b(W,null,[c,t.value!==!1&&b("a",{class:`${v}-collapse-button`,onClick:()=>S(!s.value)},[s.value?o.getMessage("form.collapsed","展开"):o.getMessage("form.expand","收起"),!!R.value&&`(${R.value})`,b(tt,{style:{marginInlineStart:"0.5em",transition:"0.3s all",transform:`rotate(${s.value?0:.5}turn)`}},null)])])})])}});const Le=Symbol("StepsFormContextContext"),It=e=>{de(Le,e)},Tt=()=>ce(Le,{});var Dt=N({name:"StepForm",inheritAttrs:!1,props:{index:Number,...Q()},emits:[],setup(e,{slots:n}){const l=ne("steps-form"),d=A(),{step:u,regForm:f,onFormFinish:a,setLoading:i,next:o,lastStep:v}=Tt(),C=y(()=>e.index===u.value),w=y(()=>I(T(e,["index","onFinish"]))),_=async E=>{var g;if(e.name&&a(e.name,E),e.onFinish){i(!0),await((g=e.onFinish)==null?void 0:g.call(e,E))&&o(),i(!1);return}v.value||o()};return ve(()=>{f(d,e.index)}),()=>b("div",{class:{[`${l}-step`]:!0,[`${l}-step-active`]:C.value}},[b(Z,x({ref:d},w.value,{submitter:!1,onFinish:_}),n)])}});function H(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!fe(e)}const Nt={horizontal({stepsDom:e,formDom:n}){return b(W,null,[b(J,{gutter:{xs:8,sm:16,md:24}},{default:()=>[b(X,{span:24},H(e)?e:{default:()=>[e]})]}),b(J,{gutter:{xs:8,sm:16,md:24}},{default:()=>[b(X,{span:24},H(n)?n:{default:()=>[n]})]})])},vertical({stepsDom:e,formDom:n}){let l;return b(J,{align:"stretch",wrap:!0,gutter:{xs:8,sm:16,md:24}},{default:()=>[b(X,{xxl:4,xl:6,lg:7,md:8,sm:10,xs:12},H(l=be(e,{style:{height:"100%"}}))?l:{default:()=>[l]}),b(X,null,{default:()=>[b("div",{style:{display:"flex",alignItems:"center",width:"100%",height:"100%"}},[n])]})]})}};var pe=N({name:"ProStepsForm",inheritAttrs:!1,props:{...Te()},emits:[],setup(e,{slots:n}){const l=ae(),d=ne("steps-form"),u=A([]),f=new Map,[a,i]=mt(!1),o=y(()=>I(T(e,["name","current","stepsProps","containerStyle","onCurrentChange","steps","items","submitter","onFinish"]))),v=y(()=>{var c;return(c=e.steps)==null?void 0:c.map(F=>T(F,["formProps"]))}),[C,w]=ee(0,{value:y(()=>e.current),onChange:e.onCurrentChange}),_=(c,F)=>{u.value[F]=c},E=y(()=>C.value===e.steps.length-1),g=async(c,F)=>{if(f.set(c,F),!E.value||!e.onFinish)return;i(!0);const O=M({},...Array.from(f.values()));try{await e.onFinish(O)&&(w(0),u.value.forEach(D=>{var k;return(k=D.value)==null?void 0:k.reset()}))}catch(B){console.log(B)}finally{i(!1)}},h=()=>{var c;const F=u.value[C.value];F&&((c=F.value)==null||c.submit())},p=()=>{C.value<1||w(C.value-1)},V=y(()=>{var c;let F;return e.submitter!==!1&&b(ue,x({key:"next",type:"primary",loading:a.value},(c=e.submitter)==null?void 0:c.submitButtonProps,{onClick:()=>{h()}}),H(F=l.getMessage("stepsForm.next","下一步"))?F:{default:()=>[F]})}),R=y(()=>{var c;let F;return e.submitter!==!1&&b(ue,x({key:"pre"},(c=e.submitter)==null?void 0:c.resetButtonProps,{onClick:()=>{p()}}),H(F=l.getMessage("stepsForm.prev","上一步"))?F:{default:()=>[F]})}),t=y(()=>{var c;let F;return e.submitter!==!1&&b(ue,x({key:"submit",type:"primary",loading:a.value},(c=e.submitter)==null?void 0:c.submitButtonProps,{onClick:()=>{h()}}),H(F=l.getMessage("stepsForm.submit","提交"))?F:{default:()=>[F]})}),m=()=>{C.value>e.steps.length-2||w(C.value+1)},r=y(()=>{var c,F;const O=[],B=C.value||0;return B<1?((c=e.steps)==null?void 0:c.length)===1?O.push(t.value):O.push(V.value):B+1===((F=e.steps)==null?void 0:F.length)?O.push(R.value,t.value):O.push(R.value,V.value),O}),s=y(()=>{var c;return Nt[((c=e.stepsProps)==null?void 0:c.direction)||"horizontal"]}),S=y(()=>b("div",{class:`${d}-steps-container`,style:{maxWidth:Math.min(e.steps.length*320,1160)+"px"}},[b(lt,x(e.stepsProps,{items:v.value,current:C.value,onChange:void 0}),null)])),j=y(()=>b("div",{class:`${d}-container`,style:e.containerStyle},[e.items.map((c,F)=>{var O;const B=T(I(((O=e.steps[F])==null?void 0:O.formProps)||{}),["items"]),D=B.name||`${F}`,k=M({},o.value,B);return b(Dt,x({items:c,name:D,index:F},k),n)}),b(Ee,null,{default:()=>[r.value]})])),P=y(()=>{var c;const F={stepsDom:S.value,formDom:j.value};return(c=s.value)==null?void 0:c.call(s,F)});return It({step:C,loading:a,setLoading:i,lastStep:E,next:m,regForm:_,onFormFinish:g}),()=>b("div",{class:d},[P.value])}}),kt=N({name:"ProForm",inheritAttrs:!1,props:{layoutType:{type:String,default:"Form"},...ct()},setup(e,{slots:n,expose:l,attrs:d}){const u=A(),f=ke(u);return l(f),()=>{const{layoutType:a,items:i,...o}=e;return a==="DrawerForm"?b(Fe,x({ref:u},d,o,{items:i}),n):a==="ModalForm"?b(_e,x({ref:u},d,o,{items:i}),n):a==="QueryFilter"?b(Ce,x({ref:u},d,o,{items:i}),n):a==="StepForm"?b(pe,x({ref:u},d,o,{items:i}),n):b(Z,x({ref:u},d,o,{items:i}),n)}}});const Qt=ot(kt,{Drawer:Fe,Modal:_e,Filter:Ce,Steps:pe}),Xt=re(Fe),Yt=re(_e),Zt=re(Ce);re(pe);export{At as F,Y as P,ye as R,Qt as a,Yt as b,Xt as c,Zt as d,mt as e,Ne as f,je as g,ge as h,dt as i,_t as j,z as k,Ht as l,ft as m,he as p,ee as u};
