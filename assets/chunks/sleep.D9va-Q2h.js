const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/FormGroup.Bj-Khwaz.js","assets/chunks/FormTitle.D6RXbKhg.js","assets/chunks/framework.LW9JDvVy.js","assets/chunks/theme.Cp8dtnuj.js","assets/chunks/validate.EEzCsTff.js","assets/chunks/index.CWD1ate2.js","assets/chunks/index.DhK_34Wg.js","assets/chunks/install.BalIz2Dd.js","assets/chunks/index.Dw6vpUqL.js","assets/chunks/index.Dvj91dNc.js","assets/chunks/useIntl.DSpdslsC.js","assets/chunks/index.CQP-nMmT.js","assets/chunks/FormSet.BXPLU8Yx.js","assets/chunks/useFieldValue.BKUhYhfP.js","assets/chunks/FormList.Cfi-a0Cl.js","assets/chunks/FormListContext.wZgmYX6s.js","assets/chunks/FormItem.DlHvjo3W.js","assets/chunks/index.DALhAI8K.js"])))=>i.map(i=>d[i]);
import{P as We}from"./index.CWD1ate2.js";import{d as M,r as ze,w as $,c as ve,p as fe,f as A,s as te,o as me,e as g,F as W,v as Ke,k as y,a0 as V,an as ne,ao as ae,i as ge,u as Ue,h as He,J as Qe,E as Ve,aJ as Xe,a_ as Je}from"./framework.LW9JDvVy.js";import{m as L,a2 as q,H as G,J as U,a3 as ee,S as ce,B as Se,Q as Ye,i as Ze,F as et,O as tt,a4 as X,a5 as lt,M as Be,G as nt,a6 as at}from"./theme.Cp8dtnuj.js";import{d as Re,e as rt,a as de,f as ot}from"./validate.EEzCsTff.js";import{a as T,o as D,P as ie}from"./index.DhK_34Wg.js";import{u as re}from"./index.Dw6vpUqL.js";import{u as oe}from"./useIntl.DSpdslsC.js";import{P as ut}from"./index.CQP-nMmT.js";import{w as st,a as ue}from"./install.BalIz2Dd.js";function it(e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&delete e[t]}const je=Symbol("FormSlotsContext"),Ie=()=>ve(je,{});var ct=M({name:"FormSlotsContextProvider",inheritAttrs:!1,props:{value:{type:Object,default:()=>({})}},setup(e,{slots:t}){const l=ze({});return $(()=>e.value,()=>{it(l),Object.assign(l,e.value)},{immediate:!0}),fe(je,l),()=>{var s;return(s=t.default)==null?void 0:s.call(t)}}});const dt=()=>({layout:{type:String,default:"horizontal"},labelCol:{type:Object},wrapperCol:{type:Object},colon:{type:Boolean,default:!0},requiredMark:{type:[Boolean,String],default:!0},labelAlign:{type:String,default:"right"},labelWrap:Boolean,disabled:{type:Boolean,default:!1},prefixCls:String,validateMessages:Object,validateTrigger:{type:[String,Array],default:"change"},validateOnRuleChange:{type:Boolean,default:!0},scrollToFirstError:{type:[Boolean,Object],default:!1},name:String}),Yt=()=>({value:{type:[String,Array,Number,Object,Boolean]},readonly:{type:Boolean,default:void 0},readonlyProps:{type:Object,default:void 0},valueEnum:{type:[Function,Object],default:void 0},options:{type:[Array,Function],default:void 0},request:{type:Function,default:void 0},params:{type:[Function,Object],default:void 0},dependencies:{type:Array,default:void 0},onChange:{type:Function}}),Q=()=>({...dt(),loading:{type:Boolean,default:void 0},showLoading:{type:Boolean,default:!0},submitOnLoading:{type:Boolean,default:!0},gridSubmitter:{type:Boolean,default:!1},omitNil:{type:Boolean,default:!0},readonly:Boolean,grid:Boolean,isKeyPressSubmit:Boolean,formKey:String,theme:{type:String,default:"custom"},customUi:{type:Boolean,default:!0},initialValues:{type:Object},readonlyProps:{type:Object},colProps:{type:Object},rowProps:{type:Object},dateFormatter:{type:[String,Function,Boolean],default:"string"},params:{type:Object},items:{type:Array},request:{type:Function},requestAbort:{type:Boolean},submitter:{type:[Object,Boolean],default:void 0},onReset:{type:Function},onFinish:{type:Function},onFinishFailed:{type:Function},onLoadingChange:{type:Function},onValuesChange:{type:Function},onInit:{type:Function,default:void 0}}),ye=()=>({...Q(),submitTimeout:{type:Number,default:void 0},title:{type:String,default:void 0},width:{type:[String,Number],default:800},open:{type:Boolean,default:void 0},closeOnFinish:{type:Boolean,default:!0},confirmOnValuesChange:{type:Boolean,default:!0},onOpenChange:{type:Function,default:void 0}}),Te=()=>({...Q(),preserve:{type:Boolean,default:!0},defaultCollapsed:{type:Boolean,default:!0},collapsed:{type:Boolean,default:void 0},defaultColsNumber:Number,defaultFormItemsNumber:Number,labelWidth:{type:[String,Number],default:"80"},searchText:String,resetText:String,searchGutter:{type:Number,default:24},span:{type:[Number,Object]},showHiddenNum:Boolean,ignoreRules:Boolean,resetOnSubmit:Boolean,onCollapse:{type:Function,default:void 0},onResize:{type:Function,default:void 0}}),De=()=>({...Q(),current:{type:Number,default:void 0},steps:{type:Array,default:()=>[]},items:{type:Array,default:()=>[]},stepsProps:{type:Object},containerStyle:{type:Object},onCurrentChange:{type:Function,default:void 0}}),vt=()=>({...Q(),...ye(),...Te(),...De(),items:{type:Array,default:()=>[]}});function ft(e,t){return e?Re(e)&&e.startsWith("::")?t[e.substring(2)]:e:null}const Ne=Symbol("FormContext"),mt=e=>{fe(Ne,e)},be=()=>ve(Ne,{}),ke=(e,{slots:t})=>{var l;return(l=t.default)==null?void 0:l.call(t)};ke.displayName="RenderSlot";ke.inheritAttrs=!1;const he=(e,{slots:t})=>{var l,s,u;return typeof e.vnode=="function"?((l=e.vnode)==null?void 0:l.call(e,e.props||{}))||((s=t.default)==null?void 0:s.call(t)):e.vnode||((u=t.default)==null?void 0:u.call(t))};he.props=["vnode","props"];he.inheritAttrs=!1;function gt(e){const t=A(null);return async(s,u)=>{var o,a;(o=t.value)==null||o.abort();const b=new AbortController;return t.value=b,await Promise.race([(a=e.request)==null?void 0:a.call(e,s,u),new Promise((c,S)=>{var C,_;(_=(C=t.value)==null?void 0:C.signal)==null||_.addEventListener("abort",()=>{S(new Error("aborted"))})})])}}function yt(e,...t){return typeof e=="function"?e(...t):e}function bt(e){const t=typeof e=="function"?e():e,l=A(t);function s(u){l.value=u}return[l,s]}var J=(e=>(e.FORM_SET="formSet",e.FORM_LIST="formList",e.GROUP="group",e.DIVIDER="divider",e.TEXT="text",e.DIGIT="digit",e.DIGIT_RANGE="digitRange",e.SELECT="select",e.TREE_SELECT="treeSelect",e.CASCADER="cascader",e.TEXTAREA="textarea",e.PASSWORD="password",e.CHECKBOX="checkbox",e.CHECKBOX_GROUP="checkboxGroup",e.RADIO_GROUP="radioGroup",e.SWITCH="switch",e.SLIDER="slider",e.RATE="rate",e.DATE="date",e.DATE_RANGE="dateRange",e.TIME="time",e.TIME_RANGE="timeRange",e.UPLOAD_BUTTON="uploadButton",e.UPLOAD_DRAGGER="uploadDragger",e.UPLOAD_PICTURE="uploadPicture",e.UPLOAD_PICTURE_LIST="uploadPictureList",e.EDITOR="editor",e))(J||{});function Me(e){return{getFieldValue:P=>{var m;return(m=e.value)==null?void 0:m.getFieldValue(P)},getFieldsValue:P=>{var m;return(m=e.value)==null?void 0:m.getFieldsValue(P)},resetInitialValues:P=>{var m;return(m=e.value)==null?void 0:m.resetInitialValues(P)},getFieldFormatValue:P=>{var m;return(m=e.value)==null?void 0:m.getFieldFormatValue(P)},getFieldFormatValueObject:P=>{var m;return(m=e.value)==null?void 0:m.getFieldFormatValueObject(P)},validateFieldsReturnFormatValue:P=>{var m;return(m=e.value)==null?void 0:m.validateFieldsReturnFormatValue(P)},setFieldValue:(P,m)=>{var w;return(w=e.value)==null?void 0:w.setFieldValue(P,m)},setFieldsValue:(P,m=!0)=>{var w;return(w=e.value)==null?void 0:w.setFieldsValue(P,m)},resetField:P=>{var m;return(m=e.value)==null?void 0:m.resetField(P)},clearValidate:P=>{var m;return(m=e.value)==null?void 0:m.clearValidate(P)},validateFields:P=>{var m;return(m=e.value)==null?void 0:m.validateFields(P)},reset:()=>{var P;return(P=e.value)==null?void 0:P.reset()},submit:()=>{var P;return(P=e.value)==null?void 0:P.submit()}}}const ht=e=>{const t=A(!0),l=A(!1),s=te({...e.initialValues}),u=gt({request:e.request});return me(async()=>{var o;if(e.request&&!e.requestAbort){t.value=!0,l.value=!0;const a=await u(e.params);s.value=(o=L({},s.value,a))!=null?o:{},Promise.resolve().then(()=>{t.value=!1,l.value=!1})}}),{initialValues:s,hasInitial:t,requestLoading:l}},Ft=()=>{const e=te([]),t=te([]),l=g(()=>e.value.map(r=>r.split(":")[1])),s=(r,c,S)=>{Array.isArray(S)||(S=[S]);const C=r.filter(_=>!_.startsWith(c+":"));return C.push(...S.map(_=>`${c}:${_}`)),Array.from(new Set(C))},u=(r,c)=>{e.value=s(e.value,r,c)},o=(r,c)=>{t.value=s(t.value,r,c)},a=g(()=>e.value.filter(r=>!l.value.includes(r.split(":")[0])).map(r=>r.split(":")[1])),b=g(()=>t.value.filter(r=>!l.value.includes(r.split(":")[0])).map(r=>r.split(":")[1]));return{allHiddenKeys:a,hiddenKeys:e,allDisabledKeys:b,disabledKeys:t,updateHiddenKeys:u,updateDisabledKeys:o}},z=e=>{if(e)return Re(e)?e.indexOf(".")>-1?e.split("."):[e]:e};function Le(e){return Array.isArray(e)&&e.length===1&&(e=e[0]),e?.__v_isVNode&&typeof e.type!="symbol"}function _t(e){return e&&(e.type===Comment||e.type===W&&e.children.length===0||e.type===Text&&e.children.trim()==="")}function se(e=[]){const t=[];return e.forEach(l=>{Array.isArray(l)?t.push(...l):l?.type===W?t.push(...se(l.children)):t.push(l)}),t.filter(l=>!_t(l)&&Le(l))}function Fe(e,t={},l=!0,s=!1){let u=e;if(Array.isArray(e)&&(u=se(e)[0]),!u)return null;const o=Ke(u,t,s);return o.props=l?{...o.props,...t}:o.props,o}function pt(e){return typeof e!="object"?!1:e===null?!0:!(Le(e)||e.constructor===RegExp||e instanceof Map||e instanceof Set||e instanceof HTMLElement||e instanceof Blob||e instanceof File||Array.isArray(e))}const K=(e,t,l)=>{if(Object.keys(e).length<1||typeof window>"u"||typeof e!="object"||rt(e)||e instanceof Blob)return e;let s=Array.isArray(e)?[]:{};const u=(o,a)=>{let r=Array.isArray(o)?[]:{};return o==null||o===void 0?r:(Object.keys(o).forEach(c=>{var S;const C=(m,w)=>(Array.isArray(m)&&m.forEach((O,R)=>{if(!O)return;const n=w?.[R];typeof O=="function"&&(w[R]=O(w,c,o)),typeof O=="object"&&!Array.isArray(O)&&Object.keys(O).forEach(d=>{const p=n?.[d];if(typeof O[d]=="function"&&p){const i=O[d](n[d],c,o);n[d]=typeof i=="object"?i[d]:i}else typeof O[d]=="object"&&Array.isArray(O[d])&&p&&C(O[d],p)}),typeof O=="object"&&Array.isArray(O)&&n&&C(O,n)}),c),_=o[c],x=(S=t.get(c))==null?void 0:S.transform,P=()=>{let m,w,O=!1;if(typeof x=="function"){w=x?.(_,c,o);const R=typeof w;R!=="object"&&R!=="undefined"?(m=c,O=!0):m=w}else m=C(x,_);if(Array.isArray(m)){r=G(r,m,_);return}typeof m=="object"&&!Array.isArray(s)?s=L(s,m):typeof m=="object"&&Array.isArray(s)?r={...r,...m}:(m!==null||m!==void 0)&&(r=G(r,[m],O?w:_))};if(x&&typeof x=="function"&&P(),!(typeof window>"u")){if(pt(_)){const m=u(_);if(Object.keys(m).length<1)return;r=G(r,[c],m);return}P()}}),l?r:o)};return s=Array.isArray(e)&&Array.isArray(s)?[...u(e)]:L({},u(e),s),s},qe=(e,t)=>{if(Object.keys(e).length<1)return e;const l={};return Object.keys(e).forEach(s=>{var u;const o=e[s],a=(u=t.get(s))==null?void 0:u.convertValue;if(typeof a=="function"){const b=a?.(o,s);l[s]=b}else l[s]=o}),l};function Ct({props:e,formRef:t,formData:l,initialValues:s,hasInitial:u,transformerMap:o,onFinish:a,onReset:b,onFinishFailed:r}){const c=i=>{const h=z(i);if(!h)throw new Error("name is require");return U(l.value,h)},S=i=>{if(i===!0||i===void 0)return q(l.value);const h={};return i.forEach(j=>{const I=z(j),f=U(l.value,I);f!==void 0&&G(h,I,f)}),h},C=i=>{const h=z(i);if(!h)throw new Error("name is require");const j=U(l.value,h),I=G({},h,j);return U(K(I,o.value,e.omitNil),h)},_=i=>{const h=z(i);if(!h)throw new Error("name is require");const j=U(l.value,h),I=G({},h,j);return K(I,o.value,e.omitNil)},x=async i=>{var h;if(!Array.isArray(i)&&i)throw new Error("nameList must be array");const j=await((h=t.value)==null?void 0:h.validateFields(i)),I=K(j,o.value,e.omitNil);return I??{}},P=(i,h)=>{const j=z(i);if(!j)throw new Error("name is require");G(l.value,j,h)},m=(i,h=!0)=>{if(!i)throw new Error("values is require");h?l.value=L({},l.value,i):l.value=q(i)},w=i=>{if(!i)throw new Error("values is require");if(!de(i))throw new Error("values must be object");u.value=!0,s.value=q(i)},O=()=>{var i;u.value=!0,(i=t.value)==null||i.clearValidate(),l.value=q(qe(s.value,o.value)),Promise.resolve().then(()=>{u.value=!1,b?.(K(l.value,o.value,e.omitNil))})},R=i=>{var h;if(!z(i))throw new Error("name is require");(h=t.value)==null||h.clearValidate(i),G(l.value,i,q(U(s.value,i)))},n=i=>{var h;(h=t.value)==null||h.clearValidate(i)},d=i=>new Promise((h,j)=>{var I;(I=t.value)==null||I.validateFields(i).then(f=>{h({...l.value,...f})}).catch(f=>{j(f)})});return{getFieldValue:c,getFieldsValue:S,resetInitialValues:w,getFieldFormatValue:C,getFieldFormatValueObject:_,validateFieldsReturnFormatValue:x,setFieldValue:P,setFieldsValue:m,resetField:R,clearValidate:n,validateFields:d,reset:O,submit:()=>{d().then(i=>{if(a)try{a(i)}catch(h){console.error(h)}}).catch(i=>{r&&r(i)})}}}var Pt=M({name:"FormRowWrapper",inheritAttrs:!1,props:{rowProps:{type:Object,default:void 0},grid:{type:Boolean,default:void 0}},setup(e,{slots:t,attrs:l}){const{rowProps:s,grid:u}=be(),o=g(()=>{var b;return(b=e.grid)!=null?b:u?.value}),a=g(()=>{var b;return(b=e.rowProps)!=null?b:s?.value});return()=>{var b;return o?.value?y(ee,V(a.value,{class:l.class}),{default:()=>{var r;return[(r=t.default)==null?void 0:r.call(t)]}}):(b=t.default)==null?void 0:b.call(t)}}});function _e(e,t){const l={};return Array.isArray(t)&&t.length>0&&Object.keys(e||{}).forEach(s=>{t.includes(s)&&(l[s]=e[s])}),l}const wt=ne(()=>ae(()=>import("./FormGroup.Bj-Khwaz.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),St=ne(()=>ae(()=>import("./FormSet.BXPLU8Yx.js"),__vite__mapDeps([12,13,3,2,1,6,4,7,8,5,9,10,11]))),Ot=ne(()=>ae(()=>import("./FormList.Cfi-a0Cl.js"),__vite__mapDeps([14,15,2,1,3,13,6,4,7,8,5,9,10,11]))),At=ne(()=>ae(()=>import("./FormItem.DlHvjo3W.js"),__vite__mapDeps([16,13,3,2,15,17,10,8,7,6,4,11,9,1,5]))),xt=["min","max","isValidateList","emptyListMessage","creatorRecord","creatorButtonProps","alwaysShowItemLabel","actionGuard","copyIconProps","deleteIconProps","onAfterAdd","onAfterRemove"],Et=["action","creator","item"];var Vt=M({name:"FormItems",inheritAttrs:!1,props:{list:{type:Array,default:()=>[]},type:{type:String,default:""},grid:{type:Boolean,default:void 0},spaceProps:{type:Object,default:()=>({size:[32,0],wrap:!0})}},setup(e){const{grid:t,allHiddenKeys:l}=be(),s=Ie(),u=g(()=>{var a;return(a=e.grid)!=null?a:t?.value}),o=g(()=>e.list.filter(a=>!l.value.includes(a.key)).map(a=>{var b;if(a.fieldType===J.GROUP)return y(wt,{key:a.key,items:a.children,title:a.title,tooltip:a.tooltip,colProps:a.colProps,rowProps:a.rowProps,spaceProps:a.spaceProps,grid:a.grid,item:a,formItemProps:a.formItemProps},null);if(a.fieldType===J.FORM_SET)return y(St,{key:a.key,name:a.name,items:a.children,title:a.title,tooltip:a.tooltip,colProps:a.colProps,rowProps:a.rowProps,spaceProps:a.spaceProps,formItemProps:a.formItemProps,initialValue:a.initialValue,convertValue:a.convertValue,transform:a.transform},null);if(a.fieldType===J.FORM_LIST){const r=T(_e((b=a.fieldProps)!=null?b:{},xt)),c={};return Et.forEach(S=>{var C;const _=ft((C=a.fieldProps)==null?void 0:C[`${S}Render`],s);_&&(c[S]=x=>y(he,{vnode:_,props:x},null))}),y(Ot,V({key:a.key,name:a.name,originName:a.originName,items:a.children,title:a.title,tooltip:a.tooltip,rules:a.rules,colProps:a.colProps,rowProps:a.rowProps,formItemProps:a.formItemProps,initialValue:a.initialValue,convertValue:a.convertValue,transform:a.transform},r),{...c})}return y(At,{key:a.key,item:a,grid:u.value},null)}));return()=>e.type==="space"&&!u?.value?y(ce,V(e.spaceProps,{align:"start"}),{default:()=>[o.value]}):o.value}});function Oe(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!ge(e)}var Bt=M({name:"FormSubmitter",inheritAttrs:!1,props:{loading:{type:Boolean,default:void 0},reverse:{type:Boolean,default:void 0},onSubmit:{type:Function,default:void 0},onReset:{type:Function,default:void 0},searchConfig:{type:Object,default:void 0},submitButtonProps:{type:[Object,Boolean],default:void 0},resetButtonProps:{type:[Object,Boolean],default:void 0},render:{type:[Function,Boolean],default:void 0}},setup(e,{attrs:t}){const{action:l}=be(),s=Ie(),u=async()=>{var r;if(!e.onSubmit){l.submit();return}const c=l.getFieldsValue(),C=await((r=e.onSubmit)==null?void 0:r.call(e,c,l));return C&&l.submit(),C},o=async()=>{var r;if(!e.onReset){l.reset();return}const c=l.getFieldsValue(),C=await((r=e.onReset)==null?void 0:r.call(e,c,l));return C&&l.reset(),C},a=g(()=>{const{searchConfig:r={},resetButtonProps:c={}}=e;if(c===!1)return null;const{resetText:S="重置"}=r;return y(Se,V(D(c,["preventDefault","onClick"]),{key:"reset",onClick:C=>{var _;c.preventDefault||o(),(_=c.onClick)==null||_.call(c,C)}}),Oe(S)?S:{default:()=>[S]})}),b=g(()=>{const{searchConfig:r={},submitButtonProps:c={}}=e;if(c===!1)return null;const{submitText:S="提交"}=r;return y(Se,V({type:"primary"},D(c||{},["preventDefault","onClick"]),{key:"submit",onClick:C=>{var _;c.preventDefault||u(),(_=c.onClick)==null||_.call(c,C)}}),Oe(S)?S:{default:()=>[S]})});return()=>{if(e.render===!1)return null;const{render:r=s.submitter}=e,c=e.reverse?y(W,null,[a.value,b.value]):y(W,null,[b.value,a.value]),S=r?r({props:{...e,submit:u,reset:o},action:l,defaultDoms:c}):c;return y("div",{style:{display:"flex",gap:"8px",alignItems:"center",...t.style},class:t.class},[S])}}});function Rt(e){const t=new Map,l=s=>{s.forEach(u=>{var o;if(u.name&&(u.transform||u.convertValue))t.set(u.name,{transform:u.transform,convertValue:u.convertValue});else if(u.children){const a=(o=yt(u.children))!=null?o:[];l(a)}})};return l(e),t}function le(e,t){const{defaultValue:l,value:s=A()}=t||{};let u=typeof e=="function"?e():e;s.value!==void 0&&(u=Ue(s)),l!==void 0&&(u=typeof l=="function"?l():l);const o=A(u),a=A(u);He(()=>{let r=s.value!==void 0?s.value:o.value;t?.postState&&(r=t.postState(r)),a.value=r});function b(r){const c=a.value;o.value=r,Qe(a.value)!==r&&t?.onChange&&t?.onChange(r,c)}return $(s,()=>{o.value=s.value}),[a,b]}function jt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!ge(e)}let Ae=0;var Y=M({name:"BaseForm",inheritAttrs:!1,props:{...Q()},setup(e,{slots:t,expose:l,attrs:s}){const u=A(!1),o=te(new Map),a=A(),b=re("form"),r=A({}),c=A([]),S=g(()=>{var f;return(f=e.formKey)!=null?f:Ae.toString()}),[C,_]=le(!1,{value:g(()=>e.loading),onChange:f=>{var v;(v=e.onLoadingChange)==null||v.call(e,f)}}),x=g(()=>{var f;return{[b]:!0,[`${(f=s.class)!=null?f:""}`]:!0}}),P=g(()=>{var f;return{...T(D(e,["colProps","submitter","loading","showLoading","omitNil","grid","theme","customUi","gridSubmitter","requestAbort","isKeyPressSubmit","formKey","initialValues","rowProps","dateFormatter","params","readonly","readonlyProps","items","request","submitOnLoading","onLoadingChange","onFinish","onValuesChange"])),layout:(f=e.layout)!=null?f:"vertical"}}),m=f=>f.filter(v=>!v.hidden).sort((v,F)=>{var E,B;return F.order||v.order?((E=F.order)!=null?E:0)-((B=v.order)!=null?B:0):0}).map((v,F)=>{var E,B;const N=z(v.name),k=(E=v.key)!=null?E:N?(N??[]).join("_"):F;return T({...v,originName:(B=v.originName)!=null?B:v.name,name:N,key:k})}).filter(v=>!!v);$(()=>e.items,()=>{var f,v;o.value=Rt((f=e.items)!=null?f:[]),c.value=m((v=e.items)!=null?v:[])},{immediate:!0});const{initialValues:w,hasInitial:O,requestLoading:R}=ht(e);$(w,(f,v)=>{Ze(f,v)||(r.value=q(qe(f,o.value)),(!e.request||e.requestAbort)&&Promise.resolve().then(()=>{O.value=!1}))},{immediate:!0});const n=Ye(()=>{var f;(f=e.onValuesChange)==null||f.call(e,K(q(r.value),o.value,e.omitNil))},200),d=async()=>{if(e.onFinish){if(e.submitOnLoading){if(C.value)return;_(!0)}try{const f=K(q(r.value),o.value,e.omitNil);await e.onFinish(f)}catch(f){console.log("🚀 ~ onFinish ~ error:",f)}finally{e.submitOnLoading&&_(!1)}}};$(r,()=>{O.value||n()},{deep:!0});const p=Ft(),i=Ct({props:e,formRef:a,formData:r,initialValues:w,hasInitial:O,transformerMap:o,onFinish:d,onReset:e.onReset,onFinishFailed:e.onFinishFailed}),h=g(()=>typeof e.submitter=="boolean"||!e.submitter?{}:D(e.submitter,["colProps"])),j=g(()=>e.submitter===!1||e.readonly?{}:e.gridSubmitter&&de(e.submitter)&&de(e.submitter.colProps)?{...e.submitter.colProps}:{span:24}),I=g(()=>{if(e.submitter===!1||e.readonly)return;const f=h.value.submitButtonProps===!1?!1:{loading:C.value,...h.value.submitButtonProps},v=h.value.resetButtonProps===!1?!1:{disabled:C.value,...h.value.resetButtonProps},F=y(Bt,V({key:"submitter"},h.value,{submitButtonProps:f,resetButtonProps:v}),null);return h.value.teleport?y(Ve,{defer:!0,to:h.value.teleport},jt(F)?F:{default:()=>[F]}):F});return me(()=>{var f,v,F;u.value=!0,Ae+=1;const E=(F=(v=(f=a.value)==null?void 0:f.getFieldsValue)==null?void 0:v.call(f,!0))!=null?F:{};Promise.resolve().then(()=>{var B;(B=e.onInit)==null||B.call(e,K(E,o.value,e.omitNil),i)})}),mt({...p,action:i,formKey:S,mountedRef:u,prefixCls:b,initialValues:w,formData:r,hasInitial:O,theme:g(()=>e.theme),customUi:g(()=>e.customUi),grid:g(()=>e.grid),disabled:g(()=>e.disabled),readonly:g(()=>e.readonly),readonlyProps:g(()=>e.readonlyProps),rowProps:g(()=>{var f;return(f=e.rowProps)!=null?f:{gutter:16}}),colProps:g(()=>{var f;return(f=e.colProps)!=null?f:{xs:24}}),formatItems:m}),l({...i}),()=>y(ct,{value:{...t}},{default:()=>[y(et,V({ref:a},P.value,{class:x.value,model:r.value,style:s.style}),{default:()=>[y(tt,{spinning:e.showLoading&&(R.value||C.value)},{default:()=>[y(Pt,null,{default:()=>[y(Vt,{list:c.value},null),e.gridSubmitter&&e.submitter!==!1&&y(X,j.value,{default:()=>[y(lt,{label:" ",colon:!1,class:`${b}-submitter-form-item`},{default:()=>[I.value]})]})]}),!e.gridSubmitter&&I.value]})]})]})}}),pe=M({name:"ProDrawerForm",inheritAttrs:!1,props:{...ye(),drawerProps:{type:Object,default:void 0}},emits:["update:open"],setup(e,{slots:t,emit:l}){const s=A(!1),u=A(!1),o=A(!1),a=oe(),b=A(),r=A(null),c=g({get:()=>{var n;return(n=e.open)!=null?n:s.value},set:n=>{typeof e.open>"u"?s.value=n:l("update:open",n)}});$(c,()=>{var n;(n=e.onOpenChange)==null||n.call(e,c.value)});const S=g(()=>({...T(D(e,["onOpenChange","closeOnFinish","drawerProps","title","width","onInit","confirmOnValuesChange","submitTimeout","onFinish","submitter"])),layout:"vertical"})),C=g(()=>({...T(D(t,["trigger","closeIcon","extra","footer","title"]))})),_=g(()=>{var n;return T({...D((n=e.drawerProps)!=null?n:{},["title","width","open","footer","okText","cancelText"]),width:e.width,title:e.title})}),x=g(()=>({...T(_e(t,["closeIcon","extra","title"]))})),P=g(()=>{var n,d,p,i;return e.submitter===!1?!1:L({teleport:r.value,reverse:!0,searchConfig:{submitText:(d=(n=e.drawerProps)==null?void 0:n.okText)!=null?d:a.getMessage("confirm.okText","确认"),resetText:(i=(p=e.drawerProps)==null?void 0:p.cancelText)!=null?i:a.getMessage("confirm.cancelText","取消")},resetButtonProps:{preventDefault:!0,disabled:e.submitTimeout?u.value:void 0,onClick:h=>{w(h)}}},e.submitter)}),m=g(()=>{if(!t.trigger)return null;const n=se(t.trigger())[0];return Fe(n,{key:"trigger",...n?.props,onClick:async d=>{var p,i;c.value=!c.value,(i=(p=n?.props)==null?void 0:p.onClick)==null||i.call(p,d)}})}),w=n=>{var d,p;e.confirmOnValuesChange&&o.value?Be.confirm({title:a.getMessage("confirm.title","提示"),content:a.getMessage("confirm.formModalCloseContent","您的表单还没有保存，您确定关闭吗？"),onOk(){var i,h;c.value=!1,(h=(i=_.value)==null?void 0:i.onClose)==null||h.call(i,n)},onCancel(){}}):(c.value=!1,(p=(d=_.value)==null?void 0:d.onClose)==null||p.call(d,n))},O=()=>{var n,d,p;b.value&&!((n=_.value)!=null&&n.destroyOnClose)&&((p=(d=b.value)==null?void 0:d.reset)==null||p.call(d))},R=async n=>{var d;const p=(d=e.onFinish)==null?void 0:d.call(e,n);if(e.submitTimeout&&p instanceof Promise){u.value=!0;const h=setTimeout(()=>{u.value=!1},e.submitTimeout);p.finally(()=>{clearTimeout(h),u.value=!1})}const i=await p;return i&&(e.closeOnFinish?c.value=!1:o.value=!1),i};return()=>y(W,null,[y(We,V(_.value,{open:c.value,onAfterOpenChange:n=>{var d,p;n||O(),o.value=!1,(p=(d=_.value)==null?void 0:d.onAfterOpenChange)==null||p.call(d,n)},onClose:n=>{e.submitTimeout&&u.value||w(n)}}),{default:()=>[y(Y,V(S.value,{submitter:P.value,onFinish:async n=>await R(n),onValuesChange:n=>{var d;e.confirmOnValuesChange&&(o.value=!0),(d=e.onValuesChange)==null||d.call(e,n)},onReset:()=>{var n;e.confirmOnValuesChange&&(o.value=!1),(n=e.onReset)==null||n.call(e)},onInit:(n,d)=>{var p;b.value=d,(p=e.onInit)==null||p.call(e,n,d)}}),C.value)],...x.value,footer:e.submitter!==!1?()=>y("div",{style:"display: flex; justify-content: flex-end;",ref:r},null):void 0}),m.value])}}),Ce=M({name:"ProModalForm",inheritAttrs:!1,props:{...ye(),modalProps:{type:Object,default:void 0}},emits:["update:open"],setup(e,{slots:t,emit:l}){const s=A(!1),u=A(!1),o=A(!1),a=oe(),b=A(),r=A(null),c=g({get:()=>{var n;return(n=e.open)!=null?n:s.value},set:n=>{typeof e.open>"u"?s.value=n:l("update:open",n)}});$(c,()=>{var n;(n=e.onOpenChange)==null||n.call(e,c.value)});const S=g(()=>{var n;return{...T(D(e,["onInit","onOpenChange","closeOnFinish","modalProps","title","width","confirmOnValuesChange","submitTimeout","onFinish","submitter"])),layout:(n=e.layout)!=null?n:"vertical"}}),C=g(()=>({...T(D(t,["trigger","closeIcon","extra","footer","title"]))})),_=g(()=>{var n;return T({...D((n=e.modalProps)!=null?n:{},["title","width","footer"]),width:e.width,title:e.title,footer:e.submitter===!1?null:void 0})}),x=g(()=>({...T(_e(t,["closeIcon","title"]))})),P=g(()=>{var n,d,p,i;return e.submitter===!1?!1:L({teleport:r.value,reverse:!0,searchConfig:{submitText:(d=(n=_.value)==null?void 0:n.okText)!=null?d:a.getMessage("confirm.okText","确认"),resetText:(i=(p=_.value)==null?void 0:p.cancelText)!=null?i:a.getMessage("confirm.cancelText","取消")},resetButtonProps:{preventDefault:!0,disabled:e.submitTimeout?u.value:void 0,onClick:h=>{w(h)}}},e.submitter)}),m=g(()=>{if(!t.trigger)return null;const n=se(t.trigger())[0];return Fe(n,{key:"trigger",...n?.props,onClick:async d=>{var p,i;c.value=!c.value,(i=(p=n?.props)==null?void 0:p.onClick)==null||i.call(p,d)}})}),w=n=>{var d,p;e.confirmOnValuesChange&&o.value?Be.confirm({title:a.getMessage("confirm.title","提示"),content:a.getMessage("confirm.formModalCloseContent","您的表单还没有保存，您确定关闭吗？"),onOk(){var i,h;c.value=!1,(h=(i=_.value)==null?void 0:i.onCancel)==null||h.call(i,n)},onCancel(){}}):(c.value=!1,(p=(d=_.value)==null?void 0:d.onCancel)==null||p.call(d,n))},O=()=>{var n,d,p;b.value&&!((n=_.value)!=null&&n.destroyOnClose)&&((p=(d=b.value)==null?void 0:d.reset)==null||p.call(d))},R=async n=>{var d;const p=(d=e.onFinish)==null?void 0:d.call(e,n);if(e.submitTimeout&&p instanceof Promise){u.value=!0;const h=setTimeout(()=>{u.value=!1},e.submitTimeout);p.finally(()=>{clearTimeout(h),u.value=!1})}const i=await p;return i&&(e.closeOnFinish?c.value=!1:o.value=!1),i};return()=>y(W,null,[y(ut,V(_.value,{open:c.value,afterClose:()=>{var n,d;O(),o.value=!1,(d=(n=_.value)==null?void 0:n.afterClose)==null||d.call(n)},onCancel:n=>{e.submitTimeout&&u.value||w(n)}}),{default:()=>[y(Y,V(S.value,{submitter:P.value,onFinish:async n=>await R(n),onValuesChange:n=>{var d;e.confirmOnValuesChange&&(o.value=!0),(d=e.onValuesChange)==null||d.call(e,n)},onReset:()=>{var n;e.confirmOnValuesChange&&(o.value=!1),(n=e.onReset)==null||n.call(e)},onInit:(n,d)=>{var p;b.value=d,(p=e.onInit)==null||p.call(e,n,d)}}),C.value)],...x.value,footer:e.submitter!==!1?()=>y("div",{style:"display: flex; justify-content: flex-end;",ref:r},null):void 0}),m.value])}}),xe;const It={xs:513,sm:513,md:785,lg:992,xl:1057,xxl:1/0},Ee={vertical:[[513,1,"vertical"],[785,2,"vertical"],[1057,3,"vertical"],[1/0,4,"vertical"]],default:[[513,1,"vertical"],[701,2,"vertical"],[1062,3,"horizontal"],[1352,3,"horizontal"],[1/0,4,"horizontal"]]},Tt=(e="horizontal",t,l)=>{if(l&&typeof l=="number")return{span:l,layout:e};const u=((l?["xs","sm","md","lg","xl","xxl"].map(o=>[It[o],24/l[o],"horizontal"]):Ee[e||"default"])||Ee.default).find(o=>t<o[0]+16);return u?{span:24/u[1],layout:u?.[2]}:{span:8,layout:"horizontal"}},Dt=(e,t)=>e?.flatMap(l=>l.fieldType===J.GROUP&&!l.title?l.props.children:t?{...l,rules:[],formItemProps:{...l.formItemProps,rules:[]}}:l),Nt=ot()?(xe=document?.body)==null?void 0:xe.clientWidth:1024;var Pe=M({name:"ProQueryFilter",inheritAttrs:!1,props:{...Te()},emits:["collapse","resize"],setup(e,{slots:t,emit:l,expose:s,attrs:u}){const o=A(0),a=A(0),b=A(0),r=oe(),c=re("query-filter"),S=Xe("wrapper"),C=A(),_=A([]),[x,P]=le(Nt),m=Me(C);Je(S,f=>{const v=f[0],{width:F,height:E}=v?.contentRect||{};x.value!==F&&F>17&&P(F),l("resize",F,E)});const w=g(()=>Tt(e.layout,x.value+16,e.span)),O=g(()=>{if(e.defaultFormItemsNumber!==void 0)return e.defaultFormItemsNumber;if(e.defaultColsNumber!==void 0){const f=24/w.value.span-1;return e.defaultColsNumber>f?f:e.defaultColsNumber}return Math.max(1,24/w.value.span-1)}),R=g(()=>e.showHiddenNum&&_.value.filter(f=>f.hidden).length),n=g(()=>!(o.value<24||a.value<=O.value)),d=g(()=>{const f=b.value%24+w.value.span;return f>24?24-w.value.span:24-f}),p=g(()=>{if(e.labelWidth&&w.value.layout!=="vertical"&&e.labelWidth!=="auto")return{labelCol:{flex:`0 0 ${e.labelWidth}px`},wrapperCol:{style:{maxWidth:`calc(100% - ${e.labelWidth}px)`}},style:{flexWrap:"nowrap"}}}),[i,h]=le(()=>e.defaultCollapsed&&e.submitter!==!1,{value:g(()=>e.collapsed),onChange:f=>{l("collapse",f)}}),j=g(()=>({...T(D(e,["defaultCollapsed","collapsed","grid","showLoading","defaultColsNumber","searchGutter","submitOnLoading","preserve","submitter","ignoreRules","searchText","resetText","labelWidth","layout","items","gridSubmitter","rowProps","defaultFormItemsNumber","showHiddenNum","ignoreRules","onCollapse","onReset"]))})),I=g(()=>e.submitter===!1?!1:L({style:{justifyContent:"flex-end"},reverse:!0,searchConfig:{submitText:e.searchText||r.getMessage("form.search","搜索"),resetText:e.resetText||r.getMessage("form.reset","重置")},colProps:{span:w.value.span,offset:d.value}},e.submitter));return $([w,i,()=>e.items],()=>{var f;let v=!1;b.value=0,a.value=0,o.value=0,(f=e.items)!=null&&f.length?_.value=Dt(e.items,e.ignoreRules).map((F,E)=>{var B;const N=(B=F.colSize)!=null?B:1,k=Math.min(w.value.span*(N||1),24);o.value+=k,a.value+=N,E===0&&(v=k===24&&!F.hidden);const Z=F.hidden||i.value&&(v||a.value>O.value)&&!!E;return Z?e.preserve?{...F,colProps:{span:k},hidden:!0}:{...F,colProps:{span:0},hidden:!0}:(24-b.value%24<k&&(o.value+=24-b.value%24,b.value+=24-b.value%24),b.value+=k,{...F,hidden:Z,formItemProps:{...F.title?p.value:{},...F.formItemProps},colProps:{span:k}})}):_.value=[]},{immediate:!0}),s({formRef:C,...m}),()=>y("div",V({class:`${c}-wrap`,ref:"wrapper"},u),[y(Y,V({ref:C,class:c},j.value,{grid:!0,gridSubmitter:!0,rowProps:{gutter:e.searchGutter,justify:"start",class:`${c}-row`},showLoading:!1,submitter:I.value,items:_.value,layout:w.value.layout,onReset:f=>{var v,F;e.resetOnSubmit&&((v=C.value)==null||v.submit()),(F=e.onReset)==null||F.call(e,f)}}),{...t,submitter:({props:f,action:v,defaultDoms:F})=>{var E;return y(W,null,[t.submitter?(E=t.submitter)==null?void 0:E.call(t,{props:f,action:v,defaultDoms:F}):F,n.value!==!1&&y("a",{class:`${c}-collapse-button`,onClick:()=>h(!i.value)},[i.value?r.getMessage("form.collapsed","展开"):r.getMessage("form.expand","收起"),!!R.value&&`(${R.value})`,y(nt,{style:{marginInlineStart:"0.5em",transition:"0.3s all",transform:`rotate(${i.value?0:.5}turn)`}},null)])])}})])}});const Ge=Symbol("StepsFormContextContext"),kt=e=>{fe(Ge,e)},Mt=()=>ve(Ge,{});var Lt=M({name:"StepForm",inheritAttrs:!1,props:{index:Number,...Q()},emits:[],setup(e,{slots:t}){const l=re("steps-form"),s=A(),{step:u,regForm:o,onFormFinish:a,setLoading:b,next:r,lastStep:c}=Mt(),S=g(()=>e.index===u.value),C=g(()=>T(D(e,["index","onFinish"]))),_=async x=>{var P;if(e.name&&a(e.name,x),e.onFinish){b(!0),await((P=e.onFinish)==null?void 0:P.call(e,x))&&r(),b(!1);return}c.value||r()};return me(()=>{o(s,e.index)}),()=>y("div",{class:{[`${l}-step`]:!0,[`${l}-step-active`]:S.value}},[y(Y,V({ref:s},C.value,{submitter:!1,onFinish:_}),t)])}});function H(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!ge(e)}const qt={horizontal({stepsDom:e,formDom:t}){return y(W,null,[y(ee,{gutter:{xs:8,sm:16,md:24}},{default:()=>[y(X,{span:24},H(e)?e:{default:()=>[e]})]}),y(ee,{gutter:{xs:8,sm:16,md:24}},{default:()=>[y(X,{span:24},H(t)?t:{default:()=>[t]})]})])},vertical({stepsDom:e,formDom:t}){let l;return y(ee,{align:"stretch",wrap:!0,gutter:{xs:8,sm:16,md:24}},{default:()=>[y(X,{xxl:4,xl:6,lg:7,md:8,sm:10,xs:12},H(l=Fe(e,{style:{height:"100%"}}))?l:{default:()=>[l]}),y(X,null,{default:()=>[y("div",{style:{display:"flex",alignItems:"center",width:"100%",height:"100%"}},[t])]})]})}};var we=M({name:"ProStepsForm",inheritAttrs:!1,props:{...De()},emits:[],setup(e,{slots:t,expose:l}){const s=oe(),u=re("steps-form"),o=A([]),a=new Map,[b,r]=bt(!1),c=g(()=>T(D(e,["name","current","stepsProps","containerStyle","onCurrentChange","steps","items","submitter","onFinish"]))),S=g(()=>{var v;return(v=e.steps)==null?void 0:v.map(F=>D(F,["formProps"]))}),[C,_]=le(0,{value:g(()=>e.current),onChange:e.onCurrentChange}),x=(v,F)=>{o.value[F]=v.value},P=g(()=>C.value===e.steps.length-1),m=async(v,F)=>{if(a.set(v,F),!P.value||!e.onFinish)return;r(!0);const E=L({},...Array.from(a.values()));try{await e.onFinish(E)&&(_(0),o.value.forEach(N=>N?.reset()))}catch(B){console.log(B)}finally{r(!1)}},w=()=>{const v=o.value[C.value];v&&v?.submit()},O=()=>{C.value<1||_(C.value-1)},R=g(()=>{var v;let F;return e.submitter!==!1&&y(ie,V({key:"next",type:"primary",loading:b.value},(v=e.submitter)==null?void 0:v.submitButtonProps,{onClick:()=>{w()}}),H(F=s.getMessage("stepsForm.next","下一步"))?F:{default:()=>[F]})}),n=g(()=>{var v;let F;return e.submitter!==!1&&y(ie,V({key:"pre"},(v=e.submitter)==null?void 0:v.resetButtonProps,{onClick:()=>{O()}}),H(F=s.getMessage("stepsForm.prev","上一步"))?F:{default:()=>[F]})}),d=g(()=>{var v;let F;return e.submitter!==!1&&y(ie,V({key:"submit",type:"primary",loading:b.value},(v=e.submitter)==null?void 0:v.submitButtonProps,{onClick:()=>{w()}}),H(F=s.getMessage("stepsForm.submit","提交"))?F:{default:()=>[F]})}),p=()=>{C.value>e.steps.length-2||_(C.value+1)},i=g(()=>{var v,F;const E=[],B=C.value||0;return B<1?((v=e.steps)==null?void 0:v.length)===1?E.push(d.value):E.push(R.value):B+1===((F=e.steps)==null?void 0:F.length)?E.push(n.value,d.value):E.push(n.value,R.value),E}),h=g(()=>{var v;return qt[((v=e.stepsProps)==null?void 0:v.direction)||"horizontal"]}),j=g(()=>y("div",{class:`${u}-steps-container`,style:{maxWidth:Math.min(e.steps.length*320,1160)+"px"}},[y(at,V(e.stepsProps,{items:S.value,current:C.value,onChange:void 0}),null)])),I=g(()=>{var v,F;return y("div",{class:`${u}-container`,style:e.containerStyle},[e.items.map((E,B)=>{var N;const k=D(T(((N=e.steps[B])==null?void 0:N.formProps)||{}),["items"]),Z=k.name||`${B}`,$e=L({},c.value,k);return y(Lt,V({items:E,name:Z,index:B},$e),t)}),e.submitter!==!1?(v=e.submitter)!=null&&v.teleport?y(Ve,{defer:!0,to:(F=e.submitter)==null?void 0:F.teleport},{default:()=>[y(ce,null,{default:()=>[i.value]})]}):y(ce,null,{default:()=>[i.value]}):null])}),f=g(()=>{var v;const F={stepsDom:j.value,formDom:I.value};return(v=h.value)==null?void 0:v.call(h,F)});return kt({step:C,loading:b,setLoading:r,lastStep:P,next:p,regForm:x,onFormFinish:m}),l({formArrayRef:o}),()=>y("div",{class:u},[f.value])}}),Gt=M({name:"ProForm",inheritAttrs:!1,props:{layoutType:{type:String,default:"Form"},...vt()},setup(e,{slots:t,expose:l,attrs:s}){const u=A(),o=Me(u);return l(o),()=>{const{layoutType:a,items:b,...r}=e;return a==="DrawerForm"?y(pe,V({ref:u},s,r,{items:b}),t):a==="ModalForm"?y(Ce,V({ref:u},s,r,{items:b}),t):a==="QueryFilter"?y(Pe,V({ref:u},s,r,{items:b}),t):a==="StepForm"?y(we,V({ref:u},s,r,{items:b}),t):y(Y,V({ref:u},s,r,{items:b}),t)}}});const Zt=st(Gt,{Drawer:pe,Modal:Ce,Filter:Pe,Steps:we}),el=ue(pe),tl=ue(Ce),ll=ue(Pe),nl=ue(we),al=(e=100)=>new Promise(t=>{setTimeout(()=>{t(!0)},e)});export{Vt as F,J as P,he as R,Zt as a,tl as b,el as c,ll as d,nl as e,bt as f,ke as g,Ie as h,be as i,ft as j,Pt as k,z as l,Yt as m,gt as n,_e as p,yt as r,al as s,le as u};
