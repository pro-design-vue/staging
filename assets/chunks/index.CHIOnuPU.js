const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/FormGroup.DfYWckF5.js","assets/chunks/FormTitle.kcDocX3o.js","assets/chunks/framework.nwrEuAw0.js","assets/chunks/theme.Vccz36Hl.js","assets/chunks/validate.CC0GjpC9.js","assets/chunks/index.CqkG6qhk.js","assets/chunks/index.DS3JMEMC.js","assets/chunks/install.BalIz2Dd.js","assets/chunks/index.D5lW5ejP.js","assets/chunks/index.CHg6CLv2.js","assets/chunks/useIntl.Da1fMGaX.js","assets/chunks/index.Bvf_urTu.js","assets/chunks/FormSet.BWmdICoH.js","assets/chunks/useFieldValue.CaEcPMFj.js","assets/chunks/FormList.BfZw7T-n.js","assets/chunks/FormListContext.C1lAsfCm.js","assets/chunks/FormItem.QqjPzP5w.js","assets/chunks/index.DCiBXmEW.js"])))=>i.map(i=>d[i]);
import{P as Ge}from"./index.CqkG6qhk.js";import{d as M,r as We,w as W,c as ce,p as de,f as A,s as ee,o as ve,e as g,F as $,v as $e,k as b,a0 as E,an as le,ao as ne,i as fe,u as ze,h as Ue,J as Ke,E as He,aR as Qe,aZ as Xe}from"./framework.nwrEuAw0.js";import{N as L,O as q,s as G,p as K,Q as J,S as Ee,B as we,v as Ye,i as Ze,U as Je,u as et,W as X,X as tt,Y as Be,o as lt,Z as nt}from"./theme.Vccz36Hl.js";import{d as Ve,e as at,a as ie,f as rt}from"./validate.CC0GjpC9.js";import{a as T,o as D,P as se}from"./index.DS3JMEMC.js";import{u as ae}from"./index.D5lW5ejP.js";import{u as re}from"./useIntl.Da1fMGaX.js";import{P as ot}from"./index.Bvf_urTu.js";import{w as ut,a as oe}from"./install.BalIz2Dd.js";function st(e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&delete e[t]}const Re=Symbol("FormSlotsContext"),je=()=>ce(Re,{});var it=M({name:"FormSlotsContextProvider",inheritAttrs:!1,props:{value:{type:Object,default:()=>({})}},setup(e,{slots:t}){const l=We({});return W(()=>e.value,()=>{st(l),Object.assign(l,e.value)},{immediate:!0}),de(Re,l),()=>{var s;return(s=t.default)==null?void 0:s.call(t)}}});const ct=()=>({layout:{type:String,default:"horizontal"},labelCol:{type:Object},wrapperCol:{type:Object},colon:{type:Boolean,default:!0},requiredMark:{type:[Boolean,String],default:!0},labelAlign:{type:String,default:"right"},labelWrap:Boolean,disabled:{type:Boolean,default:!1},prefixCls:String,validateMessages:Object,validateTrigger:{type:[String,Array],default:"change"},validateOnRuleChange:{type:Boolean,default:!0},scrollToFirstError:{type:[Boolean,Object],default:!1},name:String}),Yt=()=>({value:{type:[String,Array,Number,Object,Boolean]},readonly:{type:Boolean,default:void 0},readonlyProps:{type:Object,default:void 0},valueEnum:{type:[Function,Object],default:void 0},options:{type:[Array,Function],default:void 0},request:{type:Function,default:void 0},params:{type:[Function,Object],default:void 0},dependencies:{type:Array,default:void 0},onChange:{type:Function}}),Q=()=>({...ct(),loading:{type:Boolean,default:void 0},showLoading:{type:Boolean,default:!0},submitOnLoading:{type:Boolean,default:!0},gridSubmitter:{type:Boolean,default:!1},omitNil:{type:Boolean,default:!0},readonly:Boolean,grid:Boolean,isKeyPressSubmit:Boolean,formKey:String,theme:{type:String,default:"custom"},customUi:{type:Boolean,default:!0},initialValues:{type:Object},readonlyProps:{type:Object},colProps:{type:Object},rowProps:{type:Object},dateFormatter:{type:[String,Function,Boolean],default:"string"},params:{type:Object},items:{type:Array},request:{type:Function},requestAbort:{type:Boolean},submitter:{type:[Object,Boolean],default:void 0},onReset:{type:Function},onFinish:{type:Function},onFinishFailed:{type:Function},onLoadingChange:{type:Function},onValuesChange:{type:Function},onInit:{type:Function,default:void 0}}),me=()=>({...Q(),submitTimeout:{type:Number,default:void 0},title:{type:String,default:void 0},width:{type:[String,Number],default:800},open:{type:Boolean,default:void 0},closeOnFinish:{type:Boolean,default:!0},confirmOnValuesChange:{type:Boolean,default:!0},onOpenChange:{type:Function,default:void 0}}),Ie=()=>({...Q(),preserve:{type:Boolean,default:!0},defaultCollapsed:{type:Boolean,default:!0},collapsed:{type:Boolean,default:void 0},defaultColsNumber:Number,defaultFormItemsNumber:Number,labelWidth:{type:[String,Number],default:"80"},searchText:String,resetText:String,searchGutter:{type:Number,default:24},span:{type:[Number,Object]},showHiddenNum:Boolean,ignoreRules:Boolean,resetOnSubmit:Boolean,onCollapse:{type:Function,default:void 0},onResize:{type:Function,default:void 0}}),Te=()=>({...Q(),current:{type:Number,default:void 0},steps:{type:Array,default:()=>[]},items:{type:Array,default:()=>[]},stepsProps:{type:Object},containerStyle:{type:Object},onCurrentChange:{type:Function,default:void 0}}),dt=()=>({...Q(),...me(),...Ie(),...Te(),items:{type:Array,default:()=>[]}});function vt(e,t){return e?Ve(e)&&e.startsWith("::")?t[e.substring(2)]:e:null}const De=Symbol("FormContext"),ft=e=>{de(De,e)},ge=()=>ce(De,{}),Ne=(e,{slots:t})=>{var l;return(l=t.default)==null?void 0:l.call(t)};Ne.displayName="RenderSlot";Ne.inheritAttrs=!1;const ye=(e,{slots:t})=>{var l,s,u;return typeof e.vnode=="function"?((l=e.vnode)==null?void 0:l.call(e,e.props||{}))||((s=t.default)==null?void 0:s.call(t)):e.vnode||((u=t.default)==null?void 0:u.call(t))};ye.props=["vnode","props"];ye.inheritAttrs=!1;function mt(e){const t=A(null);return async(s,u)=>{var o,a;(o=t.value)==null||o.abort();const y=new AbortController;return t.value=y,await Promise.race([(a=e.request)==null?void 0:a.call(e,s,u),new Promise((c,S)=>{var P,_;(_=(P=t.value)==null?void 0:P.signal)==null||_.addEventListener("abort",()=>{S(new Error("aborted"))})})])}}function gt(e,...t){return typeof e=="function"?e(...t):e}function yt(e){const t=typeof e=="function"?e():e,l=A(t);function s(u){l.value=u}return[l,s]}var Y=(e=>(e.FORM_SET="formSet",e.FORM_LIST="formList",e.GROUP="group",e.DIVIDER="divider",e.TEXT="text",e.DIGIT="digit",e.DIGIT_RANGE="digitRange",e.SELECT="select",e.TREE_SELECT="treeSelect",e.CASCADER="cascader",e.TEXTAREA="textarea",e.PASSWORD="password",e.CHECKBOX="checkbox",e.CHECKBOX_GROUP="checkboxGroup",e.RADIO_GROUP="radioGroup",e.SWITCH="switch",e.SLIDER="slider",e.RATE="rate",e.DATE="date",e.DATE_RANGE="dateRange",e.TIME="time",e.TIME_RANGE="timeRange",e.UPLOAD_BUTTON="uploadButton",e.UPLOAD_DRAGGER="uploadDragger",e.UPLOAD_PICTURE="uploadPicture",e.UPLOAD_PICTURE_LIST="uploadPictureList",e.EDITOR="editor",e))(Y||{});function ke(e){return{getFieldValue:C=>{var m;return(m=e.value)==null?void 0:m.getFieldValue(C)},getFieldsValue:C=>{var m;return(m=e.value)==null?void 0:m.getFieldsValue(C)},resetInitialValues:C=>{var m;return(m=e.value)==null?void 0:m.resetInitialValues(C)},getFieldFormatValue:C=>{var m;return(m=e.value)==null?void 0:m.getFieldFormatValue(C)},getFieldFormatValueObject:C=>{var m;return(m=e.value)==null?void 0:m.getFieldFormatValueObject(C)},validateFieldsReturnFormatValue:C=>{var m;return(m=e.value)==null?void 0:m.validateFieldsReturnFormatValue(C)},setFieldValue:(C,m)=>{var w;return(w=e.value)==null?void 0:w.setFieldValue(C,m)},setFieldsValue:(C,m=!0)=>{var w;return(w=e.value)==null?void 0:w.setFieldsValue(C,m)},resetField:C=>{var m;return(m=e.value)==null?void 0:m.resetField(C)},clearValidate:C=>{var m;return(m=e.value)==null?void 0:m.clearValidate(C)},validateFields:C=>{var m;return(m=e.value)==null?void 0:m.validateFields(C)},reset:()=>{var C;return(C=e.value)==null?void 0:C.reset()},submit:()=>{var C;return(C=e.value)==null?void 0:C.submit()}}}const bt=e=>{const t=A(!0),l=A(!1),s=ee({...e.initialValues}),u=mt({request:e.request});return ve(async()=>{var o;if(e.request&&!e.requestAbort){t.value=!0,l.value=!0;const a=await u(e.params);s.value=(o=L({},s.value,a))!=null?o:{},Promise.resolve().then(()=>{t.value=!1,l.value=!1})}}),{initialValues:s,hasInitial:t,requestLoading:l}},ht=()=>{const e=ee([]),t=ee([]),l=g(()=>e.value.map(r=>r.split(":")[1])),s=(r,c,S)=>{Array.isArray(S)||(S=[S]);const P=r.filter(_=>!_.startsWith(c+":"));return P.push(...S.map(_=>`${c}:${_}`)),Array.from(new Set(P))},u=(r,c)=>{e.value=s(e.value,r,c)},o=(r,c)=>{t.value=s(t.value,r,c)},a=g(()=>e.value.filter(r=>!l.value.includes(r.split(":")[0])).map(r=>r.split(":")[1])),y=g(()=>t.value.filter(r=>!l.value.includes(r.split(":")[0])).map(r=>r.split(":")[1]));return{allHiddenKeys:a,hiddenKeys:e,allDisabledKeys:y,disabledKeys:t,updateHiddenKeys:u,updateDisabledKeys:o}},z=e=>{if(e)return Ve(e)?e.indexOf(".")>-1?e.split("."):[e]:e};function Me(e){return Array.isArray(e)&&e.length===1&&(e=e[0]),e?.__v_isVNode&&typeof e.type!="symbol"}function Ft(e){return e&&(e.type===Comment||e.type===$&&e.children.length===0||e.type===Text&&e.children.trim()==="")}function ue(e=[]){const t=[];return e.forEach(l=>{Array.isArray(l)?t.push(...l):l?.type===$?t.push(...ue(l.children)):t.push(l)}),t.filter(l=>!Ft(l)&&Me(l))}function be(e,t={},l=!0,s=!1){let u=e;if(Array.isArray(e)&&(u=ue(e)[0]),!u)return null;const o=$e(u,t,s);return o.props=l?{...o.props,...t}:o.props,o}function _t(e){return typeof e!="object"?!1:e===null?!0:!(Me(e)||e.constructor===RegExp||e instanceof Map||e instanceof Set||e instanceof HTMLElement||e instanceof Blob||e instanceof File||Array.isArray(e))}const U=(e,t,l)=>{if(Object.keys(e).length<1||typeof window>"u"||typeof e!="object"||at(e)||e instanceof Blob)return e;let s=Array.isArray(e)?[]:{};const u=(o,a)=>{let r=Array.isArray(o)?[]:{};return o==null||o===void 0?r:(Object.keys(o).forEach(c=>{var S;const P=(m,w)=>(Array.isArray(m)&&m.forEach((O,R)=>{if(!O)return;const n=w?.[R];typeof O=="function"&&(w[R]=O(w,c,o)),typeof O=="object"&&!Array.isArray(O)&&Object.keys(O).forEach(d=>{const p=n?.[d];if(typeof O[d]=="function"&&p){const i=O[d](n[d],c,o);n[d]=typeof i=="object"?i[d]:i}else typeof O[d]=="object"&&Array.isArray(O[d])&&p&&P(O[d],p)}),typeof O=="object"&&Array.isArray(O)&&n&&P(O,n)}),c),_=o[c],x=(S=t.get(c))==null?void 0:S.transform,C=()=>{let m,w,O=!1;if(typeof x=="function"){w=x?.(_,c,o);const R=typeof w;R!=="object"&&R!=="undefined"?(m=c,O=!0):m=w}else m=P(x,_);if(Array.isArray(m)){r=G(r,m,_);return}typeof m=="object"&&!Array.isArray(s)?s=L(s,m):typeof m=="object"&&Array.isArray(s)?r={...r,...m}:(m!==null||m!==void 0)&&(r=G(r,[m],O?w:_))};if(x&&typeof x=="function"&&C(),!(typeof window>"u")){if(_t(_)){const m=u(_);if(Object.keys(m).length<1)return;r=G(r,[c],m);return}C()}}),l?r:o)};return s=Array.isArray(e)&&Array.isArray(s)?[...u(e)]:L({},u(e),s),s},Le=(e,t)=>{if(Object.keys(e).length<1)return e;const l={};return Object.keys(e).forEach(s=>{var u;const o=e[s],a=(u=t.get(s))==null?void 0:u.convertValue;if(typeof a=="function"){const y=a?.(o,s);l[s]=y}else l[s]=o}),l};function pt({props:e,formRef:t,formData:l,initialValues:s,hasInitial:u,transformerMap:o,onFinish:a,onReset:y,onFinishFailed:r}){const c=i=>{const h=z(i);if(!h)throw new Error("name is require");return K(l.value,h)},S=i=>{if(i===!0||i===void 0)return q(l.value);const h={};return i.forEach(j=>{const I=z(j),v=K(l.value,I);v!==void 0&&G(h,I,v)}),h},P=i=>{const h=z(i);if(!h)throw new Error("name is require");const j=K(l.value,h),I=G({},h,j);return K(U(I,o.value,e.omitNil),h)},_=i=>{const h=z(i);if(!h)throw new Error("name is require");const j=K(l.value,h),I=G({},h,j);return U(I,o.value,e.omitNil)},x=async i=>{var h;if(!Array.isArray(i)&&i)throw new Error("nameList must be array");const j=await((h=t.value)==null?void 0:h.validateFields(i)),I=U(j,o.value,e.omitNil);return I??{}},C=(i,h)=>{const j=z(i);if(!j)throw new Error("name is require");G(l.value,j,h)},m=(i,h=!0)=>{if(!i)throw new Error("values is require");h?l.value=L({},l.value,i):l.value=q(i)},w=i=>{if(!i)throw new Error("values is require");if(!ie(i))throw new Error("values must be object");u.value=!0,s.value=q(i)},O=()=>{var i;u.value=!0,(i=t.value)==null||i.clearValidate(),l.value=q(Le(s.value,o.value)),Promise.resolve().then(()=>{u.value=!1,y?.(U(l.value,o.value,e.omitNil))})},R=i=>{var h;if(!z(i))throw new Error("name is require");(h=t.value)==null||h.clearValidate(i),G(l.value,i,q(K(s.value,i)))},n=i=>{var h;(h=t.value)==null||h.clearValidate(i)},d=i=>new Promise((h,j)=>{var I;(I=t.value)==null||I.validateFields(i).then(v=>{h({...l.value,...v})}).catch(v=>{j(v)})});return{getFieldValue:c,getFieldsValue:S,resetInitialValues:w,getFieldFormatValue:P,getFieldFormatValueObject:_,validateFieldsReturnFormatValue:x,setFieldValue:C,setFieldsValue:m,resetField:R,clearValidate:n,validateFields:d,reset:O,submit:()=>{d().then(i=>{if(a)try{a(i)}catch(h){console.error(h)}}).catch(i=>{r&&r(i)})}}}var Ct=M({name:"FormRowWrapper",inheritAttrs:!1,props:{rowProps:{type:Object,default:void 0},grid:{type:Boolean,default:void 0}},setup(e,{slots:t,attrs:l}){const{rowProps:s,grid:u}=ge(),o=g(()=>{var y;return(y=e.grid)!=null?y:u?.value}),a=g(()=>{var y;return(y=e.rowProps)!=null?y:s?.value});return()=>{var y;return o?.value?b(J,E(a.value,{class:l.class}),{default:()=>{var r;return[(r=t.default)==null?void 0:r.call(t)]}}):(y=t.default)==null?void 0:y.call(t)}}});function he(e,t){const l={};return Array.isArray(t)&&t.length>0&&Object.keys(e||{}).forEach(s=>{t.includes(s)&&(l[s]=e[s])}),l}const Pt=le(()=>ne(()=>import("./FormGroup.DfYWckF5.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),wt=le(()=>ne(()=>import("./FormSet.BWmdICoH.js"),__vite__mapDeps([12,13,3,2,1,6,4,7,8,5,9,10,11]))),St=le(()=>ne(()=>import("./FormList.BfZw7T-n.js"),__vite__mapDeps([14,15,2,1,3,13,6,4,7,8,5,9,10,11]))),Ot=le(()=>ne(()=>import("./FormItem.QqjPzP5w.js"),__vite__mapDeps([16,13,3,2,15,17,10,8,7,6,4,11,9,1,5]))),At=["min","max","isValidateList","emptyListMessage","creatorRecord","creatorButtonProps","alwaysShowItemLabel","actionGuard","copyIconProps","deleteIconProps","onAfterAdd","onAfterRemove"],xt=["action","creator","item"];var Et=M({name:"FormItems",inheritAttrs:!1,props:{list:{type:Array,default:()=>[]},type:{type:String,default:""},grid:{type:Boolean,default:void 0},spaceProps:{type:Object,default:()=>({size:[32,0],wrap:!0})}},setup(e){const{grid:t,allHiddenKeys:l}=ge(),s=je(),u=g(()=>{var a;return(a=e.grid)!=null?a:t?.value}),o=g(()=>e.list.filter(a=>!l.value.includes(a.key)).map(a=>{var y;if(a.fieldType===Y.GROUP)return b(Pt,{key:a.key,items:a.children,title:a.title,tooltip:a.tooltip,colProps:a.colProps,rowProps:a.rowProps,spaceProps:a.spaceProps,grid:a.grid,item:a,formItemProps:a.formItemProps},null);if(a.fieldType===Y.FORM_SET)return b(wt,{key:a.key,name:a.name,items:a.children,title:a.title,tooltip:a.tooltip,colProps:a.colProps,rowProps:a.rowProps,spaceProps:a.spaceProps,formItemProps:a.formItemProps,initialValue:a.initialValue,convertValue:a.convertValue,transform:a.transform},null);if(a.fieldType===Y.FORM_LIST){const r=T(he((y=a.fieldProps)!=null?y:{},At)),c={};return xt.forEach(S=>{var P;const _=vt((P=a.fieldProps)==null?void 0:P[`${S}Render`],s);_&&(c[S]=x=>b(ye,{vnode:_,props:x},null))}),b(St,E({key:a.key,name:a.name,originName:a.originName,items:a.children,title:a.title,tooltip:a.tooltip,rules:a.rules,colProps:a.colProps,rowProps:a.rowProps,formItemProps:a.formItemProps,initialValue:a.initialValue,convertValue:a.convertValue,transform:a.transform},r),{...c})}return b(Ot,{key:a.key,item:a,grid:u.value},null)}));return()=>e.type==="space"&&!u?.value?b(Ee,E(e.spaceProps,{align:"start"}),{default:()=>[o.value]}):o.value}});function Se(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!fe(e)}var Bt=M({name:"FormSubmitter",inheritAttrs:!1,props:{loading:{type:Boolean,default:void 0},reverse:{type:Boolean,default:void 0},onSubmit:{type:Function,default:void 0},onReset:{type:Function,default:void 0},searchConfig:{type:Object,default:void 0},submitButtonProps:{type:[Object,Boolean],default:void 0},resetButtonProps:{type:[Object,Boolean],default:void 0},render:{type:[Function,Boolean],default:void 0}},setup(e,{attrs:t}){const{action:l}=ge(),s=je(),u=()=>{var r;l.submit(),(r=e.onSubmit)==null||r.call(e)},o=()=>{var r,c;(r=l.reset)==null||r.call(l),(c=e.onReset)==null||c.call(e)},a=g(()=>{const{searchConfig:r={},resetButtonProps:c={}}=e;if(c===!1)return null;const{resetText:S="重置"}=r;return b(we,E(D(c,["preventDefault","onClick"]),{key:"reset",onClick:P=>{var _;c.preventDefault||o(),(_=c.onClick)==null||_.call(c,P)}}),Se(S)?S:{default:()=>[S]})}),y=g(()=>{const{searchConfig:r={},submitButtonProps:c={}}=e;if(c===!1)return null;const{submitText:S="提交"}=r;return b(we,E({type:"primary"},D(c||{},["preventDefault","onClick"]),{key:"submit",onClick:P=>{var _;c.preventDefault||u(),(_=c.onClick)==null||_.call(c,P)}}),Se(S)?S:{default:()=>[S]})});return()=>{if(e.render===!1)return null;const{render:r=s.submitter}=e,c=e.reverse?b($,null,[a.value,y.value]):b($,null,[y.value,a.value]),S=r?r({props:{...e,submit:u,reset:o},action:l,defaultDoms:c}):c;return b("div",{style:{display:"flex",gap:"8px",alignItems:"center",...t.style},class:t.class},[S])}}});function Vt(e){const t=new Map,l=s=>{s.forEach(u=>{var o;if(u.name&&(u.transform||u.convertValue))t.set(u.name,{transform:u.transform,convertValue:u.convertValue});else if(u.children){const a=(o=gt(u.children))!=null?o:[];l(a)}})};return l(e),t}function te(e,t){const{defaultValue:l,value:s=A()}=t||{};let u=typeof e=="function"?e():e;s.value!==void 0&&(u=ze(s)),l!==void 0&&(u=typeof l=="function"?l():l);const o=A(u),a=A(u);Ue(()=>{let r=s.value!==void 0?s.value:o.value;t?.postState&&(r=t.postState(r)),a.value=r});function y(r){const c=a.value;o.value=r,Ke(a.value)!==r&&t?.onChange&&t?.onChange(r,c)}return W(s,()=>{o.value=s.value}),[a,y]}function Rt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!fe(e)}let Oe=0;var Z=M({name:"BaseForm",inheritAttrs:!1,props:{...Q()},setup(e,{slots:t,expose:l,attrs:s}){const u=A(!1),o=ee(new Map),a=A(),y=ae("form"),r=A({}),c=A([]),S=g(()=>{var v;return(v=e.formKey)!=null?v:Oe.toString()}),[P,_]=te(!1,{value:g(()=>e.loading),onChange:v=>{var f;(f=e.onLoadingChange)==null||f.call(e,v)}}),x=g(()=>{var v;return{[y]:!0,[`${(v=s.class)!=null?v:""}`]:!0}}),C=g(()=>{var v;return{...T(D(e,["colProps","submitter","loading","showLoading","omitNil","grid","theme","customUi","gridSubmitter","requestAbort","isKeyPressSubmit","formKey","initialValues","rowProps","dateFormatter","params","readonly","readonlyProps","items","request","submitOnLoading","onLoadingChange","onFinish","onValuesChange"])),layout:(v=e.layout)!=null?v:"vertical"}}),m=v=>v.filter(f=>!f.hidden).sort((f,F)=>{var B,V;return F.order||f.order?((B=F.order)!=null?B:0)-((V=f.order)!=null?V:0):0}).map((f,F)=>{var B,V;const k=z(f.name),N=(B=f.key)!=null?B:k?(k??[]).join("_"):F;return T({...f,originName:(V=f.originName)!=null?V:f.name,name:k,key:N})}).filter(f=>!!f);W(()=>e.items,()=>{var v,f;o.value=Vt((v=e.items)!=null?v:[]),c.value=m((f=e.items)!=null?f:[])},{immediate:!0});const{initialValues:w,hasInitial:O,requestLoading:R}=bt(e);W(w,(v,f)=>{Ze(v,f)||(r.value=q(Le(v,o.value)),(!e.request||e.requestAbort)&&Promise.resolve().then(()=>{O.value=!1}))},{immediate:!0});const n=Ye(()=>{var v;(v=e.onValuesChange)==null||v.call(e,U(q(r.value),o.value,e.omitNil))},200),d=async()=>{if(e.onFinish){if(e.submitOnLoading){if(P.value)return;_(!0)}try{const v=U(q(r.value),o.value,e.omitNil);await e.onFinish(v)}catch(v){console.log("🚀 ~ onFinish ~ error:",v)}finally{e.submitOnLoading&&_(!1)}}};W(r,()=>{O.value||n()},{deep:!0});const p=ht(),i=pt({props:e,formRef:a,formData:r,initialValues:w,hasInitial:O,transformerMap:o,onFinish:d,onReset:e.onReset,onFinishFailed:e.onFinishFailed}),h=g(()=>typeof e.submitter=="boolean"||!e.submitter?{}:D(e.submitter,["colProps"])),j=g(()=>e.submitter===!1||e.readonly?{}:e.gridSubmitter&&ie(e.submitter)&&ie(e.submitter.colProps)?{...e.submitter.colProps}:{span:24}),I=g(()=>{if(e.submitter===!1||e.readonly)return;const v=h.value.submitButtonProps===!1?!1:{loading:P.value,...h.value.submitButtonProps},f=h.value.resetButtonProps===!1?!1:{disabled:P.value,...h.value.resetButtonProps},F=b(Bt,E({key:"submitter"},h.value,{submitButtonProps:v,resetButtonProps:f}),null);return h.value.teleport?b(He,{to:h.value.teleport},Rt(F)?F:{default:()=>[F]}):F});return ve(()=>{var v,f,F;u.value=!0,Oe+=1;const B=(F=(f=(v=a.value)==null?void 0:v.getFieldsValue)==null?void 0:f.call(v,!0))!=null?F:{};Promise.resolve().then(()=>{var V;(V=e.onInit)==null||V.call(e,U(B,o.value,e.omitNil),i)})}),ft({...p,action:i,formKey:S,mountedRef:u,prefixCls:y,initialValues:w,formData:r,hasInitial:O,theme:g(()=>e.theme),customUi:g(()=>e.customUi),grid:g(()=>e.grid),disabled:g(()=>e.disabled),readonly:g(()=>e.readonly),readonlyProps:g(()=>e.readonlyProps),rowProps:g(()=>{var v;return(v=e.rowProps)!=null?v:{gutter:16}}),colProps:g(()=>{var v;return(v=e.colProps)!=null?v:{xs:24}}),formatItems:m}),l({...i}),()=>b(it,{value:{...t}},{default:()=>[b(Je,E({ref:a},C.value,{class:x.value,model:r.value,style:s.style}),{default:()=>[b(et,{spinning:e.showLoading&&(R.value||P.value)},{default:()=>[b(Ct,null,{default:()=>[b(Et,{list:c.value},null),e.gridSubmitter&&e.submitter!==!1&&b(X,j.value,{default:()=>[b(tt,{label:" ",colon:!1,class:`${y}-submitter-form-item`},{default:()=>[I.value]})]})]}),!e.gridSubmitter&&I.value]})]})]})}}),Fe=M({name:"ProDrawerForm",inheritAttrs:!1,props:{...me(),drawerProps:{type:Object,default:void 0}},emits:["update:open"],setup(e,{slots:t,emit:l}){const s=A(!1),u=A(!1),o=A(!1),a=re(),y=A(),r=A(null),c=g({get:()=>{var n;return(n=e.open)!=null?n:s.value},set:n=>{typeof e.open>"u"?s.value=n:l("update:open",n)}});W(c,()=>{var n;(n=e.onOpenChange)==null||n.call(e,c.value)});const S=g(()=>({...T(D(e,["onOpenChange","closeOnFinish","drawerProps","title","width","onInit","confirmOnValuesChange","submitTimeout","onFinish","submitter"])),layout:"vertical"})),P=g(()=>({...T(D(t,["trigger","closeIcon","extra","footer","title"]))})),_=g(()=>{var n;return T({...D((n=e.drawerProps)!=null?n:{},["title","width","open","footer","okText","cancelText"]),width:e.width,title:e.title})}),x=g(()=>({...T(he(t,["closeIcon","extra","title"]))})),C=g(()=>{var n,d,p,i;return e.submitter===!1?!1:L({teleport:r.value,reverse:!0,searchConfig:{submitText:(d=(n=e.drawerProps)==null?void 0:n.okText)!=null?d:a.getMessage("confirm.okText","确认"),resetText:(i=(p=e.drawerProps)==null?void 0:p.cancelText)!=null?i:a.getMessage("confirm.cancelText","取消")},resetButtonProps:{preventDefault:!0,disabled:e.submitTimeout?u.value:void 0,onClick:h=>{w(h)}}},e.submitter)}),m=g(()=>{if(!t.trigger)return null;const n=ue(t.trigger())[0];return be(n,{key:"trigger",...n?.props,onClick:async d=>{var p,i;c.value=!c.value,(i=(p=n?.props)==null?void 0:p.onClick)==null||i.call(p,d)}})}),w=n=>{var d,p;e.confirmOnValuesChange&&o.value?Be.confirm({title:a.getMessage("confirm.title","提示"),content:a.getMessage("confirm.formModalCloseContent","您的表单还没有保存，您确定关闭吗？"),onOk(){var i,h;c.value=!1,(h=(i=_.value)==null?void 0:i.onClose)==null||h.call(i,n)},onCancel(){}}):(c.value=!1,(p=(d=_.value)==null?void 0:d.onClose)==null||p.call(d,n))},O=()=>{var n,d,p;y.value&&!((n=_.value)!=null&&n.destroyOnClose)&&((p=(d=y.value)==null?void 0:d.reset)==null||p.call(d))},R=async n=>{var d;const p=(d=e.onFinish)==null?void 0:d.call(e,n);if(e.submitTimeout&&p instanceof Promise){u.value=!0;const h=setTimeout(()=>{u.value=!1},e.submitTimeout);p.finally(()=>{clearTimeout(h),u.value=!1})}const i=await p;return i&&(e.closeOnFinish?c.value=!1:o.value=!1),i};return()=>b($,null,[b(Ge,E(_.value,{open:c.value,onAfterOpenChange:n=>{var d,p;n||O(),o.value=!1,(p=(d=_.value)==null?void 0:d.onAfterOpenChange)==null||p.call(d,n)},onClose:n=>{e.submitTimeout&&u.value||w(n)}}),{default:()=>[b(Z,E(S.value,{submitter:C.value,onFinish:async n=>await R(n),onValuesChange:n=>{var d;e.confirmOnValuesChange&&(o.value=!0),(d=e.onValuesChange)==null||d.call(e,n)},onReset:()=>{var n;e.confirmOnValuesChange&&(o.value=!1),(n=e.onReset)==null||n.call(e)},onInit:(n,d)=>{var p;y.value=d,(p=e.onInit)==null||p.call(e,n,d)}}),P.value)],...x.value,footer:e.submitter!==!1?()=>b("div",{style:"display: flex; justify-content: flex-end;",ref:r},null):void 0}),m.value])}}),_e=M({name:"ProModalForm",inheritAttrs:!1,props:{...me(),modalProps:{type:Object,default:void 0}},emits:["update:open"],setup(e,{slots:t,emit:l}){const s=A(!1),u=A(!1),o=A(!1),a=re(),y=A(),r=A(null),c=g({get:()=>{var n;return(n=e.open)!=null?n:s.value},set:n=>{typeof e.open>"u"?s.value=n:l("update:open",n)}});W(c,()=>{var n;(n=e.onOpenChange)==null||n.call(e,c.value)});const S=g(()=>{var n;return{...T(D(e,["onInit","onOpenChange","closeOnFinish","modalProps","title","width","confirmOnValuesChange","submitTimeout","onFinish","submitter"])),layout:(n=e.layout)!=null?n:"vertical"}}),P=g(()=>({...T(D(t,["trigger","closeIcon","extra","footer","title"]))})),_=g(()=>{var n;return T({...D((n=e.modalProps)!=null?n:{},["title","width","footer"]),width:e.width,title:e.title,footer:e.submitter===!1?null:void 0})}),x=g(()=>({...T(he(t,["closeIcon","title"]))})),C=g(()=>{var n,d,p,i;return e.submitter===!1?!1:L({teleport:r.value,reverse:!0,searchConfig:{submitText:(d=(n=_.value)==null?void 0:n.okText)!=null?d:a.getMessage("confirm.okText","确认"),resetText:(i=(p=_.value)==null?void 0:p.cancelText)!=null?i:a.getMessage("confirm.cancelText","取消")},resetButtonProps:{preventDefault:!0,disabled:e.submitTimeout?u.value:void 0,onClick:h=>{w(h)}}},e.submitter)}),m=g(()=>{if(!t.trigger)return null;const n=ue(t.trigger())[0];return be(n,{key:"trigger",...n?.props,onClick:async d=>{var p,i;c.value=!c.value,(i=(p=n?.props)==null?void 0:p.onClick)==null||i.call(p,d)}})}),w=n=>{var d,p;e.confirmOnValuesChange&&o.value?Be.confirm({title:a.getMessage("confirm.title","提示"),content:a.getMessage("confirm.formModalCloseContent","您的表单还没有保存，您确定关闭吗？"),onOk(){var i,h;c.value=!1,(h=(i=_.value)==null?void 0:i.onCancel)==null||h.call(i,n)},onCancel(){}}):(c.value=!1,(p=(d=_.value)==null?void 0:d.onCancel)==null||p.call(d,n))},O=()=>{var n,d,p;y.value&&!((n=_.value)!=null&&n.destroyOnClose)&&((p=(d=y.value)==null?void 0:d.reset)==null||p.call(d))},R=async n=>{var d;const p=(d=e.onFinish)==null?void 0:d.call(e,n);if(e.submitTimeout&&p instanceof Promise){u.value=!0;const h=setTimeout(()=>{u.value=!1},e.submitTimeout);p.finally(()=>{clearTimeout(h),u.value=!1})}const i=await p;return i&&(e.closeOnFinish?c.value=!1:o.value=!1),i};return()=>b($,null,[b(ot,E(_.value,{open:c.value,afterClose:()=>{var n,d;O(),o.value=!1,(d=(n=_.value)==null?void 0:n.afterClose)==null||d.call(n)},onCancel:n=>{e.submitTimeout&&u.value||w(n)}}),{default:()=>[b(Z,E(S.value,{submitter:C.value,onFinish:async n=>await R(n),onValuesChange:n=>{var d;e.confirmOnValuesChange&&(o.value=!0),(d=e.onValuesChange)==null||d.call(e,n)},onReset:()=>{var n;e.confirmOnValuesChange&&(o.value=!1),(n=e.onReset)==null||n.call(e)},onInit:(n,d)=>{var p;y.value=d,(p=e.onInit)==null||p.call(e,n,d)}}),P.value)],...x.value,footer:e.submitter!==!1?()=>b("div",{style:"display: flex; justify-content: flex-end;",ref:r},null):void 0}),m.value])}}),Ae;const jt={xs:513,sm:513,md:785,lg:992,xl:1057,xxl:1/0},xe={vertical:[[513,1,"vertical"],[785,2,"vertical"],[1057,3,"vertical"],[1/0,4,"vertical"]],default:[[513,1,"vertical"],[701,2,"vertical"],[1062,3,"horizontal"],[1352,3,"horizontal"],[1/0,4,"horizontal"]]},It=(e="horizontal",t,l)=>{if(l&&typeof l=="number")return{span:l,layout:e};const u=((l?["xs","sm","md","lg","xl","xxl"].map(o=>[jt[o],24/l[o],"horizontal"]):xe[e||"default"])||xe.default).find(o=>t<o[0]+16);return u?{span:24/u[1],layout:u?.[2]}:{span:8,layout:"horizontal"}},Tt=(e,t)=>e?.flatMap(l=>l.fieldType===Y.GROUP&&!l.title?l.props.children:t?{...l,rules:[],formItemProps:{...l.formItemProps,rules:[]}}:l),Dt=rt()?(Ae=document?.body)==null?void 0:Ae.clientWidth:1024;var pe=M({name:"ProQueryFilter",inheritAttrs:!1,props:{...Ie()},emits:["collapse","resize"],setup(e,{slots:t,emit:l,expose:s,attrs:u}){const o=A(0),a=A(0),y=A(0),r=re(),c=ae("query-filter"),S=Qe("wrapper"),P=A(),_=A([]),[x,C]=te(Dt),m=ke(P);Xe(S,v=>{const f=v[0],{width:F,height:B}=f?.contentRect||{};x.value!==F&&F>17&&C(F),l("resize",F,B)});const w=g(()=>It(e.layout,x.value+16,e.span)),O=g(()=>{if(e.defaultFormItemsNumber!==void 0)return e.defaultFormItemsNumber;if(e.defaultColsNumber!==void 0){const v=24/w.value.span-1;return e.defaultColsNumber>v?v:e.defaultColsNumber}return Math.max(1,24/w.value.span-1)}),R=g(()=>e.showHiddenNum&&_.value.filter(v=>v.hidden).length),n=g(()=>!(o.value<24||a.value<=O.value)),d=g(()=>{const v=y.value%24+w.value.span;return v>24?24-w.value.span:24-v}),p=g(()=>{if(e.labelWidth&&w.value.layout!=="vertical"&&e.labelWidth!=="auto")return{labelCol:{flex:`0 0 ${e.labelWidth}px`},wrapperCol:{style:{maxWidth:`calc(100% - ${e.labelWidth}px)`}},style:{flexWrap:"nowrap"}}}),[i,h]=te(()=>e.defaultCollapsed,{value:g(()=>e.collapsed),onChange:v=>{l("collapse",v)}}),j=g(()=>({...T(D(e,["defaultCollapsed","collapsed","grid","showLoading","defaultColsNumber","searchGutter","submitOnLoading","preserve","submitter","ignoreRules","searchText","resetText","labelWidth","layout","items","gridSubmitter","rowProps","defaultFormItemsNumber","showHiddenNum","ignoreRules","onCollapse","onReset"]))})),I=g(()=>e.submitter===!1?!1:L({style:{justifyContent:"flex-end"},reverse:!0,searchConfig:{submitText:e.searchText||r.getMessage("form.search","搜索"),resetText:e.resetText||r.getMessage("form.reset","重置")},colProps:{span:w.value.span,offset:d.value}},e.submitter));return W([w,i,()=>e.items],()=>{var v;let f=!1;y.value=0,a.value=0,o.value=0,(v=e.items)!=null&&v.length?_.value=Tt(e.items,e.ignoreRules).map((F,B)=>{var V;const k=(V=F.colSize)!=null?V:1,N=Math.min(w.value.span*(k||1),24);o.value+=N,a.value+=k,B===0&&(f=N===24&&!F.hidden);const Pe=F.hidden||e.submitter!==!1&&i.value&&(f||a.value>O.value)&&!!B;return Pe?e.preserve?{...F,colProps:{span:N},hidden:!0}:{...F,colProps:{span:0},hidden:!0}:(24-y.value%24<N&&(o.value+=24-y.value%24,y.value+=24-y.value%24),y.value+=N,{...F,hidden:Pe,formItemProps:p.value,colProps:{span:N}})}):_.value=[]},{immediate:!0}),s({formRef:P,...m}),()=>b("div",E({class:`${c}-wrap`,ref:"wrapper"},u),[b(Z,E({ref:P,class:c},j.value,{grid:!0,gridSubmitter:!0,rowProps:{gutter:e.searchGutter,justify:"start",class:`${c}-row`},showLoading:!1,submitter:I.value,items:_.value,layout:w.value.layout,onReset:v=>{var f,F;e.resetOnSubmit&&((f=P.value)==null||f.submit()),(F=e.onReset)==null||F.call(e,v)}}),{...t,submitter:({defaultDoms:v})=>b($,null,[v,n.value!==!1&&b("a",{class:`${c}-collapse-button`,onClick:()=>h(!i.value)},[i.value?r.getMessage("form.collapsed","展开"):r.getMessage("form.expand","收起"),!!R.value&&`(${R.value})`,b(lt,{style:{marginInlineStart:"0.5em",transition:"0.3s all",transform:`rotate(${i.value?0:.5}turn)`}},null)])])})])}});const qe=Symbol("StepsFormContextContext"),Nt=e=>{de(qe,e)},kt=()=>ce(qe,{});var Mt=M({name:"StepForm",inheritAttrs:!1,props:{index:Number,...Q()},emits:[],setup(e,{slots:t}){const l=ae("steps-form"),s=A(),{step:u,regForm:o,onFormFinish:a,setLoading:y,next:r,lastStep:c}=kt(),S=g(()=>e.index===u.value),P=g(()=>T(D(e,["index","onFinish"]))),_=async x=>{var C;if(e.name&&a(e.name,x),e.onFinish){y(!0),await((C=e.onFinish)==null?void 0:C.call(e,x))&&r(),y(!1);return}c.value||r()};return ve(()=>{o(s,e.index)}),()=>b("div",{class:{[`${l}-step`]:!0,[`${l}-step-active`]:S.value}},[b(Z,E({ref:s},P.value,{submitter:!1,onFinish:_}),t)])}});function H(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!fe(e)}const Lt={horizontal({stepsDom:e,formDom:t}){return b($,null,[b(J,{gutter:{xs:8,sm:16,md:24}},{default:()=>[b(X,{span:24},H(e)?e:{default:()=>[e]})]}),b(J,{gutter:{xs:8,sm:16,md:24}},{default:()=>[b(X,{span:24},H(t)?t:{default:()=>[t]})]})])},vertical({stepsDom:e,formDom:t}){let l;return b(J,{align:"stretch",wrap:!0,gutter:{xs:8,sm:16,md:24}},{default:()=>[b(X,{xxl:4,xl:6,lg:7,md:8,sm:10,xs:12},H(l=be(e,{style:{height:"100%"}}))?l:{default:()=>[l]}),b(X,null,{default:()=>[b("div",{style:{display:"flex",alignItems:"center",width:"100%",height:"100%"}},[t])]})]})}};var Ce=M({name:"ProStepsForm",inheritAttrs:!1,props:{...Te()},emits:[],setup(e,{slots:t,expose:l}){const s=re(),u=ae("steps-form"),o=A([]),a=new Map,[y,r]=yt(!1),c=g(()=>T(D(e,["name","current","stepsProps","containerStyle","onCurrentChange","steps","items","submitter","onFinish"]))),S=g(()=>{var f;return(f=e.steps)==null?void 0:f.map(F=>D(F,["formProps"]))}),[P,_]=te(0,{value:g(()=>e.current),onChange:e.onCurrentChange}),x=(f,F)=>{o.value[F]=f},C=g(()=>P.value===e.steps.length-1),m=async(f,F)=>{if(a.set(f,F),!C.value||!e.onFinish)return;r(!0);const B=L({},...Array.from(a.values()));try{await e.onFinish(B)&&(_(0),o.value.forEach(k=>{var N;return(N=k.value)==null?void 0:N.reset()}))}catch(V){console.log(V)}finally{r(!1)}},w=()=>{var f;const F=o.value[P.value];F&&((f=F.value)==null||f.submit())},O=()=>{P.value<1||_(P.value-1)},R=g(()=>{var f;let F;return e.submitter!==!1&&b(se,E({key:"next",type:"primary",loading:y.value},(f=e.submitter)==null?void 0:f.submitButtonProps,{onClick:()=>{w()}}),H(F=s.getMessage("stepsForm.next","下一步"))?F:{default:()=>[F]})}),n=g(()=>{var f;let F;return e.submitter!==!1&&b(se,E({key:"pre"},(f=e.submitter)==null?void 0:f.resetButtonProps,{onClick:()=>{O()}}),H(F=s.getMessage("stepsForm.prev","上一步"))?F:{default:()=>[F]})}),d=g(()=>{var f;let F;return e.submitter!==!1&&b(se,E({key:"submit",type:"primary",loading:y.value},(f=e.submitter)==null?void 0:f.submitButtonProps,{onClick:()=>{w()}}),H(F=s.getMessage("stepsForm.submit","提交"))?F:{default:()=>[F]})}),p=()=>{P.value>e.steps.length-2||_(P.value+1)},i=g(()=>{var f,F;const B=[],V=P.value||0;return V<1?((f=e.steps)==null?void 0:f.length)===1?B.push(d.value):B.push(R.value):V+1===((F=e.steps)==null?void 0:F.length)?B.push(n.value,d.value):B.push(n.value,R.value),B}),h=g(()=>{var f;return Lt[((f=e.stepsProps)==null?void 0:f.direction)||"horizontal"]}),j=g(()=>b("div",{class:`${u}-steps-container`,style:{maxWidth:Math.min(e.steps.length*320,1160)+"px"}},[b(nt,E(e.stepsProps,{items:S.value,current:P.value,onChange:void 0}),null)])),I=g(()=>b("div",{class:`${u}-container`,style:e.containerStyle},[e.items.map((f,F)=>{var B;const V=D(T(((B=e.steps[F])==null?void 0:B.formProps)||{}),["items"]),k=V.name||`${F}`,N=L({},c.value,V);return b(Mt,E({items:f,name:k,index:F},N),t)}),b(Ee,null,{default:()=>[i.value]})])),v=g(()=>{var f;const F={stepsDom:j.value,formDom:I.value};return(f=h.value)==null?void 0:f.call(h,F)});return Nt({step:P,loading:y,setLoading:r,lastStep:C,next:p,regForm:x,onFormFinish:m}),l({formArrayRef:o}),()=>b("div",{class:u},[v.value])}}),qt=M({name:"ProForm",inheritAttrs:!1,props:{layoutType:{type:String,default:"Form"},...dt()},setup(e,{slots:t,expose:l,attrs:s}){const u=A(),o=ke(u);return l(o),()=>{const{layoutType:a,items:y,...r}=e;return a==="DrawerForm"?b(Fe,E({ref:u},s,r,{items:y}),t):a==="ModalForm"?b(_e,E({ref:u},s,r,{items:y}),t):a==="QueryFilter"?b(pe,E({ref:u},s,r,{items:y}),t):a==="StepForm"?b(Ce,E({ref:u},s,r,{items:y}),t):b(Z,E({ref:u},s,r,{items:y}),t)}}});const Zt=ut(qt,{Drawer:Fe,Modal:_e,Filter:pe,Steps:Ce}),Jt=oe(Fe),el=oe(_e),tl=oe(pe),ll=oe(Ce);export{Et as F,Y as P,ye as R,Zt as a,el as b,Jt as c,tl as d,ll as e,yt as f,Ne as g,je as h,ge as i,vt as j,Ct as k,z as l,Yt as m,mt as n,he as p,gt as r,te as u};
