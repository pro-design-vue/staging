const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/FormGroup.CvfUdVqw.js","assets/chunks/FormTitle.CCioufYK.js","assets/chunks/framework.nwrEuAw0.js","assets/chunks/theme.CMJpiVTo.js","assets/chunks/run-function.ZYhDcPlt.js","assets/chunks/validate.B6x-sGAS.js","assets/chunks/index.GvmdERJw.js","assets/chunks/index.D3J5pdas.js","assets/chunks/install.BalIz2Dd.js","assets/chunks/index.D5lW5ejP.js","assets/chunks/index.CHg6CLv2.js","assets/chunks/useIntl.B4wPVsZJ.js","assets/chunks/index.qFcZDK2k.js","assets/chunks/FormSet.Bt_wwRq3.js","assets/chunks/useFieldValue.D0U2cDi0.js","assets/chunks/FormList.BnkwNOET.js","assets/chunks/FormListContext.C1lAsfCm.js","assets/chunks/FormItem.CInSF3J1.js","assets/chunks/index.yf2636jk.js"])))=>i.map(i=>d[i]);
import{P as Me}from"./index.GvmdERJw.js";import{d as j,r as Ke,w as M,c as de,p as ve,f as w,s as ie,o as fe,e as f,k as m,a0 as x,an as ee,ao as te,F as K,i as me,u as qe,h as Ge,J as We,E as $e,v as ze,aR as Ue,aZ as He}from"./framework.nwrEuAw0.js";import{N as G,O as L,s as H,p as $,Q as Z,S as Ve,B as we,v as Qe,i as Xe,U as Ye,u as Ze,W as Q,X as Je,Y as Be,o as et,Z as tt}from"./theme.CMJpiVTo.js";import{d as Ie,a as ce,e as lt}from"./validate.B6x-sGAS.js";import{a as B,o as I,P as ue}from"./index.D3J5pdas.js";import{u as le}from"./index.D5lW5ejP.js";import{u as ae}from"./useIntl.B4wPVsZJ.js";import{P as at}from"./index.qFcZDK2k.js";import{w as nt,a as ne}from"./install.BalIz2Dd.js";function rt(e){for(const l in e)Object.prototype.hasOwnProperty.call(e,l)&&delete e[l]}const Re=Symbol("FormSlotsContext"),Te=()=>de(Re,{});var ot=j({name:"FormSlotsContextProvider",inheritAttrs:!1,props:{value:{type:Object,default:()=>({})}},setup(e,{slots:l}){const a=Ke({});return M(()=>e.value,()=>{rt(a),Object.assign(a,e.value)},{immediate:!0}),ve(Re,a),()=>{var s;return(s=l.default)==null?void 0:s.call(l)}}});const ut=()=>({layout:{type:String,default:"horizontal"},labelCol:{type:Object},wrapperCol:{type:Object},colon:{type:Boolean,default:!0},requiredMark:{type:[Boolean,String],default:!0},labelAlign:{type:String,default:"right"},labelWrap:Boolean,disabled:{type:Boolean,default:!1},prefixCls:String,validateMessages:Object,validateTrigger:{type:[String,Array],default:"change"},validateOnRuleChange:{type:Boolean,default:!0},scrollToFirstError:{type:[Boolean,Object],default:!1},name:String}),zt=()=>({value:{type:[String,Array,Number,Object,Boolean]},readonly:{type:Boolean,default:void 0},readonlyProps:{type:Object,default:void 0},valueEnum:{type:[Function,Object],default:void 0},options:{type:[Array,Function],default:void 0},request:{type:Function,default:void 0},params:{type:[Function,Object],default:void 0},dependencies:{type:Array,default:void 0},onChange:{type:Function}}),U=()=>({...ut(),loading:{type:Boolean,default:void 0},showLoading:{type:Boolean,default:!0},submitOnLoading:{type:Boolean,default:!0},gridSubmitter:{type:Boolean,default:!1},omitNil:{type:Boolean,default:!0},readonly:Boolean,grid:Boolean,isKeyPressSubmit:Boolean,formKey:String,theme:{type:String,default:"custom"},customUi:{type:Boolean,default:!0},initialValues:{type:Object},readonlyProps:{type:Object},colProps:{type:Object},rowProps:{type:Object},dateFormatter:{type:[String,Function,Boolean],default:"string"},params:{type:Object},items:{type:Array},request:{type:Function},requestAbort:{type:Boolean},submitter:{type:[Object,Boolean],default:void 0},onReset:{type:Function},onFinish:{type:Function},onFinishFailed:{type:Function},onLoadingChange:{type:Function},onValuesChange:{type:Function},onInit:{type:Function,default:void 0}}),ge=()=>({...U(),submitTimeout:{type:Number,default:void 0},title:{type:String,default:void 0},width:{type:[String,Number],default:800},open:{type:Boolean,default:void 0},closeOnFinish:{type:Boolean,default:!0},confirmOnValuesChange:{type:Boolean,default:!0},onOpenChange:{type:Function,default:void 0}}),De=()=>({...U(),preserve:{type:Boolean,default:!0},defaultCollapsed:{type:Boolean,default:!0},collapsed:{type:Boolean,default:void 0},defaultColsNumber:Number,defaultFormItemsNumber:Number,labelWidth:{type:[String,Number],default:"80"},searchText:String,resetText:String,searchGutter:{type:Number,default:24},span:{type:[Number,Object]},showHiddenNum:Boolean,ignoreRules:Boolean,resetOnSubmit:Boolean,onCollapse:{type:Function,default:void 0},onResize:{type:Function,default:void 0}}),je=()=>({...U(),current:{type:Number,default:void 0},steps:{type:Array,default:()=>[]},items:{type:Array,default:()=>[]},stepsProps:{type:Object},containerStyle:{type:Object},onCurrentChange:{type:Function,default:void 0}}),st=()=>({...U(),...ge(),...De(),...je(),items:{type:Array,default:()=>[]}});function it(e,l){return e?Ie(e)&&e.startsWith("::")?l[e.substring(2)]:e:null}const Ne=Symbol("FormContext"),ct=e=>{ve(Ne,e)},ye=()=>de(Ne,{}),ke=(e,{slots:l})=>{var a;return(a=l.default)==null?void 0:a.call(l)};ke.displayName="RenderSlot";ke.inheritAttrs=!1;const be=(e,{slots:l})=>{var a,s,c;return typeof e.vnode=="function"?((a=e.vnode)==null?void 0:a.call(e,e.props||{}))||((s=l.default)==null?void 0:s.call(l)):e.vnode||((c=l.default)==null?void 0:c.call(l))};be.props=["vnode","props"];be.inheritAttrs=!1;function dt(e){const l=w(null);return async(s,c)=>{var d,n;(d=l.value)==null||d.abort();const i=new AbortController;return l.value=i,await Promise.race([(n=e.request)==null?void 0:n.call(e,s,c),new Promise((h,p)=>{var F,P;(P=(F=l.value)==null?void 0:F.signal)==null||P.addEventListener("abort",()=>{p(new Error("aborted"))})})])}}function vt(e){const l=typeof e=="function"?e():e,a=w(l);function s(c){a.value=c}return[a,s]}var X=(e=>(e.FORM_SET="formSet",e.FORM_LIST="formList",e.GROUP="group",e.DIVIDER="divider",e.TEXT="text",e.DIGIT="digit",e.DIGIT_RANGE="digitRange",e.SELECT="select",e.TREE_SELECT="treeSelect",e.CASCADER="cascader",e.TEXTAREA="textarea",e.PASSWORD="password",e.CHECKBOX="checkbox",e.CHECKBOX_GROUP="checkboxGroup",e.RADIO_GROUP="radioGroup",e.SWITCH="switch",e.SLIDER="slider",e.RATE="rate",e.DATE="date",e.DATE_RANGE="dateRange",e.TIME="time",e.TIME_RANGE="timeRange",e.UPLOAD_BUTTON="uploadButton",e.UPLOAD_DRAGGER="uploadDragger",e.UPLOAD_PICTURE="uploadPicture",e.UPLOAD_PICTURE_LIST="uploadPictureList",e.EDITOR="editor",e))(X||{});function re(e){return{getFieldValue:y=>{var _;return(_=e.value)==null?void 0:_.getFieldValue(y)},getFieldsValue:y=>{var _;return(_=e.value)==null?void 0:_.getFieldsValue(y)},resetInitialValues:y=>{var _;return(_=e.value)==null?void 0:_.resetInitialValues(y)},getFieldFormatValue:y=>{var _;return(_=e.value)==null?void 0:_.getFieldFormatValue(y)},getFieldFormatValueObject:y=>{var _;return(_=e.value)==null?void 0:_.getFieldFormatValueObject(y)},validateFieldsReturnFormatValue:y=>{var _;return(_=e.value)==null?void 0:_.validateFieldsReturnFormatValue(y)},setFieldValue:(y,_)=>{var O;return(O=e.value)==null?void 0:O.setFieldValue(y,_)},setFieldsValue:(y,_=!0)=>{var O;return(O=e.value)==null?void 0:O.setFieldsValue(y,_)},resetField:y=>{var _;return(_=e.value)==null?void 0:_.resetField(y)},clearValidate:y=>{var _;return(_=e.value)==null?void 0:_.clearValidate(y)},validateFields:y=>{var _;return(_=e.value)==null?void 0:_.validateFields(y)},reset:()=>{var y;return(y=e.value)==null?void 0:y.reset()},submit:()=>{var y;return(y=e.value)==null?void 0:y.submit()}}}const ft=e=>{const l=w(!0),a=w(!1),s=ie({...e.initialValues}),c=dt({request:e.request});return fe(async()=>{var d;if(e.request&&!e.requestAbort){l.value=!0,a.value=!0;const n=await c(e.params);s.value=(d=G({},s.value,n))!=null?d:{},Promise.resolve().then(()=>{l.value=!1,a.value=!1})}}),{initialValues:s,hasInitial:l,requestLoading:a}},mt=()=>{const e=ie([]),l=ie([]),a=f(()=>e.value.map(o=>o.split(":")[1])),s=(o,h,p)=>{Array.isArray(p)||(p=[p]);const F=o.filter(P=>!P.startsWith(h+":"));return F.push(...p.map(P=>`${h}:${P}`)),Array.from(new Set(F))},c=(o,h)=>{e.value=s(e.value,o,h)},d=(o,h)=>{l.value=s(l.value,o,h)},n=f(()=>e.value.filter(o=>!a.value.includes(o.split(":")[0])).map(o=>o.split(":")[1])),i=f(()=>l.value.filter(o=>!a.value.includes(o.split(":")[0])).map(o=>o.split(":")[1]));return{allHiddenKeys:n,hiddenKeys:e,allDisabledKeys:i,disabledKeys:l,updateHiddenKeys:c,updateDisabledKeys:d}},q=e=>{if(e)return Ie(e)?e.indexOf(".")>-1?e.split("."):[e]:e},se=(e,l,a)=>(console.log("🚀 ~ transformKey ~ parentKey:",a),console.log("🚀 ~ transformKey ~ paramsOmitNil:",l),e);function gt({props:e,formRef:l,formData:a,initialValues:s,hasInitial:c,onFinish:d,onReset:n,onFinishFailed:i}){const o=t=>{const r=q(t);if(!r)throw new Error("name is require");return $(a.value,r)},h=t=>{if(t===!0||t===void 0)return L(a.value);const r={};return t.forEach(g=>{const C=q(g),v=$(a.value,C);v!==void 0&&H(r,C,v)}),r},p=t=>{const r=q(t);if(!r)throw new Error("name is require");const g=$(a.value,r),C=H({},r,g);return $(se(C,e.omitNil,r),r)},F=t=>{const r=q(t);if(!r)throw new Error("name is require");const g=$(a.value,r),C=H({},r,g);return se(C,e.omitNil,r)},P=async t=>{var r;if(!Array.isArray(t)&&t)throw new Error("nameList must be array");const g=await((r=l.value)==null?void 0:r.validateFields(t)),C=se(g,e.omitNil);return C??{}},A=(t,r)=>{const g=q(t);if(!g)throw new Error("name is require");H(a.value,g,r)},y=(t,r=!0)=>{if(!t)throw new Error("values is require");r?a.value=G({},a.value,t):a.value=L(t)},_=t=>{if(!t)throw new Error("values is require");if(!ce(t))throw new Error("values must be object");c.value=!0,s.value=L(t)},O=()=>{var t;c.value=!0,(t=l.value)==null||t.clearValidate(),a.value=L(s.value),Promise.resolve().then(()=>{c.value=!1,n?.(a.value)})},R=t=>{var r;if(!q(t))throw new Error("name is require");(r=l.value)==null||r.clearValidate(t),H(a.value,t,L($(s.value,t)))},V=t=>{var r;(r=l.value)==null||r.clearValidate(t)},T=t=>new Promise((r,g)=>{var C;(C=l.value)==null||C.validateFields(t).then(v=>{r({...a.value,...v})}).catch(v=>{g(v)})});return{getFieldValue:o,getFieldsValue:h,resetInitialValues:_,getFieldFormatValue:p,getFieldFormatValueObject:F,validateFieldsReturnFormatValue:P,setFieldValue:A,setFieldsValue:y,resetField:R,clearValidate:V,validateFields:T,reset:O,submit:()=>{T().then(t=>{if(d)try{d(t)}catch(r){console.error(r)}}).catch(t=>{i&&i(t)})}}}var yt=j({name:"FormRowWrapper",inheritAttrs:!1,props:{rowProps:{type:Object,default:void 0},grid:{type:Boolean,default:void 0}},setup(e,{slots:l,attrs:a}){const{rowProps:s,grid:c}=ye(),d=f(()=>{var i;return(i=e.grid)!=null?i:c?.value}),n=f(()=>{var i;return(i=e.rowProps)!=null?i:s?.value});return()=>{var i;return d?.value?m(Z,x(n.value,{class:a.class}),{default:()=>{var o;return[(o=l.default)==null?void 0:o.call(l)]}}):(i=l.default)==null?void 0:i.call(l)}}});function he(e,l){const a={};return Array.isArray(l)&&l.length>0&&Object.keys(e||{}).forEach(s=>{l.includes(s)&&(a[s]=e[s])}),a}const bt=ee(()=>te(()=>import("./FormGroup.CvfUdVqw.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),ht=ee(()=>te(()=>import("./FormSet.Bt_wwRq3.js"),__vite__mapDeps([13,14,3,2,1,4,7,5,8,9,6,10,11,12]))),Ft=ee(()=>te(()=>import("./FormList.BnkwNOET.js"),__vite__mapDeps([15,16,2,1,3,14,4,7,5,8,9,6,10,11,12]))),_t=ee(()=>te(()=>import("./FormItem.CInSF3J1.js"),__vite__mapDeps([17,14,3,2,16,18,11,9,8,7,5,4,12,10,1,6]))),pt=["min","max","isValidateList","emptyListMessage","creatorRecord","creatorButtonProps","alwaysShowItemLabel","actionGuard","copyIconProps","deleteIconProps","onAfterAdd","onAfterRemove"],Ct=["action","creator","item"];var Pt=j({name:"FormItems",inheritAttrs:!1,props:{list:{type:Array,default:()=>[]},type:{type:String,default:""},grid:{type:Boolean,default:void 0},spaceProps:{type:Object,default:()=>({size:[32,0],wrap:!0})}},setup(e){const{grid:l,allHiddenKeys:a}=ye(),s=Te(),c=f(()=>{var n;return(n=e.grid)!=null?n:l?.value}),d=f(()=>e.list.filter(n=>!a.value.includes(n.key)).map(n=>{var i;if(n.fieldType===X.GROUP)return m(bt,{key:n.key,items:n.children,title:n.title,tooltip:n.tooltip,colProps:n.colProps,rowProps:n.rowProps,spaceProps:n.spaceProps,grid:n.grid,item:n,formItemProps:n.formItemProps},null);if(n.fieldType===X.FORM_SET)return m(ht,{key:n.key,name:n.name,items:n.children,title:n.title,tooltip:n.tooltip,colProps:n.colProps,rowProps:n.rowProps,spaceProps:n.spaceProps,formItemProps:n.formItemProps,initialValue:n.initialValue,convertValue:n.convertValue,transform:n.transform},null);if(n.fieldType===X.FORM_LIST){const o=B(he((i=n.fieldProps)!=null?i:{},pt)),h={};return Ct.forEach(p=>{var F;const P=it((F=n.fieldProps)==null?void 0:F[`${p}Render`],s);P&&(h[p]=A=>m(be,{vnode:P,props:A},null))}),m(Ft,x({key:n.key,name:n.name,originName:n.originName,items:n.children,title:n.title,tooltip:n.tooltip,rules:n.rules,colProps:n.colProps,rowProps:n.rowProps,formItemProps:n.formItemProps,initialValue:n.initialValue,convertValue:n.convertValue,transform:n.transform},o),{...h})}return m(_t,{key:n.key,item:n},null)}));return()=>e.type==="space"&&!c?.value?m(Ve,x(e.spaceProps,{align:"start"}),{default:()=>[d.value]}):d.value}});function Oe(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!me(e)}var St=j({name:"FormSubmitter",inheritAttrs:!1,props:{loading:{type:Boolean,default:void 0},reverse:{type:Boolean,default:void 0},onSubmit:{type:Function,default:void 0},onReset:{type:Function,default:void 0},searchConfig:{type:Object,default:void 0},submitButtonProps:{type:[Object,Boolean],default:void 0},resetButtonProps:{type:[Object,Boolean],default:void 0},render:{type:[Function,Boolean],default:void 0}},setup(e,{attrs:l}){const{action:a}=ye(),s=Te(),c=()=>{var o;a.submit(),(o=e.onSubmit)==null||o.call(e)},d=()=>{var o,h;(o=a.reset)==null||o.call(a),(h=e.onReset)==null||h.call(e)},n=f(()=>{const{searchConfig:o={},resetButtonProps:h={}}=e;if(h===!1)return null;const{resetText:p="重置"}=o;return m(we,x(I(h,["preventDefault","onClick"]),{key:"reset",onClick:F=>{var P;h.preventDefault||d(),(P=h.onClick)==null||P.call(h,F)}}),Oe(p)?p:{default:()=>[p]})}),i=f(()=>{const{searchConfig:o={},submitButtonProps:h={}}=e;if(h===!1)return null;const{submitText:p="提交"}=o;return m(we,x({type:"primary"},I(h||{},["preventDefault","onClick"]),{key:"submit",onClick:F=>{var P;h.preventDefault||c(),(P=h.onClick)==null||P.call(h,F)}}),Oe(p)?p:{default:()=>[p]})});return()=>{if(e.render===!1)return null;const{render:o=s.submitter}=e,h=e.reverse?m(K,null,[n.value,i.value]):m(K,null,[i.value,n.value]),p=o?o({props:{...e,submit:c,reset:d},action:a,defaultDoms:h}):h;return m("div",{style:{display:"flex",gap:"8px",alignItems:"center",...l.style},class:l.class},[p])}}});function J(e,l){const{defaultValue:a,value:s=w()}=l||{};let c=typeof e=="function"?e():e;s.value!==void 0&&(c=qe(s)),a!==void 0&&(c=typeof a=="function"?a():a);const d=w(c),n=w(c);Ge(()=>{let o=s.value!==void 0?s.value:d.value;l?.postState&&(o=l.postState(o)),n.value=o});function i(o){const h=n.value;d.value=o,We(n.value)!==o&&l?.onChange&&l?.onChange(o,h)}return M(s,()=>{d.value=s.value}),[n,i]}function wt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!me(e)}let xe=0;var Y=j({name:"BaseForm",inheritAttrs:!1,props:{...U()},setup(e,{slots:l,expose:a,attrs:s}){const c=w(!1),d=w(),n=le("form"),i=w({}),o=w([]),h=f(()=>{var v;return(v=e.formKey)!=null?v:xe.toString()}),[p,F]=J(!1,{value:f(()=>e.loading),onChange:v=>{var u;(u=e.onLoadingChange)==null||u.call(e,v)}}),P=f(()=>{var v;return{[n]:!0,[`${(v=s.class)!=null?v:""}`]:!0}}),A=f(()=>{var v;return{...B(I(e,["colProps","submitter","loading","showLoading","omitNil","grid","theme","customUi","gridSubmitter","requestAbort","isKeyPressSubmit","formKey","initialValues","rowProps","dateFormatter","params","readonly","readonlyProps","items","request","submitOnLoading","onLoadingChange","onFinish","onValuesChange"])),layout:(v=e.layout)!=null?v:"vertical"}}),y=v=>v.filter(u=>!u.hidden).sort((u,b)=>{var S,E;return b.order||u.order?((S=b.order)!=null?S:0)-((E=u.order)!=null?E:0):0}).map((u,b)=>{var S,E;const D=q(u.name),k=(S=u.key)!=null?S:D?(D??[]).join("_"):b;return B({...u,originName:(E=u.originName)!=null?E:u.name,name:D,key:k})}).filter(u=>!!u);M(()=>e.items,()=>{var v;o.value=y((v=e.items)!=null?v:[])},{immediate:!0});const{initialValues:_,hasInitial:O,requestLoading:R}=ft(e);M(_,(v,u)=>{Xe(v,u)||(i.value=L(v),(!e.request||e.requestAbort)&&Promise.resolve().then(()=>{O.value=!1}))},{immediate:!0});const V=Qe(()=>{var v;(v=e.onValuesChange)==null||v.call(e,L(i.value))},200),T=async()=>{if(e.onFinish){if(e.showLoading){if(p.value)return;F(!0)}try{const v=L(i.value);await e.onFinish(v)}catch(v){console.log("🚀 ~ onFinish ~ error:",v)}finally{e.showLoading&&F(!1)}}};M(i,()=>{O.value||V()},{deep:!0});const N=mt(),t=gt({props:e,formRef:d,formData:i,initialValues:_,hasInitial:O,onFinish:T,onReset:e.onReset,onFinishFailed:e.onFinishFailed}),r=f(()=>typeof e.submitter=="boolean"||!e.submitter?{}:I(e.submitter,["colProps"])),g=f(()=>e.submitter===!1||e.readonly?{}:e.gridSubmitter&&ce(e.submitter)&&ce(e.submitter.colProps)?{...e.submitter.colProps}:{span:24}),C=f(()=>{if(e.submitter===!1||e.readonly)return;const v=r.value.submitButtonProps===!1?!1:{loading:p.value,...r.value.submitButtonProps},u=r.value.resetButtonProps===!1?!1:{disabled:p.value,...r.value.resetButtonProps},b=m(St,x({key:"submitter"},r.value,{submitButtonProps:v,resetButtonProps:u}),null);return r.value.teleport?m($e,{to:r.value.teleport},wt(b)?b:{default:()=>[b]}):b});return fe(()=>{var v,u,b;c.value=!0,xe+=1;const S=(u=(v=d.value)==null?void 0:v.getFieldsValue)==null?void 0:u.call(v,!0);(b=e.onInit)==null||b.call(e,S,t)}),ct({...N,action:t,formKey:h,mountedRef:c,prefixCls:n,initialValues:_,formData:i,hasInitial:O,theme:f(()=>e.theme),customUi:f(()=>e.customUi),grid:f(()=>e.grid),disabled:f(()=>e.disabled),readonly:f(()=>e.readonly),readonlyProps:f(()=>e.readonlyProps),rowProps:f(()=>{var v;return(v=e.rowProps)!=null?v:{gutter:16}}),colProps:f(()=>{var v;return(v=e.colProps)!=null?v:{xs:24}}),formatItems:y}),a({...t}),()=>m(ot,{value:{...l}},{default:()=>[m(Ye,x({ref:d},A.value,{class:P.value,model:i.value,style:s.style}),{default:()=>[m(Ze,{spinning:R.value||e.submitOnLoading&&p.value},{default:()=>[m(yt,null,{default:()=>[m(Pt,{list:o.value},null),e.gridSubmitter&&e.submitter!==!1&&m(Q,g.value,{default:()=>[m(Je,{label:" ",colon:!1,class:`${n}-submitter-form-item`},{default:()=>[C.value]})]})]}),!e.gridSubmitter&&C.value]})]})]})}});function Ot(e){return Array.isArray(e)&&e.length===1&&(e=e[0]),e?.__v_isVNode&&typeof e.type!="symbol"}function xt(e){return e&&(e.type===Comment||e.type===K&&e.children.length===0||e.type===Text&&e.children.trim()==="")}function oe(e=[]){const l=[];return e.forEach(a=>{Array.isArray(a)?l.push(...a):a?.type===K?l.push(...oe(a.children)):l.push(a)}),l.filter(a=>!xt(a)&&Ot(a))}function Fe(e,l={},a=!0,s=!1){let c=e;if(Array.isArray(e)&&(c=oe(e)[0]),!c)return null;const d=ze(c,l,s);return d.props=a?{...d.props,...l}:d.props,d}var _e=j({name:"ProDrawerForm",inheritAttrs:!1,props:{...ge(),drawerProps:{type:Object,default:void 0}},emits:["update:open"],setup(e,{slots:l,emit:a,expose:s}){const c=w(!1),d=w(!1),n=w(!1),i=ae(),o=w(),h=w(null),p=re(o),F=f({get:()=>{var t;return(t=e.open)!=null?t:c.value},set:t=>{typeof e.open>"u"?c.value=t:a("update:open",t)}});M(F,()=>{var t;(t=e.onOpenChange)==null||t.call(e,F.value)});const P=f(()=>({...B(I(e,["onOpenChange","closeOnFinish","drawerProps","title","width","confirmOnValuesChange","submitTimeout","onFinish","submitter"])),layout:"vertical"})),A=f(()=>({...B(I(l,["trigger","closeIcon","extra","footer","title"]))})),y=f(()=>{var t;return B({...I((t=e.drawerProps)!=null?t:{},["title","width","open","footer","okText","cancelText"]),width:e.width,title:e.title})}),_=f(()=>({...B(he(l,["closeIcon","extra","title"]))})),O=f(()=>{var t,r,g,C;return e.submitter===!1?!1:G({teleport:h.value,reverse:!0,searchConfig:{submitText:(r=(t=e.drawerProps)==null?void 0:t.okText)!=null?r:i.getMessage("confirm.okText","确认"),resetText:(C=(g=e.drawerProps)==null?void 0:g.cancelText)!=null?C:i.getMessage("confirm.cancelText","取消")},resetButtonProps:{preventDefault:!0,disabled:e.submitTimeout?d.value:void 0,onClick:v=>{V(v)}}},e.submitter)}),R=f(()=>{if(!l.trigger)return null;const t=oe(l.trigger())[0];return Fe(t,{key:"trigger",...t?.props,onClick:async r=>{var g,C;F.value=!F.value,(C=(g=t?.props)==null?void 0:g.onClick)==null||C.call(g,r)}})}),V=t=>{var r,g;e.confirmOnValuesChange&&n.value?Be.confirm({title:i.getMessage("confirm.title","提示"),content:i.getMessage("confirm.formModalCloseContent","您的表单还没有保存，您确定关闭吗？"),onOk(){var C,v;F.value=!1,(v=(C=y.value)==null?void 0:C.onClose)==null||v.call(C,t)},onCancel(){}}):(F.value=!1,(g=(r=y.value)==null?void 0:r.onClose)==null||g.call(r,t))},T=()=>{var t,r,g;o.value&&!((t=y.value)!=null&&t.destroyOnClose)&&((g=(r=o.value)==null?void 0:r.reset)==null||g.call(r))},N=async t=>{var r;const g=(r=e.onFinish)==null?void 0:r.call(e,t);if(e.submitTimeout&&g instanceof Promise){d.value=!0;const v=setTimeout(()=>{d.value=!1},e.submitTimeout);g.finally(()=>{clearTimeout(v),d.value=!1})}const C=await g;return C&&(e.closeOnFinish?F.value=!1:n.value=!1),C};return s({formRef:o,...p}),()=>m(K,null,[m(Me,x(y.value,{open:F.value,onAfterOpenChange:t=>{var r,g;t||T(),n.value=!1,(g=(r=y.value)==null?void 0:r.onAfterOpenChange)==null||g.call(r,t)},onClose:t=>{e.submitTimeout&&d.value||V(t)}}),{default:()=>[m(Y,x({ref:o},P.value,{submitter:O.value,onFinish:async t=>await N(t),onValuesChange:t=>{var r;e.confirmOnValuesChange&&(n.value=!0),(r=e.onValuesChange)==null||r.call(e,t)},onReset:()=>{var t;e.confirmOnValuesChange&&(n.value=!1),(t=e.onReset)==null||t.call(e)}}),A.value)],..._.value,footer:e.submitter!==!1?()=>m("div",{style:"display: flex; justify-content: flex-end;",ref:h},null):void 0}),R.value])}}),pe=j({name:"ProModalForm",inheritAttrs:!1,props:{...ge(),modalProps:{type:Object,default:void 0}},emits:["update:open"],setup(e,{slots:l,emit:a,expose:s}){const c=w(!1),d=w(!1),n=w(!1),i=ae(),o=w(),h=w(null),p=re(o),F=f({get:()=>{var t;return(t=e.open)!=null?t:c.value},set:t=>{typeof e.open>"u"?c.value=t:a("update:open",t)}});M(F,()=>{var t;(t=e.onOpenChange)==null||t.call(e,F.value)});const P=f(()=>{var t;return{...B(I(e,["onOpenChange","closeOnFinish","modalProps","title","width","confirmOnValuesChange","submitTimeout","onFinish","submitter"])),layout:(t=e.layout)!=null?t:"vertical"}}),A=f(()=>({...B(I(l,["trigger","closeIcon","extra","footer","title"]))})),y=f(()=>{var t;return B({...I((t=e.modalProps)!=null?t:{},["title","width","footer"]),width:e.width,title:e.title,footer:e.submitter===!1?null:void 0})}),_=f(()=>({...B(he(l,["closeIcon","title"]))})),O=f(()=>{var t,r,g,C;return e.submitter===!1?!1:G({teleport:h.value,reverse:!0,searchConfig:{submitText:(r=(t=y.value)==null?void 0:t.okText)!=null?r:i.getMessage("confirm.okText","确认"),resetText:(C=(g=y.value)==null?void 0:g.cancelText)!=null?C:i.getMessage("confirm.cancelText","取消")},resetButtonProps:{preventDefault:!0,disabled:e.submitTimeout?d.value:void 0,onClick:v=>{V(v)}}},e.submitter)}),R=f(()=>{if(!l.trigger)return null;const t=oe(l.trigger())[0];return Fe(t,{key:"trigger",...t?.props,onClick:async r=>{var g,C;F.value=!F.value,(C=(g=t?.props)==null?void 0:g.onClick)==null||C.call(g,r)}})}),V=t=>{var r,g;e.confirmOnValuesChange&&n.value?Be.confirm({title:i.getMessage("confirm.title","提示"),content:i.getMessage("confirm.formModalCloseContent","您的表单还没有保存，您确定关闭吗？"),onOk(){var C,v;F.value=!1,(v=(C=y.value)==null?void 0:C.onCancel)==null||v.call(C,t)},onCancel(){}}):(F.value=!1,(g=(r=y.value)==null?void 0:r.onCancel)==null||g.call(r,t))},T=()=>{var t,r,g;o.value&&!((t=y.value)!=null&&t.destroyOnClose)&&((g=(r=o.value)==null?void 0:r.reset)==null||g.call(r))},N=async t=>{var r;const g=(r=e.onFinish)==null?void 0:r.call(e,t);if(e.submitTimeout&&g instanceof Promise){d.value=!0;const v=setTimeout(()=>{d.value=!1},e.submitTimeout);g.finally(()=>{clearTimeout(v),d.value=!1})}const C=await g;return C&&(e.closeOnFinish?F.value=!1:n.value=!1),C};return s({formRef:o,...p}),()=>m(K,null,[m(at,x(y.value,{open:F.value,afterClose:()=>{var t,r;T(),n.value=!1,(r=(t=y.value)==null?void 0:t.afterClose)==null||r.call(t)},onCancel:t=>{e.submitTimeout&&d.value||V(t)}}),{default:()=>[m(Y,x({ref:o},P.value,{submitter:O.value,onFinish:async t=>await N(t),onValuesChange:t=>{var r;e.confirmOnValuesChange&&(n.value=!0),(r=e.onValuesChange)==null||r.call(e,t)},onReset:()=>{var t;e.confirmOnValuesChange&&(n.value=!1),(t=e.onReset)==null||t.call(e)}}),A.value)],..._.value,footer:e.submitter!==!1?()=>m("div",{style:"display: flex; justify-content: flex-end;",ref:h},null):void 0}),R.value])}}),Ae;const At={xs:513,sm:513,md:785,lg:992,xl:1057,xxl:1/0},Ee={vertical:[[513,1,"vertical"],[785,2,"vertical"],[1057,3,"vertical"],[1/0,4,"vertical"]],default:[[513,1,"vertical"],[701,2,"vertical"],[1062,3,"horizontal"],[1352,3,"horizontal"],[1/0,4,"horizontal"]]},Et=(e="horizontal",l,a)=>{if(a&&typeof a=="number")return{span:a,layout:e};const c=((a?["xs","sm","md","lg","xl","xxl"].map(d=>[At[d],24/a[d],"horizontal"]):Ee[e||"default"])||Ee.default).find(d=>l<d[0]+16);return c?{span:24/c[1],layout:c?.[2]}:{span:8,layout:"horizontal"}},Vt=(e,l)=>e?.flatMap(a=>a.fieldType===X.GROUP&&!a.title?a.props.children:l?{...a,rules:[],formItemProps:{...a.formItemProps,rules:[]}}:a),Bt=lt()?(Ae=document?.body)==null?void 0:Ae.clientWidth:1024;var Ce=j({name:"ProQueryFilter",inheritAttrs:!1,props:{...De()},emits:["collapse","resize"],setup(e,{slots:l,emit:a,expose:s,attrs:c}){const d=w(0),n=w(0),i=w(0),o=ae(),h=le("query-filter"),p=Ue("wrapper"),F=w(),P=w([]),[A,y]=J(Bt),_=re(F);He(p,u=>{const b=u[0],{width:S,height:E}=b?.contentRect||{};A.value!==S&&S>17&&y(S),a("resize",S,E)});const O=f(()=>Et(e.layout,A.value+16,e.span)),R=f(()=>{if(e.defaultFormItemsNumber!==void 0)return e.defaultFormItemsNumber;if(e.defaultColsNumber!==void 0){const u=24/O.value.span-1;return e.defaultColsNumber>u?u:e.defaultColsNumber}return Math.max(1,24/O.value.span-1)}),V=f(()=>e.showHiddenNum&&P.value.filter(u=>u.hidden).length),T=f(()=>!(d.value<24||n.value<=R.value)),N=f(()=>{const u=i.value%24+O.value.span;return u>24?24-O.value.span:24-u}),t=f(()=>{if(e.labelWidth&&O.value.layout!=="vertical"&&e.labelWidth!=="auto")return{labelCol:{flex:`0 0 ${e.labelWidth}px`},wrapperCol:{style:{maxWidth:`calc(100% - ${e.labelWidth}px)`}},style:{flexWrap:"nowrap"}}}),[r,g]=J(()=>e.defaultCollapsed,{value:f(()=>e.collapsed),onChange:u=>{a("collapse",u)}}),C=f(()=>({...B(I(e,["defaultCollapsed","collapsed","grid","showLoading","defaultColsNumber","searchGutter","submitOnLoading","preserve","submitter","ignoreRules","searchText","resetText","labelWidth","layout","items","gridSubmitter","rowProps","defaultFormItemsNumber","showHiddenNum","ignoreRules","onCollapse","onReset"]))})),v=f(()=>e.submitter===!1?!1:G({style:{justifyContent:"flex-end"},reverse:!0,searchConfig:{submitText:e.searchText||o.getMessage("form.search","搜索"),resetText:e.resetText||o.getMessage("form.reset","重置")},colProps:{span:O.value.span,offset:N.value}},e.submitter));return M([O,r,()=>e.items],()=>{var u;let b=!1;i.value=0,n.value=0,d.value=0,(u=e.items)!=null&&u.length?P.value=Vt(e.items,e.ignoreRules).map((S,E)=>{var D;const k=(D=S.colSize)!=null?D:1,W=Math.min(O.value.span*(k||1),24);d.value+=W,n.value+=k,E===0&&(b=W===24&&!S.hidden);const Se=S.hidden||r.value&&(b||n.value>R.value)&&!!E;return Se?e.preserve?{...S,colProps:{span:W},hidden:!0}:{...S,colProps:{span:0},hidden:!0}:(24-i.value%24<W&&(d.value+=24-i.value%24,i.value+=24-i.value%24),i.value+=W,{...S,hidden:Se,formItemProps:t.value,colProps:{span:W}})}):P.value=[]},{immediate:!0}),s({formRef:F,..._}),()=>m("div",x({class:`${h}-wrap`,ref:"wrapper"},c),[m(Y,x({ref:F,class:h},C.value,{grid:!0,gridSubmitter:!0,rowProps:{gutter:e.searchGutter,justify:"start",class:`${h}-row`},submitOnLoading:!1,submitter:v.value,items:P.value,layout:O.value.layout,onReset:u=>{var b,S;e.resetOnSubmit&&((b=F.value)==null||b.submit()),(S=e.onReset)==null||S.call(e,u)}}),{...l,submitter:({defaultDoms:u})=>m(K,null,[u,T.value!==!1&&m("a",{class:`${h}-collapse-button`,onClick:()=>g(!r.value)},[r.value?o.getMessage("form.collapsed","展开"):o.getMessage("form.expand","收起"),!!V.value&&`(${V.value})`,m(et,{style:{marginInlineStart:"0.5em",transition:"0.3s all",transform:`rotate(${r.value?0:.5}turn)`}},null)])])})])}});const Le=Symbol("StepsFormContextContext"),It=e=>{ve(Le,e)},Rt=()=>de(Le,{});var Tt=j({name:"StepForm",inheritAttrs:!1,props:{index:Number,...U()},emits:[],setup(e,{slots:l}){const a=le("steps-form"),s=w(),{step:c,regForm:d,onFormFinish:n,setLoading:i,next:o,lastStep:h}=Rt(),p=f(()=>e.index===c.value),F=f(()=>B(I(e,["index","onFinish"]))),P=async A=>{var y;if(e.name&&n(e.name,A),e.onFinish){i(!0),await((y=e.onFinish)==null?void 0:y.call(e,A))&&o(),i(!1);return}h.value||o()};return fe(()=>{d(s,e.index)}),()=>m("div",{class:{[`${a}-step`]:!0,[`${a}-step-active`]:p.value}},[m(Y,x({ref:s},F.value,{submitter:!1,onFinish:P}),l)])}});function z(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!me(e)}const Dt={horizontal({stepsDom:e,formDom:l}){return m(K,null,[m(Z,{gutter:{xs:8,sm:16,md:24}},{default:()=>[m(Q,{span:24},z(e)?e:{default:()=>[e]})]}),m(Z,{gutter:{xs:8,sm:16,md:24}},{default:()=>[m(Q,{span:24},z(l)?l:{default:()=>[l]})]})])},vertical({stepsDom:e,formDom:l}){let a;return m(Z,{align:"stretch",wrap:!0,gutter:{xs:8,sm:16,md:24}},{default:()=>[m(Q,{xxl:4,xl:6,lg:7,md:8,sm:10,xs:12},z(a=Fe(e,{style:{height:"100%"}}))?a:{default:()=>[a]}),m(Q,null,{default:()=>[m("div",{style:{display:"flex",alignItems:"center",width:"100%",height:"100%"}},[l])]})]})}};var Pe=j({name:"ProStepsForm",inheritAttrs:!1,props:{...je()},emits:[],setup(e,{slots:l}){const a=ae(),s=le("steps-form"),c=w([]),d=new Map,[n,i]=vt(!1),o=f(()=>B(I(e,["name","current","stepsProps","containerStyle","onCurrentChange","steps","items","submitter","onFinish"]))),h=f(()=>{var u;return(u=e.steps)==null?void 0:u.map(b=>I(b,["formProps"]))}),[p,F]=J(0,{value:f(()=>e.current),onChange:e.onCurrentChange}),P=(u,b)=>{c.value[b]=u},A=f(()=>p.value===e.steps.length-1),y=async(u,b)=>{if(d.set(u,b),!A.value||!e.onFinish)return;i(!0);const S=G({},...Array.from(d.values()));try{await e.onFinish(S)&&(F(0),c.value.forEach(D=>{var k;return(k=D.value)==null?void 0:k.reset()}))}catch(E){console.log(E)}finally{i(!1)}},_=()=>{var u;const b=c.value[p.value];b&&((u=b.value)==null||u.submit())},O=()=>{p.value<1||F(p.value-1)},R=f(()=>{var u;let b;return e.submitter!==!1&&m(ue,x({key:"next",type:"primary",loading:n.value},(u=e.submitter)==null?void 0:u.submitButtonProps,{onClick:()=>{_()}}),z(b=a.getMessage("stepsForm.next","下一步"))?b:{default:()=>[b]})}),V=f(()=>{var u;let b;return e.submitter!==!1&&m(ue,x({key:"pre"},(u=e.submitter)==null?void 0:u.resetButtonProps,{onClick:()=>{O()}}),z(b=a.getMessage("stepsForm.prev","上一步"))?b:{default:()=>[b]})}),T=f(()=>{var u;let b;return e.submitter!==!1&&m(ue,x({key:"submit",type:"primary",loading:n.value},(u=e.submitter)==null?void 0:u.submitButtonProps,{onClick:()=>{_()}}),z(b=a.getMessage("stepsForm.submit","提交"))?b:{default:()=>[b]})}),N=()=>{p.value>e.steps.length-2||F(p.value+1)},t=f(()=>{var u,b;const S=[],E=p.value||0;return E<1?((u=e.steps)==null?void 0:u.length)===1?S.push(T.value):S.push(R.value):E+1===((b=e.steps)==null?void 0:b.length)?S.push(V.value,T.value):S.push(V.value,R.value),S}),r=f(()=>{var u;return Dt[((u=e.stepsProps)==null?void 0:u.direction)||"horizontal"]}),g=f(()=>m("div",{class:`${s}-steps-container`,style:{maxWidth:Math.min(e.steps.length*320,1160)+"px"}},[m(tt,x(e.stepsProps,{items:h.value,current:p.value,onChange:void 0}),null)])),C=f(()=>m("div",{class:`${s}-container`,style:e.containerStyle},[e.items.map((u,b)=>{var S;const E=I(B(((S=e.steps[b])==null?void 0:S.formProps)||{}),["items"]),D=E.name||`${b}`,k=G({},o.value,E);return m(Tt,x({items:u,name:D,index:b},k),l)}),m(Ve,null,{default:()=>[t.value]})])),v=f(()=>{var u;const b={stepsDom:g.value,formDom:C.value};return(u=r.value)==null?void 0:u.call(r,b)});return It({step:p,loading:n,setLoading:i,lastStep:A,next:N,regForm:P,onFormFinish:y}),()=>m("div",{class:s},[v.value])}}),jt=j({name:"ProForm",inheritAttrs:!1,props:{layoutType:{type:String,default:"Form"},...st()},setup(e,{slots:l,expose:a,attrs:s}){const c=w(),d=re(c);return a(d),()=>{const{layoutType:n,items:i,...o}=e;return n==="DrawerForm"?m(_e,x({ref:c},s,o,{items:i}),l):n==="ModalForm"?m(pe,x({ref:c},s,o,{items:i}),l):n==="QueryFilter"?m(Ce,x({ref:c},s,o,{items:i}),l):n==="StepForm"?m(Pe,x({ref:c},s,o,{items:i}),l):m(Y,x({ref:c},s,o,{items:i}),l)}}});const Ut=nt(jt,{Drawer:_e,Modal:pe,Filter:Ce,Steps:Pe});ne(_e);ne(pe);const Ht=ne(Ce);ne(Pe);export{Pt as F,X as P,be as R,Ut as a,vt as b,ke as c,Ht as d,Te as e,ye as f,it as g,yt as h,q as i,zt as j,dt as k,he as p,J as u};
