const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/FormGroup.BO-297_5.js","assets/chunks/FormTitle.C2EqXjeu.js","assets/chunks/framework.LW9JDvVy.js","assets/chunks/theme.U7NSClkI.js","assets/chunks/validate.EEzCsTff.js","assets/chunks/index.C7_NVaEl.js","assets/chunks/index.DaKc6qlh.js","assets/chunks/install.BalIz2Dd.js","assets/chunks/index.Dw6vpUqL.js","assets/chunks/index.Dvj91dNc.js","assets/chunks/useIntl.OXXSmlue.js","assets/chunks/index.D82MmqGS.js","assets/chunks/FormSet.CvDHVx3P.js","assets/chunks/useFieldValue.BpDyKlGG.js","assets/chunks/FormList.DP3Q58OQ.js","assets/chunks/FormListContext.wZgmYX6s.js","assets/chunks/FormItem.B63fKSCe.js","assets/chunks/index.CVgsavLM.js"])))=>i.map(i=>d[i]);
import{P as Ge}from"./index.C7_NVaEl.js";import{d as k,r as $e,w as $,c as ce,p as de,f as A,s as ee,o as ve,e as g,F as W,v as We,k as h,a0 as V,an as le,ao as ne,i as fe,u as ze,h as Ke,J as Ue,E as He,aJ as Qe,a_ as Xe}from"./framework.LW9JDvVy.js";import{_ as L,$ as q,y as G,z as U,a0 as Z,S as Ee,B as we,K as Je,i as Ye,F as Ze,J as et,a1 as X,a2 as tt,M as Ve,x as lt,a3 as nt}from"./theme.U7NSClkI.js";import{d as Be,e as at,a as ie,f as rt}from"./validate.EEzCsTff.js";import{a as T,o as D,P as se}from"./index.DaKc6qlh.js";import{u as ae}from"./index.Dw6vpUqL.js";import{u as re}from"./useIntl.OXXSmlue.js";import{P as ot}from"./index.D82MmqGS.js";import{w as ut,a as oe}from"./install.BalIz2Dd.js";function st(e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&delete e[t]}const Re=Symbol("FormSlotsContext"),je=()=>ce(Re,{});var it=k({name:"FormSlotsContextProvider",inheritAttrs:!1,props:{value:{type:Object,default:()=>({})}},setup(e,{slots:t}){const l=$e({});return $(()=>e.value,()=>{st(l),Object.assign(l,e.value)},{immediate:!0}),de(Re,l),()=>{var s;return(s=t.default)==null?void 0:s.call(t)}}});const ct=()=>({layout:{type:String,default:"horizontal"},labelCol:{type:Object},wrapperCol:{type:Object},colon:{type:Boolean,default:!0},requiredMark:{type:[Boolean,String],default:!0},labelAlign:{type:String,default:"right"},labelWrap:Boolean,disabled:{type:Boolean,default:!1},prefixCls:String,validateMessages:Object,validateTrigger:{type:[String,Array],default:"change"},validateOnRuleChange:{type:Boolean,default:!0},scrollToFirstError:{type:[Boolean,Object],default:!1},name:String}),Jt=()=>({value:{type:[String,Array,Number,Object,Boolean]},readonly:{type:Boolean,default:void 0},readonlyProps:{type:Object,default:void 0},valueEnum:{type:[Function,Object],default:void 0},options:{type:[Array,Function],default:void 0},request:{type:Function,default:void 0},params:{type:[Function,Object],default:void 0},dependencies:{type:Array,default:void 0},onChange:{type:Function}}),Q=()=>({...ct(),loading:{type:Boolean,default:void 0},showLoading:{type:Boolean,default:!0},submitOnLoading:{type:Boolean,default:!0},gridSubmitter:{type:Boolean,default:!1},omitNil:{type:Boolean,default:!0},readonly:Boolean,grid:Boolean,isKeyPressSubmit:Boolean,formKey:String,theme:{type:String,default:"custom"},customUi:{type:Boolean,default:!0},initialValues:{type:Object},readonlyProps:{type:Object},colProps:{type:Object},rowProps:{type:Object},dateFormatter:{type:[String,Function,Boolean],default:"string"},params:{type:Object},items:{type:Array},request:{type:Function},requestAbort:{type:Boolean},submitter:{type:[Object,Boolean],default:void 0},onReset:{type:Function},onFinish:{type:Function},onFinishFailed:{type:Function},onLoadingChange:{type:Function},onValuesChange:{type:Function},onInit:{type:Function,default:void 0}}),me=()=>({...Q(),submitTimeout:{type:Number,default:void 0},title:{type:String,default:void 0},width:{type:[String,Number],default:800},open:{type:Boolean,default:void 0},closeOnFinish:{type:Boolean,default:!0},confirmOnValuesChange:{type:Boolean,default:!0},onOpenChange:{type:Function,default:void 0}}),Ie=()=>({...Q(),preserve:{type:Boolean,default:!0},defaultCollapsed:{type:Boolean,default:!0},collapsed:{type:Boolean,default:void 0},defaultColsNumber:Number,defaultFormItemsNumber:Number,labelWidth:{type:[String,Number],default:"80"},searchText:String,resetText:String,searchGutter:{type:Number,default:24},span:{type:[Number,Object]},showHiddenNum:Boolean,ignoreRules:Boolean,resetOnSubmit:Boolean,onCollapse:{type:Function,default:void 0},onResize:{type:Function,default:void 0}}),Te=()=>({...Q(),current:{type:Number,default:void 0},steps:{type:Array,default:()=>[]},items:{type:Array,default:()=>[]},stepsProps:{type:Object},containerStyle:{type:Object},onCurrentChange:{type:Function,default:void 0}}),dt=()=>({...Q(),...me(),...Ie(),...Te(),items:{type:Array,default:()=>[]}});function vt(e,t){return e?Be(e)&&e.startsWith("::")?t[e.substring(2)]:e:null}const De=Symbol("FormContext"),ft=e=>{de(De,e)},ge=()=>ce(De,{}),Ne=(e,{slots:t})=>{var l;return(l=t.default)==null?void 0:l.call(t)};Ne.displayName="RenderSlot";Ne.inheritAttrs=!1;const ye=(e,{slots:t})=>{var l,s,u;return typeof e.vnode=="function"?((l=e.vnode)==null?void 0:l.call(e,e.props||{}))||((s=t.default)==null?void 0:s.call(t)):e.vnode||((u=t.default)==null?void 0:u.call(t))};ye.props=["vnode","props"];ye.inheritAttrs=!1;function mt(e){const t=A(null);return async(s,u)=>{var o,a;(o=t.value)==null||o.abort();const y=new AbortController;return t.value=y,await Promise.race([(a=e.request)==null?void 0:a.call(e,s,u),new Promise((c,S)=>{var C,_;(_=(C=t.value)==null?void 0:C.signal)==null||_.addEventListener("abort",()=>{S(new Error("aborted"))})})])}}function gt(e,...t){return typeof e=="function"?e(...t):e}function yt(e){const t=typeof e=="function"?e():e,l=A(t);function s(u){l.value=u}return[l,s]}var J=(e=>(e.FORM_SET="formSet",e.FORM_LIST="formList",e.GROUP="group",e.DIVIDER="divider",e.TEXT="text",e.DIGIT="digit",e.DIGIT_RANGE="digitRange",e.SELECT="select",e.TREE_SELECT="treeSelect",e.CASCADER="cascader",e.TEXTAREA="textarea",e.PASSWORD="password",e.CHECKBOX="checkbox",e.CHECKBOX_GROUP="checkboxGroup",e.RADIO_GROUP="radioGroup",e.SWITCH="switch",e.SLIDER="slider",e.RATE="rate",e.DATE="date",e.DATE_RANGE="dateRange",e.TIME="time",e.TIME_RANGE="timeRange",e.UPLOAD_BUTTON="uploadButton",e.UPLOAD_DRAGGER="uploadDragger",e.UPLOAD_PICTURE="uploadPicture",e.UPLOAD_PICTURE_LIST="uploadPictureList",e.EDITOR="editor",e))(J||{});function ke(e){return{getFieldValue:P=>{var m;return(m=e.value)==null?void 0:m.getFieldValue(P)},getFieldsValue:P=>{var m;return(m=e.value)==null?void 0:m.getFieldsValue(P)},resetInitialValues:P=>{var m;return(m=e.value)==null?void 0:m.resetInitialValues(P)},getFieldFormatValue:P=>{var m;return(m=e.value)==null?void 0:m.getFieldFormatValue(P)},getFieldFormatValueObject:P=>{var m;return(m=e.value)==null?void 0:m.getFieldFormatValueObject(P)},validateFieldsReturnFormatValue:P=>{var m;return(m=e.value)==null?void 0:m.validateFieldsReturnFormatValue(P)},setFieldValue:(P,m)=>{var w;return(w=e.value)==null?void 0:w.setFieldValue(P,m)},setFieldsValue:(P,m=!0)=>{var w;return(w=e.value)==null?void 0:w.setFieldsValue(P,m)},resetField:P=>{var m;return(m=e.value)==null?void 0:m.resetField(P)},clearValidate:P=>{var m;return(m=e.value)==null?void 0:m.clearValidate(P)},validateFields:P=>{var m;return(m=e.value)==null?void 0:m.validateFields(P)},reset:()=>{var P;return(P=e.value)==null?void 0:P.reset()},submit:()=>{var P;return(P=e.value)==null?void 0:P.submit()}}}const bt=e=>{const t=A(!0),l=A(!1),s=ee({...e.initialValues}),u=mt({request:e.request});return ve(async()=>{var o;if(e.request&&!e.requestAbort){t.value=!0,l.value=!0;const a=await u(e.params);s.value=(o=L({},s.value,a))!=null?o:{},Promise.resolve().then(()=>{t.value=!1,l.value=!1})}}),{initialValues:s,hasInitial:t,requestLoading:l}},ht=()=>{const e=ee([]),t=ee([]),l=g(()=>e.value.map(r=>r.split(":")[1])),s=(r,c,S)=>{Array.isArray(S)||(S=[S]);const C=r.filter(_=>!_.startsWith(c+":"));return C.push(...S.map(_=>`${c}:${_}`)),Array.from(new Set(C))},u=(r,c)=>{e.value=s(e.value,r,c)},o=(r,c)=>{t.value=s(t.value,r,c)},a=g(()=>e.value.filter(r=>!l.value.includes(r.split(":")[0])).map(r=>r.split(":")[1])),y=g(()=>t.value.filter(r=>!l.value.includes(r.split(":")[0])).map(r=>r.split(":")[1]));return{allHiddenKeys:a,hiddenKeys:e,allDisabledKeys:y,disabledKeys:t,updateHiddenKeys:u,updateDisabledKeys:o}},z=e=>{if(e)return Be(e)?e.indexOf(".")>-1?e.split("."):[e]:e};function Me(e){return Array.isArray(e)&&e.length===1&&(e=e[0]),e?.__v_isVNode&&typeof e.type!="symbol"}function Ft(e){return e&&(e.type===Comment||e.type===W&&e.children.length===0||e.type===Text&&e.children.trim()==="")}function ue(e=[]){const t=[];return e.forEach(l=>{Array.isArray(l)?t.push(...l):l?.type===W?t.push(...ue(l.children)):t.push(l)}),t.filter(l=>!Ft(l)&&Me(l))}function be(e,t={},l=!0,s=!1){let u=e;if(Array.isArray(e)&&(u=ue(e)[0]),!u)return null;const o=We(u,t,s);return o.props=l?{...o.props,...t}:o.props,o}function _t(e){return typeof e!="object"?!1:e===null?!0:!(Me(e)||e.constructor===RegExp||e instanceof Map||e instanceof Set||e instanceof HTMLElement||e instanceof Blob||e instanceof File||Array.isArray(e))}const K=(e,t,l)=>{if(Object.keys(e).length<1||typeof window>"u"||typeof e!="object"||at(e)||e instanceof Blob)return e;let s=Array.isArray(e)?[]:{};const u=(o,a)=>{let r=Array.isArray(o)?[]:{};return o==null||o===void 0?r:(Object.keys(o).forEach(c=>{var S;const C=(m,w)=>(Array.isArray(m)&&m.forEach((O,R)=>{if(!O)return;const n=w?.[R];typeof O=="function"&&(w[R]=O(w,c,o)),typeof O=="object"&&!Array.isArray(O)&&Object.keys(O).forEach(d=>{const p=n?.[d];if(typeof O[d]=="function"&&p){const i=O[d](n[d],c,o);n[d]=typeof i=="object"?i[d]:i}else typeof O[d]=="object"&&Array.isArray(O[d])&&p&&C(O[d],p)}),typeof O=="object"&&Array.isArray(O)&&n&&C(O,n)}),c),_=o[c],E=(S=t.get(c))==null?void 0:S.transform,P=()=>{let m,w,O=!1;if(typeof E=="function"){w=E?.(_,c,o);const R=typeof w;R!=="object"&&R!=="undefined"?(m=c,O=!0):m=w}else m=C(E,_);if(Array.isArray(m)){r=G(r,m,_);return}typeof m=="object"&&!Array.isArray(s)?s=L(s,m):typeof m=="object"&&Array.isArray(s)?r={...r,...m}:(m!==null||m!==void 0)&&(r=G(r,[m],O?w:_))};if(E&&typeof E=="function"&&P(),!(typeof window>"u")){if(_t(_)){const m=u(_);if(Object.keys(m).length<1)return;r=G(r,[c],m);return}P()}}),l?r:o)};return s=Array.isArray(e)&&Array.isArray(s)?[...u(e)]:L({},u(e),s),s},Le=(e,t)=>{if(Object.keys(e).length<1)return e;const l={};return Object.keys(e).forEach(s=>{var u;const o=e[s],a=(u=t.get(s))==null?void 0:u.convertValue;if(typeof a=="function"){const y=a?.(o,s);l[s]=y}else l[s]=o}),l};function pt({props:e,formRef:t,formData:l,initialValues:s,hasInitial:u,transformerMap:o,onFinish:a,onReset:y,onFinishFailed:r}){const c=i=>{const F=z(i);if(!F)throw new Error("name is require");return U(l.value,F)},S=i=>{if(i===!0||i===void 0)return q(l.value);const F={};return i.forEach(j=>{const I=z(j),f=U(l.value,I);f!==void 0&&G(F,I,f)}),F},C=i=>{const F=z(i);if(!F)throw new Error("name is require");const j=U(l.value,F),I=G({},F,j);return U(K(I,o.value,e.omitNil),F)},_=i=>{const F=z(i);if(!F)throw new Error("name is require");const j=U(l.value,F),I=G({},F,j);return K(I,o.value,e.omitNil)},E=async i=>{var F;if(!Array.isArray(i)&&i)throw new Error("nameList must be array");const j=await((F=t.value)==null?void 0:F.validateFields(i)),I=K(j,o.value,e.omitNil);return I??{}},P=(i,F)=>{const j=z(i);if(!j)throw new Error("name is require");G(l.value,j,F)},m=(i,F=!0)=>{if(!i)throw new Error("values is require");F?l.value=L({},l.value,i):l.value=q(i)},w=i=>{if(!i)throw new Error("values is require");if(!ie(i))throw new Error("values must be object");u.value=!0,s.value=q(i)},O=()=>{var i;u.value=!0,(i=t.value)==null||i.clearValidate(),l.value=q(Le(s.value,o.value)),Promise.resolve().then(()=>{u.value=!1,y?.(K(l.value,o.value,e.omitNil))})},R=i=>{var F;if(!z(i))throw new Error("name is require");(F=t.value)==null||F.clearValidate(i),G(l.value,i,q(U(s.value,i)))},n=i=>{var F;(F=t.value)==null||F.clearValidate(i)},d=i=>new Promise((F,j)=>{var I;(I=t.value)==null||I.validateFields(i).then(f=>{F({...l.value,...f})}).catch(f=>{j(f)})});return{getFieldValue:c,getFieldsValue:S,resetInitialValues:w,getFieldFormatValue:C,getFieldFormatValueObject:_,validateFieldsReturnFormatValue:E,setFieldValue:P,setFieldsValue:m,resetField:R,clearValidate:n,validateFields:d,reset:O,submit:()=>{d().then(i=>{if(a)try{a(i)}catch(F){console.error(F)}}).catch(i=>{r&&r(i)})}}}var Ct=k({name:"FormRowWrapper",inheritAttrs:!1,props:{rowProps:{type:Object,default:void 0},grid:{type:Boolean,default:void 0}},setup(e,{slots:t,attrs:l}){const{rowProps:s,grid:u}=ge(),o=g(()=>{var y;return(y=e.grid)!=null?y:u?.value}),a=g(()=>{var y;return(y=e.rowProps)!=null?y:s?.value});return()=>{var y;return o?.value?h(Z,V(a.value,{class:l.class}),{default:()=>{var r;return[(r=t.default)==null?void 0:r.call(t)]}}):(y=t.default)==null?void 0:y.call(t)}}});function he(e,t){const l={};return Array.isArray(t)&&t.length>0&&Object.keys(e||{}).forEach(s=>{t.includes(s)&&(l[s]=e[s])}),l}const Pt=le(()=>ne(()=>import("./FormGroup.BO-297_5.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),wt=le(()=>ne(()=>import("./FormSet.CvDHVx3P.js"),__vite__mapDeps([12,13,3,2,1,6,4,7,8,5,9,10,11]))),St=le(()=>ne(()=>import("./FormList.DP3Q58OQ.js"),__vite__mapDeps([14,15,2,1,3,13,6,4,7,8,5,9,10,11]))),Ot=le(()=>ne(()=>import("./FormItem.B63fKSCe.js"),__vite__mapDeps([16,13,3,2,15,17,10,8,7,6,4,11,9,1,5]))),At=["min","max","isValidateList","emptyListMessage","creatorRecord","creatorButtonProps","alwaysShowItemLabel","actionGuard","copyIconProps","deleteIconProps","onAfterAdd","onAfterRemove"],xt=["action","creator","item"];var Et=k({name:"FormItems",inheritAttrs:!1,props:{list:{type:Array,default:()=>[]},type:{type:String,default:""},grid:{type:Boolean,default:void 0},spaceProps:{type:Object,default:()=>({size:[32,0],wrap:!0})}},setup(e){const{grid:t,allHiddenKeys:l}=ge(),s=je(),u=g(()=>{var a;return(a=e.grid)!=null?a:t?.value}),o=g(()=>e.list.filter(a=>!l.value.includes(a.key)).map(a=>{var y;if(a.fieldType===J.GROUP)return h(Pt,{key:a.key,items:a.children,title:a.title,tooltip:a.tooltip,colProps:a.colProps,rowProps:a.rowProps,spaceProps:a.spaceProps,grid:a.grid,item:a,formItemProps:a.formItemProps},null);if(a.fieldType===J.FORM_SET)return h(wt,{key:a.key,name:a.name,items:a.children,title:a.title,tooltip:a.tooltip,colProps:a.colProps,rowProps:a.rowProps,spaceProps:a.spaceProps,formItemProps:a.formItemProps,initialValue:a.initialValue,convertValue:a.convertValue,transform:a.transform},null);if(a.fieldType===J.FORM_LIST){const r=T(he((y=a.fieldProps)!=null?y:{},At)),c={};return xt.forEach(S=>{var C;const _=vt((C=a.fieldProps)==null?void 0:C[`${S}Render`],s);_&&(c[S]=E=>h(ye,{vnode:_,props:E},null))}),h(St,V({key:a.key,name:a.name,originName:a.originName,items:a.children,title:a.title,tooltip:a.tooltip,rules:a.rules,colProps:a.colProps,rowProps:a.rowProps,formItemProps:a.formItemProps,initialValue:a.initialValue,convertValue:a.convertValue,transform:a.transform},r),{...c})}return h(Ot,{key:a.key,item:a,grid:u.value},null)}));return()=>e.type==="space"&&!u?.value?h(Ee,V(e.spaceProps,{align:"start"}),{default:()=>[o.value]}):o.value}});function Se(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!fe(e)}var Vt=k({name:"FormSubmitter",inheritAttrs:!1,props:{loading:{type:Boolean,default:void 0},reverse:{type:Boolean,default:void 0},onSubmit:{type:Function,default:void 0},onReset:{type:Function,default:void 0},searchConfig:{type:Object,default:void 0},submitButtonProps:{type:[Object,Boolean],default:void 0},resetButtonProps:{type:[Object,Boolean],default:void 0},render:{type:[Function,Boolean],default:void 0}},setup(e,{attrs:t}){const{action:l}=ge(),s=je(),u=async()=>{var r;if(!e.onSubmit){l.submit();return}const c=l.getFieldsValue(),C=await((r=e.onSubmit)==null?void 0:r.call(e,c,l));return C&&l.submit(),C},o=async()=>{var r;if(!e.onReset){l.reset();return}const c=l.getFieldsValue(),C=await((r=e.onReset)==null?void 0:r.call(e,c,l));return C&&l.reset(),C},a=g(()=>{const{searchConfig:r={},resetButtonProps:c={}}=e;if(c===!1)return null;const{resetText:S="重置"}=r;return h(we,V(D(c,["preventDefault","onClick"]),{key:"reset",onClick:C=>{var _;c.preventDefault||o(),(_=c.onClick)==null||_.call(c,C)}}),Se(S)?S:{default:()=>[S]})}),y=g(()=>{const{searchConfig:r={},submitButtonProps:c={}}=e;if(c===!1)return null;const{submitText:S="提交"}=r;return h(we,V({type:"primary"},D(c||{},["preventDefault","onClick"]),{key:"submit",onClick:C=>{var _;c.preventDefault||u(),(_=c.onClick)==null||_.call(c,C)}}),Se(S)?S:{default:()=>[S]})});return()=>{if(e.render===!1)return null;const{render:r=s.submitter}=e,c=e.reverse?h(W,null,[a.value,y.value]):h(W,null,[y.value,a.value]),S=r?r({props:{...e,submit:u,reset:o},action:l,defaultDoms:c}):c;return h("div",{style:{display:"flex",gap:"8px",alignItems:"center",...t.style},class:t.class},[S])}}});function Bt(e){const t=new Map,l=s=>{s.forEach(u=>{var o;if(u.name&&(u.transform||u.convertValue))t.set(u.name,{transform:u.transform,convertValue:u.convertValue});else if(u.children){const a=(o=gt(u.children))!=null?o:[];l(a)}})};return l(e),t}function te(e,t){const{defaultValue:l,value:s=A()}=t||{};let u=typeof e=="function"?e():e;s.value!==void 0&&(u=ze(s)),l!==void 0&&(u=typeof l=="function"?l():l);const o=A(u),a=A(u);Ke(()=>{let r=s.value!==void 0?s.value:o.value;t?.postState&&(r=t.postState(r)),a.value=r});function y(r){const c=a.value;o.value=r,Ue(a.value)!==r&&t?.onChange&&t?.onChange(r,c)}return $(s,()=>{o.value=s.value}),[a,y]}function Rt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!fe(e)}let Oe=0;var Y=k({name:"BaseForm",inheritAttrs:!1,props:{...Q()},setup(e,{slots:t,expose:l,attrs:s}){const u=A(!1),o=ee(new Map),a=A(),y=ae("form"),r=A({}),c=A([]),S=g(()=>{var f;return(f=e.formKey)!=null?f:Oe.toString()}),[C,_]=te(!1,{value:g(()=>e.loading),onChange:f=>{var v;(v=e.onLoadingChange)==null||v.call(e,f)}}),E=g(()=>{var f;return{[y]:!0,[`${(f=s.class)!=null?f:""}`]:!0}}),P=g(()=>{var f;return{...T(D(e,["colProps","submitter","loading","showLoading","omitNil","grid","theme","customUi","gridSubmitter","requestAbort","isKeyPressSubmit","formKey","initialValues","rowProps","dateFormatter","params","readonly","readonlyProps","items","request","submitOnLoading","onLoadingChange","onFinish","onValuesChange"])),layout:(f=e.layout)!=null?f:"vertical"}}),m=f=>f.filter(v=>!v.hidden).sort((v,b)=>{var x,B;return b.order||v.order?((x=b.order)!=null?x:0)-((B=v.order)!=null?B:0):0}).map((v,b)=>{var x,B;const N=z(v.name),M=(x=v.key)!=null?x:N?(N??[]).join("_"):b;return T({...v,originName:(B=v.originName)!=null?B:v.name,name:N,key:M})}).filter(v=>!!v);$(()=>e.items,()=>{var f,v;o.value=Bt((f=e.items)!=null?f:[]),c.value=m((v=e.items)!=null?v:[])},{immediate:!0});const{initialValues:w,hasInitial:O,requestLoading:R}=bt(e);$(w,(f,v)=>{Ye(f,v)||(r.value=q(Le(f,o.value)),(!e.request||e.requestAbort)&&Promise.resolve().then(()=>{O.value=!1}))},{immediate:!0});const n=Je(()=>{var f;(f=e.onValuesChange)==null||f.call(e,K(q(r.value),o.value,e.omitNil))},200),d=async()=>{if(e.onFinish){if(e.submitOnLoading){if(C.value)return;_(!0)}try{const f=K(q(r.value),o.value,e.omitNil);await e.onFinish(f)}catch(f){console.log("🚀 ~ onFinish ~ error:",f)}finally{e.submitOnLoading&&_(!1)}}};$(r,()=>{O.value||n()},{deep:!0});const p=ht(),i=pt({props:e,formRef:a,formData:r,initialValues:w,hasInitial:O,transformerMap:o,onFinish:d,onReset:e.onReset,onFinishFailed:e.onFinishFailed}),F=g(()=>typeof e.submitter=="boolean"||!e.submitter?{}:D(e.submitter,["colProps"])),j=g(()=>e.submitter===!1||e.readonly?{}:e.gridSubmitter&&ie(e.submitter)&&ie(e.submitter.colProps)?{...e.submitter.colProps}:{span:24}),I=g(()=>{if(e.submitter===!1||e.readonly)return;const f=F.value.submitButtonProps===!1?!1:{loading:C.value,...F.value.submitButtonProps},v=F.value.resetButtonProps===!1?!1:{disabled:C.value,...F.value.resetButtonProps},b=h(Vt,V({key:"submitter"},F.value,{submitButtonProps:f,resetButtonProps:v}),null);return F.value.teleport?h(He,{defer:!0,to:F.value.teleport},Rt(b)?b:{default:()=>[b]}):b});return ve(()=>{var f,v,b;u.value=!0,Oe+=1;const x=(b=(v=(f=a.value)==null?void 0:f.getFieldsValue)==null?void 0:v.call(f,!0))!=null?b:{};Promise.resolve().then(()=>{var B;(B=e.onInit)==null||B.call(e,K(x,o.value,e.omitNil),i)})}),ft({...p,action:i,formKey:S,mountedRef:u,prefixCls:y,initialValues:w,formData:r,hasInitial:O,theme:g(()=>e.theme),customUi:g(()=>e.customUi),grid:g(()=>e.grid),disabled:g(()=>e.disabled),readonly:g(()=>e.readonly),readonlyProps:g(()=>e.readonlyProps),rowProps:g(()=>{var f;return(f=e.rowProps)!=null?f:{gutter:16}}),colProps:g(()=>{var f;return(f=e.colProps)!=null?f:{xs:24}}),formatItems:m}),l({...i}),()=>h(it,{value:{...t}},{default:()=>[h(Ze,V({ref:a},P.value,{class:E.value,model:r.value,style:s.style}),{default:()=>[h(et,{spinning:e.showLoading&&(R.value||C.value)},{default:()=>[h(Ct,null,{default:()=>[h(Et,{list:c.value},null),e.gridSubmitter&&e.submitter!==!1&&h(X,j.value,{default:()=>[h(tt,{label:" ",colon:!1,class:`${y}-submitter-form-item`},{default:()=>[I.value]})]})]}),!e.gridSubmitter&&I.value]})]})]})}}),Fe=k({name:"ProDrawerForm",inheritAttrs:!1,props:{...me(),drawerProps:{type:Object,default:void 0}},emits:["update:open"],setup(e,{slots:t,emit:l}){const s=A(!1),u=A(!1),o=A(!1),a=re(),y=A(),r=A(null),c=g({get:()=>{var n;return(n=e.open)!=null?n:s.value},set:n=>{typeof e.open>"u"?s.value=n:l("update:open",n)}});$(c,()=>{var n;(n=e.onOpenChange)==null||n.call(e,c.value)});const S=g(()=>({...T(D(e,["onOpenChange","closeOnFinish","drawerProps","title","width","onInit","confirmOnValuesChange","submitTimeout","onFinish","submitter"])),layout:"vertical"})),C=g(()=>({...T(D(t,["trigger","closeIcon","extra","footer","title"]))})),_=g(()=>{var n;return T({...D((n=e.drawerProps)!=null?n:{},["title","width","open","footer","okText","cancelText"]),width:e.width,title:e.title})}),E=g(()=>({...T(he(t,["closeIcon","extra","title"]))})),P=g(()=>{var n,d,p,i;return e.submitter===!1?!1:L({teleport:r.value,reverse:!0,searchConfig:{submitText:(d=(n=e.drawerProps)==null?void 0:n.okText)!=null?d:a.getMessage("confirm.okText","确认"),resetText:(i=(p=e.drawerProps)==null?void 0:p.cancelText)!=null?i:a.getMessage("confirm.cancelText","取消")},resetButtonProps:{preventDefault:!0,disabled:e.submitTimeout?u.value:void 0,onClick:F=>{w(F)}}},e.submitter)}),m=g(()=>{if(!t.trigger)return null;const n=ue(t.trigger())[0];return be(n,{key:"trigger",...n?.props,onClick:async d=>{var p,i;c.value=!c.value,(i=(p=n?.props)==null?void 0:p.onClick)==null||i.call(p,d)}})}),w=n=>{var d,p;e.confirmOnValuesChange&&o.value?Ve.confirm({title:a.getMessage("confirm.title","提示"),content:a.getMessage("confirm.formModalCloseContent","您的表单还没有保存，您确定关闭吗？"),onOk(){var i,F;c.value=!1,(F=(i=_.value)==null?void 0:i.onClose)==null||F.call(i,n)},onCancel(){}}):(c.value=!1,(p=(d=_.value)==null?void 0:d.onClose)==null||p.call(d,n))},O=()=>{var n,d,p;y.value&&!((n=_.value)!=null&&n.destroyOnClose)&&((p=(d=y.value)==null?void 0:d.reset)==null||p.call(d))},R=async n=>{var d;const p=(d=e.onFinish)==null?void 0:d.call(e,n);if(e.submitTimeout&&p instanceof Promise){u.value=!0;const F=setTimeout(()=>{u.value=!1},e.submitTimeout);p.finally(()=>{clearTimeout(F),u.value=!1})}const i=await p;return i&&(e.closeOnFinish?c.value=!1:o.value=!1),i};return()=>h(W,null,[h(Ge,V(_.value,{open:c.value,onAfterOpenChange:n=>{var d,p;n||O(),o.value=!1,(p=(d=_.value)==null?void 0:d.onAfterOpenChange)==null||p.call(d,n)},onClose:n=>{e.submitTimeout&&u.value||w(n)}}),{default:()=>[h(Y,V(S.value,{submitter:P.value,onFinish:async n=>await R(n),onValuesChange:n=>{var d;e.confirmOnValuesChange&&(o.value=!0),(d=e.onValuesChange)==null||d.call(e,n)},onReset:()=>{var n;e.confirmOnValuesChange&&(o.value=!1),(n=e.onReset)==null||n.call(e)},onInit:(n,d)=>{var p;y.value=d,(p=e.onInit)==null||p.call(e,n,d)}}),C.value)],...E.value,footer:e.submitter!==!1?()=>h("div",{style:"display: flex; justify-content: flex-end;",ref:r},null):void 0}),m.value])}}),_e=k({name:"ProModalForm",inheritAttrs:!1,props:{...me(),modalProps:{type:Object,default:void 0}},emits:["update:open"],setup(e,{slots:t,emit:l}){const s=A(!1),u=A(!1),o=A(!1),a=re(),y=A(),r=A(null),c=g({get:()=>{var n;return(n=e.open)!=null?n:s.value},set:n=>{typeof e.open>"u"?s.value=n:l("update:open",n)}});$(c,()=>{var n;(n=e.onOpenChange)==null||n.call(e,c.value)});const S=g(()=>{var n;return{...T(D(e,["onInit","onOpenChange","closeOnFinish","modalProps","title","width","confirmOnValuesChange","submitTimeout","onFinish","submitter"])),layout:(n=e.layout)!=null?n:"vertical"}}),C=g(()=>({...T(D(t,["trigger","closeIcon","extra","footer","title"]))})),_=g(()=>{var n;return T({...D((n=e.modalProps)!=null?n:{},["title","width","footer"]),width:e.width,title:e.title,footer:e.submitter===!1?null:void 0})}),E=g(()=>({...T(he(t,["closeIcon","title"]))})),P=g(()=>{var n,d,p,i;return e.submitter===!1?!1:L({teleport:r.value,reverse:!0,searchConfig:{submitText:(d=(n=_.value)==null?void 0:n.okText)!=null?d:a.getMessage("confirm.okText","确认"),resetText:(i=(p=_.value)==null?void 0:p.cancelText)!=null?i:a.getMessage("confirm.cancelText","取消")},resetButtonProps:{preventDefault:!0,disabled:e.submitTimeout?u.value:void 0,onClick:F=>{w(F)}}},e.submitter)}),m=g(()=>{if(!t.trigger)return null;const n=ue(t.trigger())[0];return be(n,{key:"trigger",...n?.props,onClick:async d=>{var p,i;c.value=!c.value,(i=(p=n?.props)==null?void 0:p.onClick)==null||i.call(p,d)}})}),w=n=>{var d,p;e.confirmOnValuesChange&&o.value?Ve.confirm({title:a.getMessage("confirm.title","提示"),content:a.getMessage("confirm.formModalCloseContent","您的表单还没有保存，您确定关闭吗？"),onOk(){var i,F;c.value=!1,(F=(i=_.value)==null?void 0:i.onCancel)==null||F.call(i,n)},onCancel(){}}):(c.value=!1,(p=(d=_.value)==null?void 0:d.onCancel)==null||p.call(d,n))},O=()=>{var n,d,p;y.value&&!((n=_.value)!=null&&n.destroyOnClose)&&((p=(d=y.value)==null?void 0:d.reset)==null||p.call(d))},R=async n=>{var d;const p=(d=e.onFinish)==null?void 0:d.call(e,n);if(e.submitTimeout&&p instanceof Promise){u.value=!0;const F=setTimeout(()=>{u.value=!1},e.submitTimeout);p.finally(()=>{clearTimeout(F),u.value=!1})}const i=await p;return i&&(e.closeOnFinish?c.value=!1:o.value=!1),i};return()=>h(W,null,[h(ot,V(_.value,{open:c.value,afterClose:()=>{var n,d;O(),o.value=!1,(d=(n=_.value)==null?void 0:n.afterClose)==null||d.call(n)},onCancel:n=>{e.submitTimeout&&u.value||w(n)}}),{default:()=>[h(Y,V(S.value,{submitter:P.value,onFinish:async n=>await R(n),onValuesChange:n=>{var d;e.confirmOnValuesChange&&(o.value=!0),(d=e.onValuesChange)==null||d.call(e,n)},onReset:()=>{var n;e.confirmOnValuesChange&&(o.value=!1),(n=e.onReset)==null||n.call(e)},onInit:(n,d)=>{var p;y.value=d,(p=e.onInit)==null||p.call(e,n,d)}}),C.value)],...E.value,footer:e.submitter!==!1?()=>h("div",{style:"display: flex; justify-content: flex-end;",ref:r},null):void 0}),m.value])}}),Ae;const jt={xs:513,sm:513,md:785,lg:992,xl:1057,xxl:1/0},xe={vertical:[[513,1,"vertical"],[785,2,"vertical"],[1057,3,"vertical"],[1/0,4,"vertical"]],default:[[513,1,"vertical"],[701,2,"vertical"],[1062,3,"horizontal"],[1352,3,"horizontal"],[1/0,4,"horizontal"]]},It=(e="horizontal",t,l)=>{if(l&&typeof l=="number")return{span:l,layout:e};const u=((l?["xs","sm","md","lg","xl","xxl"].map(o=>[jt[o],24/l[o],"horizontal"]):xe[e||"default"])||xe.default).find(o=>t<o[0]+16);return u?{span:24/u[1],layout:u?.[2]}:{span:8,layout:"horizontal"}},Tt=(e,t)=>e?.flatMap(l=>l.fieldType===J.GROUP&&!l.title?l.props.children:t?{...l,rules:[],formItemProps:{...l.formItemProps,rules:[]}}:l),Dt=rt()?(Ae=document?.body)==null?void 0:Ae.clientWidth:1024;var pe=k({name:"ProQueryFilter",inheritAttrs:!1,props:{...Ie()},emits:["collapse","resize"],setup(e,{slots:t,emit:l,expose:s,attrs:u}){const o=A(0),a=A(0),y=A(0),r=re(),c=ae("query-filter"),S=Qe("wrapper"),C=A(),_=A([]),[E,P]=te(Dt),m=ke(C);Xe(S,f=>{const v=f[0],{width:b,height:x}=v?.contentRect||{};E.value!==b&&b>17&&P(b),l("resize",b,x)});const w=g(()=>It(e.layout,E.value+16,e.span)),O=g(()=>{if(e.defaultFormItemsNumber!==void 0)return e.defaultFormItemsNumber;if(e.defaultColsNumber!==void 0){const f=24/w.value.span-1;return e.defaultColsNumber>f?f:e.defaultColsNumber}return Math.max(1,24/w.value.span-1)}),R=g(()=>e.showHiddenNum&&_.value.filter(f=>f.hidden).length),n=g(()=>!(o.value<24||a.value<=O.value)),d=g(()=>{const f=y.value%24+w.value.span;return f>24?24-w.value.span:24-f}),p=g(()=>{if(e.labelWidth&&w.value.layout!=="vertical"&&e.labelWidth!=="auto")return{labelCol:{flex:`0 0 ${e.labelWidth}px`},wrapperCol:{style:{maxWidth:`calc(100% - ${e.labelWidth}px)`}},style:{flexWrap:"nowrap"}}}),[i,F]=te(()=>e.defaultCollapsed&&e.submitter!==!1,{value:g(()=>e.collapsed),onChange:f=>{l("collapse",f)}}),j=g(()=>({...T(D(e,["defaultCollapsed","collapsed","grid","showLoading","defaultColsNumber","searchGutter","submitOnLoading","preserve","submitter","ignoreRules","searchText","resetText","labelWidth","layout","items","gridSubmitter","rowProps","defaultFormItemsNumber","showHiddenNum","ignoreRules","onCollapse","onReset"]))})),I=g(()=>e.submitter===!1?!1:L({style:{justifyContent:"flex-end"},reverse:!0,searchConfig:{submitText:e.searchText||r.getMessage("form.search","搜索"),resetText:e.resetText||r.getMessage("form.reset","重置")},colProps:{span:w.value.span,offset:d.value}},e.submitter));return $([w,i,()=>e.items],()=>{var f;let v=!1;y.value=0,a.value=0,o.value=0,(f=e.items)!=null&&f.length?_.value=Tt(e.items,e.ignoreRules).map((b,x)=>{var B;const N=(B=b.colSize)!=null?B:1,M=Math.min(w.value.span*(N||1),24);o.value+=M,a.value+=N,x===0&&(v=M===24&&!b.hidden);const Pe=b.hidden||i.value&&(v||a.value>O.value)&&!!x;return Pe?e.preserve?{...b,colProps:{span:M},hidden:!0}:{...b,colProps:{span:0},hidden:!0}:(24-y.value%24<M&&(o.value+=24-y.value%24,y.value+=24-y.value%24),y.value+=M,{...b,hidden:Pe,formItemProps:{...b.title?p.value:{},...b.formItemProps},colProps:{span:M}})}):_.value=[]},{immediate:!0}),s({formRef:C,...m}),()=>h("div",V({class:`${c}-wrap`,ref:"wrapper"},u),[h(Y,V({ref:C,class:c},j.value,{grid:!0,gridSubmitter:!0,rowProps:{gutter:e.searchGutter,justify:"start",class:`${c}-row`},showLoading:!1,submitter:I.value,items:_.value,layout:w.value.layout,onReset:f=>{var v,b;e.resetOnSubmit&&((v=C.value)==null||v.submit()),(b=e.onReset)==null||b.call(e,f)}}),{...t,submitter:({props:f,action:v,defaultDoms:b})=>{var x;return h(W,null,[t.submitter?(x=t.submitter)==null?void 0:x.call(t,{props:f,action:v,defaultDoms:b}):b,n.value!==!1&&h("a",{class:`${c}-collapse-button`,onClick:()=>F(!i.value)},[i.value?r.getMessage("form.collapsed","展开"):r.getMessage("form.expand","收起"),!!R.value&&`(${R.value})`,h(lt,{style:{marginInlineStart:"0.5em",transition:"0.3s all",transform:`rotate(${i.value?0:.5}turn)`}},null)])])}})])}});const qe=Symbol("StepsFormContextContext"),Nt=e=>{de(qe,e)},kt=()=>ce(qe,{});var Mt=k({name:"StepForm",inheritAttrs:!1,props:{index:Number,...Q()},emits:[],setup(e,{slots:t}){const l=ae("steps-form"),s=A(),{step:u,regForm:o,onFormFinish:a,setLoading:y,next:r,lastStep:c}=kt(),S=g(()=>e.index===u.value),C=g(()=>T(D(e,["index","onFinish"]))),_=async E=>{var P;if(e.name&&a(e.name,E),e.onFinish){y(!0),await((P=e.onFinish)==null?void 0:P.call(e,E))&&r(),y(!1);return}c.value||r()};return ve(()=>{o(s,e.index)}),()=>h("div",{class:{[`${l}-step`]:!0,[`${l}-step-active`]:S.value}},[h(Y,V({ref:s},C.value,{submitter:!1,onFinish:_}),t)])}});function H(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!fe(e)}const Lt={horizontal({stepsDom:e,formDom:t}){return h(W,null,[h(Z,{gutter:{xs:8,sm:16,md:24}},{default:()=>[h(X,{span:24},H(e)?e:{default:()=>[e]})]}),h(Z,{gutter:{xs:8,sm:16,md:24}},{default:()=>[h(X,{span:24},H(t)?t:{default:()=>[t]})]})])},vertical({stepsDom:e,formDom:t}){let l;return h(Z,{align:"stretch",wrap:!0,gutter:{xs:8,sm:16,md:24}},{default:()=>[h(X,{xxl:4,xl:6,lg:7,md:8,sm:10,xs:12},H(l=be(e,{style:{height:"100%"}}))?l:{default:()=>[l]}),h(X,null,{default:()=>[h("div",{style:{display:"flex",alignItems:"center",width:"100%",height:"100%"}},[t])]})]})}};var Ce=k({name:"ProStepsForm",inheritAttrs:!1,props:{...Te()},emits:[],setup(e,{slots:t,expose:l}){const s=re(),u=ae("steps-form"),o=A([]),a=new Map,[y,r]=yt(!1),c=g(()=>T(D(e,["name","current","stepsProps","containerStyle","onCurrentChange","steps","items","submitter","onFinish"]))),S=g(()=>{var v;return(v=e.steps)==null?void 0:v.map(b=>D(b,["formProps"]))}),[C,_]=te(0,{value:g(()=>e.current),onChange:e.onCurrentChange}),E=(v,b)=>{o.value[b]=v.value},P=g(()=>C.value===e.steps.length-1),m=async(v,b)=>{if(a.set(v,b),!P.value||!e.onFinish)return;r(!0);const x=L({},...Array.from(a.values()));try{await e.onFinish(x)&&(_(0),o.value.forEach(N=>N?.reset()))}catch(B){console.log(B)}finally{r(!1)}},w=()=>{const v=o.value[C.value];v&&v?.submit()},O=()=>{C.value<1||_(C.value-1)},R=g(()=>{var v;let b;return e.submitter!==!1&&h(se,V({key:"next",type:"primary",loading:y.value},(v=e.submitter)==null?void 0:v.submitButtonProps,{onClick:()=>{w()}}),H(b=s.getMessage("stepsForm.next","下一步"))?b:{default:()=>[b]})}),n=g(()=>{var v;let b;return e.submitter!==!1&&h(se,V({key:"pre"},(v=e.submitter)==null?void 0:v.resetButtonProps,{onClick:()=>{O()}}),H(b=s.getMessage("stepsForm.prev","上一步"))?b:{default:()=>[b]})}),d=g(()=>{var v;let b;return e.submitter!==!1&&h(se,V({key:"submit",type:"primary",loading:y.value},(v=e.submitter)==null?void 0:v.submitButtonProps,{onClick:()=>{w()}}),H(b=s.getMessage("stepsForm.submit","提交"))?b:{default:()=>[b]})}),p=()=>{C.value>e.steps.length-2||_(C.value+1)},i=g(()=>{var v,b;const x=[],B=C.value||0;return B<1?((v=e.steps)==null?void 0:v.length)===1?x.push(d.value):x.push(R.value):B+1===((b=e.steps)==null?void 0:b.length)?x.push(n.value,d.value):x.push(n.value,R.value),x}),F=g(()=>{var v;return Lt[((v=e.stepsProps)==null?void 0:v.direction)||"horizontal"]}),j=g(()=>h("div",{class:`${u}-steps-container`,style:{maxWidth:Math.min(e.steps.length*320,1160)+"px"}},[h(nt,V(e.stepsProps,{items:S.value,current:C.value,onChange:void 0}),null)])),I=g(()=>h("div",{class:`${u}-container`,style:e.containerStyle},[e.items.map((v,b)=>{var x;const B=D(T(((x=e.steps[b])==null?void 0:x.formProps)||{}),["items"]),N=B.name||`${b}`,M=L({},c.value,B);return h(Mt,V({items:v,name:N,index:b},M),t)}),h(Ee,null,{default:()=>[i.value]})])),f=g(()=>{var v;const b={stepsDom:j.value,formDom:I.value};return(v=F.value)==null?void 0:v.call(F,b)});return Nt({step:C,loading:y,setLoading:r,lastStep:P,next:p,regForm:E,onFormFinish:m}),l({formArrayRef:o}),()=>h("div",{class:u},[f.value])}}),qt=k({name:"ProForm",inheritAttrs:!1,props:{layoutType:{type:String,default:"Form"},...dt()},setup(e,{slots:t,expose:l,attrs:s}){const u=A(),o=ke(u);return l(o),()=>{const{layoutType:a,items:y,...r}=e;return a==="DrawerForm"?h(Fe,V({ref:u},s,r,{items:y}),t):a==="ModalForm"?h(_e,V({ref:u},s,r,{items:y}),t):a==="QueryFilter"?h(pe,V({ref:u},s,r,{items:y}),t):a==="StepForm"?h(Ce,V({ref:u},s,r,{items:y}),t):h(Y,V({ref:u},s,r,{items:y}),t)}}});const Yt=ut(qt,{Drawer:Fe,Modal:_e,Filter:pe,Steps:Ce}),Zt=oe(Fe),el=oe(_e),tl=oe(pe),ll=oe(Ce),nl=(e=100)=>new Promise(t=>{setTimeout(()=>{t(!0)},e)});export{Et as F,J as P,ye as R,Yt as a,el as b,Zt as c,tl as d,ll as e,yt as f,Ne as g,je as h,ge as i,vt as j,Ct as k,z as l,Jt as m,mt as n,he as p,gt as r,nl as s,te as u};
